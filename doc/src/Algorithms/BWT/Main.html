<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>Haskell code</title>
</head>
<body>
<pre><a name="line-1"></a><font color=Blue><i>-- |</i></font>
<a name="line-2"></a><font color=Blue><i>-- Authors: Peter Selinger, Beno&#238;t Valiron</i></font>
<a name="line-3"></a><font color=Blue><i>-- </i></font>
<a name="line-4"></a><font color=Blue><i>-- An implementation of the Binary Welded Tree algorithm. This</i></font>
<a name="line-5"></a><font color=Blue><i>-- algorithm inputs an oracle encoding a graph of the following form:</i></font>
<a name="line-6"></a><font color=Blue><i>-- </i></font>
<a name="line-7"></a><font color=Blue><i>-- \[image weldedtree.png]</i></font>
<a name="line-8"></a><font color=Blue><i>-- </i></font>
<a name="line-9"></a><font color=Blue><i>-- The graph consists of two binary trees whose leaves are connected</i></font>
<a name="line-10"></a><font color=Blue><i>-- by two permutations as shown in the above illustration. Except for</i></font>
<a name="line-11"></a><font color=Blue><i>-- the roots of the two trees, all nodes have degree 3. The edges</i></font>
<a name="line-12"></a><font color=Blue><i>-- of the graph are colored with 4 different colors. The objective of</i></font>
<a name="line-13"></a><font color=Blue><i>-- the algorithm is to find the exit node (17 in the above</i></font>
<a name="line-14"></a><font color=Blue><i>-- illustration), given the entrance node (1 in the above</i></font>
<a name="line-15"></a><font color=Blue><i>-- illustration). This is done by a Trotterized quantum walk on the</i></font>
<a name="line-16"></a><font color=Blue><i>-- graph.</i></font>
<a name="line-17"></a><font color=Blue><i>-- </i></font>
<a name="line-18"></a><font color=Blue><i>-- The algorithm is described in:</i></font>
<a name="line-19"></a><font color=Blue><i>-- </i></font>
<a name="line-20"></a><font color=Blue><i>-- * A. M. Childs, R. Cleve, E. Deotto, E. Farhi, S. Gutmann, and</i></font>
<a name="line-21"></a><font color=Blue><i>-- D. A. Spielman. \"Exponential algorithmic speedup by a quantum</i></font>
<a name="line-22"></a><font color=Blue><i>-- walk.\" </i></font>
<a name="line-23"></a><font color=Blue><i>-- /Proceedings of the 35th Annual ACM Symposium on Theory of Computing/, </i></font>
<a name="line-24"></a><font color=Blue><i>-- pp. 59&#8211;68, 2003. See also &lt;<a href="http://arxiv.org/abs/quant-ph/0209131">http://arxiv.org/abs/quant-ph/0209131</a>&gt;.</i></font>
<a name="line-25"></a><font color=Blue><i>-- </i></font>
<a name="line-26"></a><font color=Blue><i>-- The present implementation is based on detailed algorithm and</i></font>
<a name="line-27"></a><font color=Blue><i>-- oracle specifications that were provided to us by the IARPA QCS</i></font>
<a name="line-28"></a><font color=Blue><i>-- program and written by Travis Humble.</i></font>
<a name="line-29"></a><font color=Blue><i>-- </i></font>
<a name="line-30"></a><font color=Blue><i>-- Modules:</i></font>
<a name="line-31"></a><font color=Blue><i>-- </i></font>
<a name="line-32"></a><font color=Blue><i>-- * "Algorithms.BWT.Main": Command line interface.</i></font>
<a name="line-33"></a><font color=Blue><i>-- </i></font>
<a name="line-34"></a><font color=Blue><i>-- * "Algorithms.BWT.Definitions": Some general-purpose definitions.</i></font>
<a name="line-35"></a><font color=Blue><i>-- </i></font>
<a name="line-36"></a><font color=Blue><i>-- * "Algorithms.BWT.BWT": The implementation of the main Binary</i></font>
<a name="line-37"></a><font color=Blue><i>-- Welded Tree algorithm and oracle, using a more-or-less imperative</i></font>
<a name="line-38"></a><font color=Blue><i>-- programming style.</i></font>
<a name="line-39"></a><font color=Blue><i>-- </i></font>
<a name="line-40"></a><font color=Blue><i>-- * "Algorithms.BWT.Alternative": Alternate implementations of the</i></font>
<a name="line-41"></a><font color=Blue><i>-- main algorithm and various oracles, using a more functional</i></font>
<a name="line-42"></a><font color=Blue><i>-- programming style.</i></font>
<a name="line-43"></a><font color=Blue><i>-- </i></font>
<a name="line-44"></a><font color=Blue><i>-- * "Algorithms.BWT.Template": Another oracle implementation, using</i></font>
<a name="line-45"></a><font color=Blue><i>-- Quipper's \"build_circuit\" feature to automatically extract a</i></font>
<a name="line-46"></a><font color=Blue><i>-- quantum circuit from a classical functional program.</i></font>
<a name="line-47"></a><font color=Blue><i>-- </i></font>
<a name="line-48"></a><font color=Blue><i>-- * "Algorithms.BWT.Simulate": Functions for simulating, testing, and</i></font>
<a name="line-49"></a><font color=Blue><i>-- debugging oracles.</i></font>
<a name="line-50"></a>
<a name="line-51"></a><font color=Green><u>module</u></font> Algorithms<font color=Cyan>.</font>BWT<font color=Cyan>.</font>Main <font color=Green><u>where</u></font>
<a name="line-52"></a>
<a name="line-53"></a><font color=Green><u>import</u></font> Quipper
<a name="line-54"></a>
<a name="line-55"></a><font color=Green><u>import</u></font> QuipperLib<font color=Cyan>.</font>Decompose
<a name="line-56"></a>
<a name="line-57"></a><font color=Green><u>import</u></font> <font color=Green><u>qualified</u></font> Algorithms<font color=Cyan>.</font>BWT<font color=Cyan>.</font>BWT <font color=Green><u>as</u></font> BWT
<a name="line-58"></a><font color=Green><u>import</u></font> <font color=Green><u>qualified</u></font> Algorithms<font color=Cyan>.</font>BWT<font color=Cyan>.</font>Simulate <font color=Green><u>as</u></font> Simulate
<a name="line-59"></a><font color=Green><u>import</u></font> <font color=Green><u>qualified</u></font> Algorithms<font color=Cyan>.</font>BWT<font color=Cyan>.</font>Alternative <font color=Green><u>as</u></font> Alternative
<a name="line-60"></a><font color=Green><u>import</u></font> <font color=Green><u>qualified</u></font> Algorithms<font color=Cyan>.</font>BWT<font color=Cyan>.</font>Template <font color=Green><u>as</u></font> Template
<a name="line-61"></a>
<a name="line-62"></a><font color=Green><u>import</u></font> Libraries<font color=Cyan>.</font>CommandLine
<a name="line-63"></a>
<a name="line-64"></a><font color=Green><u>import</u></font> System<font color=Cyan>.</font>Console<font color=Cyan>.</font>GetOpt
<a name="line-65"></a><font color=Green><u>import</u></font> System<font color=Cyan>.</font>Environment    
<a name="line-66"></a><font color=Green><u>import</u></font> System<font color=Cyan>.</font>Exit
<a name="line-67"></a><font color=Green><u>import</u></font> System<font color=Cyan>.</font>IO
<a name="line-68"></a><font color=Green><u>import</u></font> Control<font color=Cyan>.</font>Monad
<a name="line-69"></a><font color=Green><u>import</u></font> Data<font color=Cyan>.</font>List
<a name="line-70"></a><font color=Green><u>import</u></font> Data<font color=Cyan>.</font>Char
<a name="line-71"></a>
<a name="line-72"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-73"></a><font color=Blue><i>-- * Command line interface</i></font>
<a name="line-74"></a>
<a name="line-75"></a><font color=Blue><i>-- $ This module provides a command line interface for the Binary</i></font>
<a name="line-76"></a><font color=Blue><i>-- Welded Tree algorithm. This allows the user, for example, to plug</i></font>
<a name="line-77"></a><font color=Blue><i>-- in different oracles, show different parts of the circuit, select a</i></font>
<a name="line-78"></a><font color=Blue><i>-- gate base, simulate, select parameters such as /n/ and /s/, and</i></font>
<a name="line-79"></a><font color=Blue><i>-- select different output formats.</i></font>
<a name="line-80"></a>
<a name="line-81"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-82"></a><font color=Blue><i>-- * Option processing</i></font>
<a name="line-83"></a>
<a name="line-84"></a><a name="WhatToShow"></a><font color=Blue><i>-- | An enumeration type for determining what the main function should do.</i></font>
<a name="line-85"></a><a name="WhatToShow"></a><font color=Green><u>data</u></font> WhatToShow <font color=Red>=</font> 
<a name="line-86"></a>  Circuit     <font color=Blue><i>-- ^Show the whole circuit.</i></font>
<a name="line-87"></a>  <font color=Red>|</font> Oracle    <font color=Blue><i>-- ^Show only the oracle.</i></font>
<a name="line-88"></a>  <font color=Red>|</font> Graph     <font color=Blue><i>-- ^Show colored edges computed from oracle simulation.</i></font>
<a name="line-89"></a>  <font color=Red>|</font> OracleC   <font color=Blue><i>-- ^Show the \"classical\" oracle as a classical circuit.</i></font>
<a name="line-90"></a>  <font color=Red>|</font> Simulate  <font color=Blue><i>-- ^Run simulations of individual circuit fragments.</i></font>
<a name="line-91"></a>  <font color=Green><u>deriving</u></font> Show
<a name="line-92"></a>
<a name="line-93"></a><a name="OracleSelect"></a><font color=Blue><i>-- | An enumeration type for selecting an oracle.</i></font>
<a name="line-94"></a><a name="OracleSelect"></a><font color=Green><u>data</u></font> OracleSelect <font color=Red>=</font>
<a name="line-95"></a>  Orthodox     <font color=Blue><i>-- ^The \"orthodox\" oracle. </i></font>
<a name="line-96"></a>  <font color=Red>|</font> Simple     <font color=Blue><i>-- ^The \"simple\" oracle.</i></font>
<a name="line-97"></a>  <font color=Red>|</font> Blackbox   <font color=Blue><i>-- ^A blackbox oracle.</i></font>
<a name="line-98"></a>  <font color=Red>|</font> Classical  <font color=Blue><i>-- ^An oracle generated from classical program.</i></font>
<a name="line-99"></a>  <font color=Red>|</font> Template   <font color=Blue><i>-- ^An oracle automatically generated using Template Haskell.</i></font>
<a name="line-100"></a>  <font color=Red>|</font> TemplateOptim   <font color=Blue><i>-- ^An oracle automatically generated using Template Haskell, with peep-hole optimization.</i></font>
<a name="line-101"></a>  <font color=Green><u>deriving</u></font> Show
<a name="line-102"></a>
<a name="line-103"></a><a name="Options"></a><font color=Blue><i>-- | A data type to hold values set by command line options.</i></font>
<a name="line-104"></a><a name="Options"></a><font color=Green><u>data</u></font> Options <font color=Red>=</font> Options <font color=Cyan>{</font>
<a name="line-105"></a>  what <font color=Red>::</font> WhatToShow<font color=Cyan>,</font>           <font color=Blue><i>-- ^What kind of thing to output.</i></font>
<a name="line-106"></a>  format <font color=Red>::</font> Format<font color=Cyan>,</font>             <font color=Blue><i>-- ^The output format.</i></font>
<a name="line-107"></a>  gatebase <font color=Red>::</font> GateBase<font color=Cyan>,</font>         <font color=Blue><i>-- ^What kind of gates to decompose into.</i></font>
<a name="line-108"></a>  oracle <font color=Red>::</font> OracleSelect<font color=Cyan>,</font>       <font color=Blue><i>-- ^Which kind of oracle to use.</i></font>
<a name="line-109"></a>  n <font color=Red>::</font> Int<font color=Cyan>,</font>                     <font color=Blue><i>-- ^The tree height.</i></font>
<a name="line-110"></a>  c <font color=Red>::</font> Int<font color=Cyan>,</font>                     <font color=Blue><i>-- ^The color to use with @--oracle@.</i></font>
<a name="line-111"></a>  s <font color=Red>::</font> Int<font color=Cyan>,</font>                     <font color=Blue><i>-- ^The parameter /s/ to use.</i></font>
<a name="line-112"></a>  dt <font color=Red>::</font> Timestep                <font color=Blue><i>-- ^The parameter /dt/ to use.</i></font>
<a name="line-113"></a><font color=Cyan>}</font> <font color=Green><u>deriving</u></font> Show
<a name="line-114"></a>
<a name="line-115"></a><a name="defaultOptions"></a><font color=Blue><i>-- | The default options.</i></font>
<a name="line-116"></a><font color=Blue>defaultOptions</font> <font color=Red>::</font> Options
<a name="line-117"></a><font color=Blue>defaultOptions</font> <font color=Red>=</font> Options
<a name="line-118"></a>  <font color=Cyan>{</font> what <font color=Red>=</font> Circuit<font color=Cyan>,</font>
<a name="line-119"></a>    format <font color=Red>=</font> Preview<font color=Cyan>,</font>
<a name="line-120"></a>    n <font color=Red>=</font> <font color=Magenta>5</font><font color=Cyan>,</font>
<a name="line-121"></a>    c <font color=Red>=</font> <font color=Magenta>0</font><font color=Cyan>,</font>
<a name="line-122"></a>    gatebase <font color=Red>=</font> Logical<font color=Cyan>,</font>
<a name="line-123"></a>    oracle <font color=Red>=</font> Orthodox<font color=Cyan>,</font>
<a name="line-124"></a>    s <font color=Red>=</font> <font color=Magenta>1</font><font color=Cyan>,</font>
<a name="line-125"></a>    dt <font color=Red>=</font> pi<font color=Cyan>/</font><font color=Magenta>180</font>
<a name="line-126"></a>  <font color=Cyan>}</font>
<a name="line-127"></a>
<a name="line-128"></a><a name="options"></a><font color=Blue><i>-- | The list of command line options, in the format required by 'getOpt'.</i></font>
<a name="line-129"></a><font color=Blue>options</font> <font color=Red>::</font> <font color=Red>[</font>OptDescr <font color=Cyan>(</font>Options <font color=Red>-&gt;</font> IO Options<font color=Cyan>)</font><font color=Red>]</font>
<a name="line-130"></a><font color=Blue>options</font> <font color=Red>=</font>
<a name="line-131"></a>  <font color=Red>[</font> Option <font color=Red>[</font><font color=Magenta>'h'</font><font color=Red>]</font> <font color=Red>[</font><font color=Magenta>"help"</font><font color=Red>]</font>    <font color=Cyan>(</font>NoArg help<font color=Cyan>)</font>           <font color=Magenta>"print usage info and exit"</font><font color=Cyan>,</font>
<a name="line-132"></a>    Option <font color=Red>[</font><font color=Magenta>'C'</font><font color=Red>]</font> <font color=Red>[</font><font color=Magenta>"circuit"</font><font color=Red>]</font> <font color=Cyan>(</font>NoArg <font color=Cyan>(</font>what Circuit<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Magenta>"output the whole circuit (default)"</font><font color=Cyan>,</font>
<a name="line-133"></a>    Option <font color=Red>[</font><font color=Magenta>'O'</font><font color=Red>]</font> <font color=Red>[</font><font color=Magenta>"oracle"</font><font color=Red>]</font>  <font color=Cyan>(</font>NoArg <font color=Cyan>(</font>what Oracle<font color=Cyan>)</font><font color=Cyan>)</font>  <font color=Magenta>"output only the oracle"</font><font color=Cyan>,</font>
<a name="line-134"></a>    Option <font color=Red>[</font><font color=Magenta>'K'</font><font color=Red>]</font> <font color=Red>[</font><font color=Magenta>"oraclec"</font><font color=Red>]</font> <font color=Cyan>(</font>NoArg <font color=Cyan>(</font>what OracleC<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Magenta>"output the \"classical\" oracle as a classical circuit"</font><font color=Cyan>,</font>
<a name="line-135"></a>    Option <font color=Red>[</font><font color=Magenta>'G'</font><font color=Red>]</font> <font color=Red>[</font><font color=Magenta>"graph"</font><font color=Red>]</font>   <font color=Cyan>(</font>NoArg <font color=Cyan>(</font>what Graph<font color=Cyan>)</font><font color=Cyan>)</font>   <font color=Magenta>"print colored graph computed from oracle"</font><font color=Cyan>,</font>
<a name="line-136"></a>    Option <font color=Red>[</font><font color=Magenta>'S'</font><font color=Red>]</font> <font color=Red>[</font><font color=Magenta>"simulate"</font><font color=Red>]</font> <font color=Cyan>(</font>NoArg <font color=Cyan>(</font>what Simulate<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Magenta>"run simulations of some circuit fragments for tree height n"</font><font color=Cyan>,</font>
<a name="line-137"></a>    Option <font color=Red>[</font><font color=Magenta>'f'</font><font color=Red>]</font> <font color=Red>[</font><font color=Magenta>"format"</font><font color=Red>]</font>  <font color=Cyan>(</font>ReqArg format <font color=Magenta>"&lt;format&gt;"</font><font color=Cyan>)</font> <font color=Magenta>"output format for circuits (default: preview)"</font><font color=Cyan>,</font>
<a name="line-138"></a>    Option <font color=Red>[</font><font color=Magenta>'g'</font><font color=Red>]</font> <font color=Red>[</font><font color=Magenta>"gatebase"</font><font color=Red>]</font> <font color=Cyan>(</font>ReqArg gatebase <font color=Magenta>"&lt;gatebase&gt;"</font><font color=Cyan>)</font> <font color=Magenta>"type of gates to decompose into (default: logical)"</font><font color=Cyan>,</font>
<a name="line-139"></a>    Option <font color=Red>[</font><font color=Magenta>'o'</font><font color=Red>]</font> []          <font color=Cyan>(</font>ReqArg oracle <font color=Magenta>"&lt;oracle&gt;"</font><font color=Cyan>)</font> <font color=Magenta>"select oracle to use (default: orthodox)"</font><font color=Cyan>,</font>
<a name="line-140"></a>    Option <font color=Red>[</font><font color=Magenta>'n'</font><font color=Red>]</font> <font color=Red>[</font><font color=Magenta>"height"</font><font color=Red>]</font>  <font color=Cyan>(</font>ReqArg height <font color=Magenta>"&lt;n&gt;"</font><font color=Cyan>)</font>  <font color=Magenta>"set tree height (positive; default 5)"</font><font color=Cyan>,</font>
<a name="line-141"></a>    Option <font color=Red>[</font><font color=Magenta>'c'</font><font color=Red>]</font> <font color=Red>[</font><font color=Magenta>"color"</font><font color=Red>]</font>   <font color=Cyan>(</font>ReqArg color <font color=Magenta>"&lt;c&gt;"</font><font color=Cyan>)</font>   <font color=Magenta>"color to use with --oracle (0..3, default 0)"</font><font color=Cyan>,</font>
<a name="line-142"></a>    Option <font color=Red>[</font><font color=Magenta>'s'</font><font color=Red>]</font> <font color=Red>[</font><font color=Magenta>"repeats"</font><font color=Red>]</font> <font color=Cyan>(</font>ReqArg repeats <font color=Magenta>"&lt;s&gt;"</font><font color=Cyan>)</font> <font color=Magenta>"set parameter s (iteration count; default 1)"</font><font color=Cyan>,</font>
<a name="line-143"></a>    Option <font color=Red>[</font><font color=Magenta>'l'</font><font color=Red>]</font> <font color=Red>[</font><font color=Magenta>"large"</font><font color=Red>]</font>   <font color=Cyan>(</font>NoArg large<font color=Cyan>)</font> <font color=Magenta>"set large problem size: n=300, s=336960"</font><font color=Cyan>,</font>
<a name="line-144"></a>    Option <font color=Red>[</font><font color=Magenta>'t'</font><font color=Red>]</font> <font color=Red>[</font><font color=Magenta>"dt"</font><font color=Red>]</font>      <font color=Cyan>(</font>ReqArg dt <font color=Magenta>"&lt;dt&gt;"</font><font color=Cyan>)</font>     <font color=Magenta>"set parameter dt (simulation time step; default pi/180)"</font>
<a name="line-145"></a>  <font color=Red>]</font>
<a name="line-146"></a>    <font color=Green><u>where</u></font>
<a name="line-147"></a>      what <font color=Red>::</font> WhatToShow <font color=Red>-&gt;</font> Options <font color=Red>-&gt;</font> IO Options
<a name="line-148"></a>      what w o <font color=Red>=</font> return o <font color=Cyan>{</font> what <font color=Red>=</font> w <font color=Cyan>}</font>
<a name="line-149"></a>      
<a name="line-150"></a>      height <font color=Red>::</font> String <font color=Red>-&gt;</font> Options <font color=Red>-&gt;</font> IO Options
<a name="line-151"></a>      height string o <font color=Red>=</font> 
<a name="line-152"></a>        <font color=Green><u>case</u></font> parse_int string <font color=Green><u>of</u></font>
<a name="line-153"></a>          Just n <font color=Red>|</font> n <font color=Cyan>&gt;=</font> <font color=Magenta>1</font> <font color=Red>-&gt;</font> return o <font color=Cyan>{</font> n <font color=Red>=</font> n <font color=Cyan>}</font>
<a name="line-154"></a>          <font color=Green><u>_</u></font> <font color=Red>-&gt;</font> optfail <font color=Cyan>(</font><font color=Magenta>"Invalid tree height -- "</font> <font color=Cyan>++</font> string <font color=Cyan>++</font> <font color=Magenta>"\n"</font><font color=Cyan>)</font>
<a name="line-155"></a>          
<a name="line-156"></a>      color <font color=Red>::</font> String <font color=Red>-&gt;</font> Options <font color=Red>-&gt;</font> IO Options
<a name="line-157"></a>      color string o <font color=Red>=</font>
<a name="line-158"></a>        <font color=Green><u>case</u></font> parse_int string <font color=Green><u>of</u></font> 
<a name="line-159"></a>          Just c <font color=Red>|</font> c <font color=Cyan>&gt;=</font> <font color=Magenta>0</font> <font color=Cyan>&amp;&amp;</font> c <font color=Cyan>&lt;</font> <font color=Magenta>4</font> <font color=Red>-&gt;</font> return o <font color=Cyan>{</font> c <font color=Red>=</font> c <font color=Cyan>}</font>
<a name="line-160"></a>          <font color=Green><u>_</u></font> <font color=Red>-&gt;</font> optfail <font color=Cyan>(</font><font color=Magenta>"Invalid color -- "</font> <font color=Cyan>++</font> string <font color=Cyan>++</font> <font color=Magenta>"\n"</font><font color=Cyan>)</font>
<a name="line-161"></a>
<a name="line-162"></a>      repeats <font color=Red>::</font> String <font color=Red>-&gt;</font> Options <font color=Red>-&gt;</font> IO Options
<a name="line-163"></a>      repeats string o <font color=Red>=</font>
<a name="line-164"></a>        <font color=Green><u>case</u></font> parse_int string <font color=Green><u>of</u></font> 
<a name="line-165"></a>          Just s <font color=Red>|</font> s <font color=Cyan>&gt;=</font> <font color=Magenta>0</font> <font color=Red>-&gt;</font> return o <font color=Cyan>{</font> s <font color=Red>=</font> s <font color=Cyan>}</font>
<a name="line-166"></a>          <font color=Green><u>_</u></font> <font color=Red>-&gt;</font> optfail <font color=Cyan>(</font><font color=Magenta>"Invalid value for parameter s -- "</font> <font color=Cyan>++</font> string <font color=Cyan>++</font> <font color=Magenta>"\n"</font><font color=Cyan>)</font>
<a name="line-167"></a>
<a name="line-168"></a>      large <font color=Red>::</font> Options <font color=Red>-&gt;</font> IO Options
<a name="line-169"></a>      large o <font color=Red>=</font> return o <font color=Cyan>{</font> s <font color=Red>=</font> <font color=Magenta>336960</font><font color=Cyan>,</font> n <font color=Red>=</font> <font color=Magenta>300</font> <font color=Cyan>}</font>
<a name="line-170"></a>
<a name="line-171"></a>      dt <font color=Red>::</font> String <font color=Red>-&gt;</font> Options <font color=Red>-&gt;</font> IO Options
<a name="line-172"></a>      dt string o <font color=Red>=</font>
<a name="line-173"></a>        <font color=Green><u>case</u></font> parse_double string <font color=Green><u>of</u></font> 
<a name="line-174"></a>          Just dt <font color=Red>-&gt;</font> return o <font color=Cyan>{</font> dt <font color=Red>=</font> dt <font color=Cyan>}</font>
<a name="line-175"></a>          <font color=Green><u>_</u></font> <font color=Red>-&gt;</font> optfail <font color=Cyan>(</font><font color=Magenta>"Invalid value for parameter dt -- "</font> <font color=Cyan>++</font> string <font color=Cyan>++</font> <font color=Magenta>"\n"</font><font color=Cyan>)</font>
<a name="line-176"></a>
<a name="line-177"></a>      format <font color=Red>::</font> String <font color=Red>-&gt;</font> Options <font color=Red>-&gt;</font> IO Options
<a name="line-178"></a>      format str o <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-179"></a>        <font color=Green><u>case</u></font> match_enum format_enum str <font color=Green><u>of</u></font>
<a name="line-180"></a>          <font color=Red>[</font><font color=Cyan>(</font><font color=Green><u>_</u></font><font color=Cyan>,</font> f<font color=Cyan>)</font><font color=Red>]</font> <font color=Red>-&gt;</font> return o <font color=Cyan>{</font> format <font color=Red>=</font> f <font color=Cyan>}</font>
<a name="line-181"></a>          [] <font color=Red>-&gt;</font> optfail <font color=Cyan>(</font><font color=Magenta>"Unknown format -- "</font> <font color=Cyan>++</font> str <font color=Cyan>++</font> <font color=Magenta>"\n"</font><font color=Cyan>)</font>
<a name="line-182"></a>          <font color=Green><u>_</u></font> <font color=Red>-&gt;</font> optfail <font color=Cyan>(</font><font color=Magenta>"Ambiguous format -- "</font> <font color=Cyan>++</font> str <font color=Cyan>++</font> <font color=Magenta>"\n"</font><font color=Cyan>)</font>
<a name="line-183"></a>
<a name="line-184"></a>      gatebase <font color=Red>::</font> String <font color=Red>-&gt;</font> Options <font color=Red>-&gt;</font> IO Options
<a name="line-185"></a>      gatebase str o <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-186"></a>        <font color=Green><u>case</u></font> match_enum gatebase_enum str <font color=Green><u>of</u></font>
<a name="line-187"></a>          <font color=Red>[</font><font color=Cyan>(</font><font color=Green><u>_</u></font><font color=Cyan>,</font> f<font color=Cyan>)</font><font color=Red>]</font> <font color=Red>-&gt;</font> return o <font color=Cyan>{</font> gatebase <font color=Red>=</font> f <font color=Cyan>}</font>
<a name="line-188"></a>          [] <font color=Red>-&gt;</font> optfail <font color=Cyan>(</font><font color=Magenta>"Unknown gate base -- "</font> <font color=Cyan>++</font> str <font color=Cyan>++</font> <font color=Magenta>"\n"</font><font color=Cyan>)</font>
<a name="line-189"></a>          <font color=Green><u>_</u></font> <font color=Red>-&gt;</font> optfail <font color=Cyan>(</font><font color=Magenta>"Ambiguous gate base -- "</font> <font color=Cyan>++</font> str <font color=Cyan>++</font> <font color=Magenta>"\n"</font><font color=Cyan>)</font>
<a name="line-190"></a>
<a name="line-191"></a>      oracle <font color=Red>::</font> String <font color=Red>-&gt;</font> Options <font color=Red>-&gt;</font> IO Options
<a name="line-192"></a>      oracle str o <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-193"></a>        <font color=Green><u>case</u></font> match_enum oracle_enum str <font color=Green><u>of</u></font>
<a name="line-194"></a>          <font color=Red>[</font><font color=Cyan>(</font><font color=Green><u>_</u></font><font color=Cyan>,</font> f<font color=Cyan>)</font><font color=Red>]</font> <font color=Red>-&gt;</font> return o <font color=Cyan>{</font> oracle <font color=Red>=</font> f <font color=Cyan>}</font>
<a name="line-195"></a>          [] <font color=Red>-&gt;</font> optfail <font color=Cyan>(</font><font color=Magenta>"Unknown oracle -- "</font> <font color=Cyan>++</font> str <font color=Cyan>++</font> <font color=Magenta>"\n"</font><font color=Cyan>)</font>
<a name="line-196"></a>          <font color=Green><u>_</u></font> <font color=Red>-&gt;</font> optfail <font color=Cyan>(</font><font color=Magenta>"Ambiguous oracle -- "</font> <font color=Cyan>++</font> str <font color=Cyan>++</font> <font color=Magenta>"\n"</font><font color=Cyan>)</font>
<a name="line-197"></a>
<a name="line-198"></a>      help <font color=Red>::</font> Options <font color=Red>-&gt;</font> IO Options
<a name="line-199"></a>      help o <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-200"></a>        usage
<a name="line-201"></a>        exitSuccess
<a name="line-202"></a>
<a name="line-203"></a>      n_def <font color=Red>=</font> show <font color=Cyan>(</font>n defaultOptions<font color=Cyan>)</font>
<a name="line-204"></a>      c_def <font color=Red>=</font> show <font color=Cyan>(</font>c defaultOptions<font color=Cyan>)</font>
<a name="line-205"></a>      
<a name="line-206"></a><a name="oracle_enum"></a><font color=Blue><i>-- | An enumeration of available oracles and their names.</i></font>
<a name="line-207"></a><font color=Blue>oracle_enum</font> <font color=Red>::</font> <font color=Red>[</font><font color=Cyan>(</font>String<font color=Cyan>,</font> OracleSelect<font color=Cyan>)</font><font color=Red>]</font>
<a name="line-208"></a><font color=Blue>oracle_enum</font> <font color=Red>=</font> <font color=Red>[</font>
<a name="line-209"></a>  <font color=Cyan>(</font><font color=Magenta>"orthodox"</font><font color=Cyan>,</font> Orthodox<font color=Cyan>)</font><font color=Cyan>,</font>
<a name="line-210"></a>  <font color=Cyan>(</font><font color=Magenta>"simple"</font><font color=Cyan>,</font> Simple<font color=Cyan>)</font><font color=Cyan>,</font>
<a name="line-211"></a>  <font color=Cyan>(</font><font color=Magenta>"blackbox"</font><font color=Cyan>,</font> Blackbox<font color=Cyan>)</font><font color=Cyan>,</font>
<a name="line-212"></a>  <font color=Cyan>(</font><font color=Magenta>"classical"</font><font color=Cyan>,</font> Classical<font color=Cyan>)</font><font color=Cyan>,</font>
<a name="line-213"></a>  <font color=Cyan>(</font><font color=Magenta>"template"</font><font color=Cyan>,</font> Template<font color=Cyan>)</font><font color=Cyan>,</font>
<a name="line-214"></a>  <font color=Cyan>(</font><font color=Magenta>"optimized"</font><font color=Cyan>,</font> TemplateOptim<font color=Cyan>)</font>
<a name="line-215"></a>  <font color=Red>]</font>
<a name="line-216"></a>
<a name="line-217"></a><a name="dopts"></a><font color=Blue><i>-- | Process /argv/-style command line options into an 'Options' structure.</i></font>
<a name="line-218"></a><font color=Blue>dopts</font> <font color=Red>::</font> <font color=Red>[</font>String<font color=Red>]</font> <font color=Red>-&gt;</font> IO Options
<a name="line-219"></a><font color=Blue>dopts</font> argv <font color=Red>=</font>
<a name="line-220"></a>  <font color=Green><u>case</u></font> getOpt Permute options argv <font color=Green><u>of</u></font>
<a name="line-221"></a>    <font color=Cyan>(</font>o<font color=Cyan>,</font> []<font color=Cyan>,</font> []<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font>foldM <font color=Cyan>(</font>flip id<font color=Cyan>)</font> defaultOptions o<font color=Cyan>)</font>
<a name="line-222"></a>    <font color=Cyan>(</font><font color=Green><u>_</u></font><font color=Cyan>,</font> <font color=Green><u>_</u></font><font color=Cyan>,</font> []<font color=Cyan>)</font> <font color=Red>-&gt;</font> optfail <font color=Magenta>"Too many non-option arguments\n"</font>
<a name="line-223"></a>    <font color=Cyan>(</font><font color=Green><u>_</u></font><font color=Cyan>,</font> <font color=Green><u>_</u></font><font color=Cyan>,</font> errs<font color=Cyan>)</font> <font color=Red>-&gt;</font> optfail <font color=Cyan>(</font>concat errs<font color=Cyan>)</font>
<a name="line-224"></a>
<a name="line-225"></a><a name="usage"></a><font color=Blue><i>-- | Print usage message to 'stdout'.</i></font>
<a name="line-226"></a><font color=Blue>usage</font> <font color=Red>::</font> IO ()
<a name="line-227"></a><font color=Blue>usage</font> <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-228"></a>  putStr <font color=Cyan>(</font>usageInfo header options<font color=Cyan>)</font> 
<a name="line-229"></a>  putStr <font color=Cyan>(</font>show_enum <font color=Magenta>"format"</font> format_enum<font color=Cyan>)</font>
<a name="line-230"></a>  putStr <font color=Cyan>(</font>show_enum <font color=Magenta>"gatebase"</font> gatebase_enum<font color=Cyan>)</font>
<a name="line-231"></a>  putStr <font color=Cyan>(</font>show_enum <font color=Magenta>"oracle"</font> oracle_enum<font color=Cyan>)</font>
<a name="line-232"></a>    <font color=Green><u>where</u></font> header <font color=Red>=</font> <font color=Magenta>"Usage: bwt [OPTION...]"</font>
<a name="line-233"></a>
<a name="line-234"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-235"></a><font color=Blue><i>-- * The BWT main function</i></font>
<a name="line-236"></a>
<a name="line-237"></a><a name="main"></a><font color=Blue><i>-- | Main function: read options, then execute the appropriate task.</i></font>
<a name="line-238"></a><font color=Blue>main</font> <font color=Red>::</font> IO()
<a name="line-239"></a><font color=Blue>main</font> <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-240"></a>  argv <font color=Red>&lt;-</font> getArgs
<a name="line-241"></a>  options <font color=Red>&lt;-</font> dopts argv
<a name="line-242"></a>  <font color=Green><u>let</u></font> oracle <font color=Red>=</font> oracle_of_options options
<a name="line-243"></a>  <font color=Green><u>case</u></font> options <font color=Green><u>of</u></font>
<a name="line-244"></a>    Options <font color=Cyan>{</font> what <font color=Red>=</font> Circuit<font color=Cyan>,</font> format <font color=Red>=</font> format<font color=Cyan>,</font> gatebase <font color=Red>=</font> gatebase<font color=Cyan>,</font> s <font color=Red>=</font> s<font color=Cyan>,</font> dt <font color=Red>=</font> dt <font color=Cyan>}</font> <font color=Red>-&gt;</font> 
<a name="line-245"></a>      BWT<font color=Cyan>.</font>main_circuit format gatebase oracle s dt
<a name="line-246"></a>    Options <font color=Cyan>{</font> what <font color=Red>=</font> Oracle<font color=Cyan>,</font> c <font color=Red>=</font> c<font color=Cyan>,</font> format <font color=Red>=</font> format<font color=Cyan>,</font> gatebase <font color=Red>=</font> gatebase <font color=Cyan>}</font> <font color=Red>-&gt;</font>
<a name="line-247"></a>      BWT<font color=Cyan>.</font>main_oracle format gatebase oracle c
<a name="line-248"></a>    Options <font color=Cyan>{</font> what <font color=Red>=</font> OracleC<font color=Cyan>,</font> c <font color=Red>=</font> c<font color=Cyan>,</font> format <font color=Red>=</font> format <font color=Cyan>}</font> <font color=Red>-&gt;</font>
<a name="line-249"></a>      Alternative<font color=Cyan>.</font>main_oraclec format oracle c
<a name="line-250"></a>    Options <font color=Cyan>{</font> what <font color=Red>=</font> Graph<font color=Cyan>,</font> format <font color=Red>=</font> ASCII<font color=Cyan>,</font> gatebase <font color=Red>=</font> gatebase <font color=Cyan>}</font> <font color=Red>-&gt;</font>
<a name="line-251"></a>      Simulate<font color=Cyan>.</font>simulate_edges gatebase oracle
<a name="line-252"></a>    Options <font color=Cyan>{</font> what <font color=Red>=</font> Graph<font color=Cyan>,</font> format <font color=Red>=</font> format<font color=Cyan>,</font> oracle <font color=Red>=</font> Simple<font color=Cyan>,</font> gatebase <font color=Red>=</font> gatebase <font color=Cyan>}</font> <font color=Red>-&gt;</font> <font color=Green><u>do</u></font>
<a name="line-253"></a>      <font color=Blue><i>-- special case: if Simple, change the node numbering</i></font>
<a name="line-254"></a>      <font color=Green><u>let</u></font> doc <font color=Red>=</font> Simulate<font color=Cyan>.</font>render_oracle gatebase True oracle
<a name="line-255"></a>      print_of_document format doc
<a name="line-256"></a>    Options <font color=Cyan>{</font> what <font color=Red>=</font> Graph<font color=Cyan>,</font> format <font color=Red>=</font> format<font color=Cyan>,</font> gatebase <font color=Red>=</font> gatebase <font color=Cyan>}</font> <font color=Red>-&gt;</font> <font color=Green><u>do</u></font>
<a name="line-257"></a>      <font color=Green><u>let</u></font> doc <font color=Red>=</font> Simulate<font color=Cyan>.</font>render_oracle gatebase False oracle
<a name="line-258"></a>      print_of_document format doc
<a name="line-259"></a>    Options <font color=Cyan>{</font> what <font color=Red>=</font> Simulate<font color=Cyan>,</font> n <font color=Red>=</font> n <font color=Cyan>}</font> <font color=Red>-&gt;</font> <font color=Green><u>do</u></font>
<a name="line-260"></a>      Simulate<font color=Cyan>.</font>main_all n
<a name="line-261"></a>
<a name="line-262"></a><a name="oracle_of_options"></a><font color=Blue><i>-- | Compute the appropriate 'Oracle' for the given options.</i></font>
<a name="line-263"></a><font color=Blue>oracle_of_options</font> <font color=Red>::</font> Options <font color=Red>-&gt;</font> BWT<font color=Cyan>.</font>Oracle
<a name="line-264"></a>
<a name="line-265"></a><font color=Blue>oracle_of_options</font> Options <font color=Cyan>{</font> oracle <font color=Red>=</font> Orthodox<font color=Cyan>,</font> n <font color=Red>=</font> n <font color=Cyan>}</font> <font color=Red>=</font> 
<a name="line-266"></a>  BWT<font color=Cyan>.</font>oracle_orthodox f g
<a name="line-267"></a>  <font color=Green><u>where</u></font>
<a name="line-268"></a>    f <font color=Red>=</font> take n <font color=Cyan>(</font>True <font color=Red><b>:</b></font> False <font color=Red><b>:</b></font> f<font color=Cyan>)</font>
<a name="line-269"></a>    g <font color=Red>=</font> take n <font color=Cyan>(</font>False <font color=Red><b>:</b></font> True <font color=Red><b>:</b></font> g<font color=Cyan>)</font>
<a name="line-270"></a>              
<a name="line-271"></a><font color=Blue>oracle_of_options</font> Options <font color=Cyan>{</font> oracle <font color=Red>=</font> Simple <font color=Cyan>}</font> <font color=Red>=</font> 
<a name="line-272"></a>  Alternative<font color=Cyan>.</font>convert_oracle <font color=Cyan>(</font>Alternative<font color=Cyan>.</font>oracle_simple<font color=Cyan>)</font>
<a name="line-273"></a>
<a name="line-274"></a><font color=Blue>oracle_of_options</font> Options <font color=Cyan>{</font> oracle <font color=Red>=</font> Blackbox<font color=Cyan>,</font> n <font color=Red>=</font> n <font color=Cyan>}</font> <font color=Red>=</font> 
<a name="line-275"></a>  Alternative<font color=Cyan>.</font>convert_oracle <font color=Cyan>(</font>Alternative<font color=Cyan>.</font>oracle_blackbox n<font color=Cyan>)</font>
<a name="line-276"></a>
<a name="line-277"></a><font color=Blue>oracle_of_options</font> Options <font color=Cyan>{</font> oracle <font color=Red>=</font> Classical<font color=Cyan>,</font> n <font color=Red>=</font> n <font color=Cyan>}</font> <font color=Red>=</font> 
<a name="line-278"></a>  Alternative<font color=Cyan>.</font>convert_oracle <font color=Cyan>(</font>Alternative<font color=Cyan>.</font>oracle_classical f g<font color=Cyan>)</font>
<a name="line-279"></a>  <font color=Green><u>where</u></font>
<a name="line-280"></a>    f <font color=Red>=</font> take n <font color=Cyan>(</font>True <font color=Red><b>:</b></font> False <font color=Red><b>:</b></font> f<font color=Cyan>)</font>
<a name="line-281"></a>    g <font color=Red>=</font> take n <font color=Cyan>(</font>False <font color=Red><b>:</b></font> True <font color=Red><b>:</b></font> g<font color=Cyan>)</font>
<a name="line-282"></a>
<a name="line-283"></a><font color=Blue>oracle_of_options</font> Options <font color=Cyan>{</font> oracle <font color=Red>=</font> Template<font color=Cyan>,</font> n <font color=Red>=</font> n <font color=Cyan>}</font> <font color=Red>=</font>
<a name="line-284"></a>  Alternative<font color=Cyan>.</font>convert_oracle <font color=Cyan>(</font>Template<font color=Cyan>.</font>oracle_template f g<font color=Cyan>)</font>
<a name="line-285"></a>  <font color=Green><u>where</u></font>
<a name="line-286"></a>    f <font color=Red>=</font> take n <font color=Cyan>(</font>True <font color=Red><b>:</b></font> False <font color=Red><b>:</b></font> f<font color=Cyan>)</font>
<a name="line-287"></a>    g <font color=Red>=</font> take n <font color=Cyan>(</font>False <font color=Red><b>:</b></font> True <font color=Red><b>:</b></font> g<font color=Cyan>)</font>
<a name="line-288"></a>
<a name="line-289"></a><font color=Blue>oracle_of_options</font> Options <font color=Cyan>{</font> oracle <font color=Red>=</font> TemplateOptim<font color=Cyan>,</font> n <font color=Red>=</font> n <font color=Cyan>}</font> <font color=Red>=</font>
<a name="line-290"></a>  Alternative<font color=Cyan>.</font>convert_oracle <font color=Cyan>(</font>Template<font color=Cyan>.</font>oracle_template_optim f g<font color=Cyan>)</font>
<a name="line-291"></a>  <font color=Green><u>where</u></font>
<a name="line-292"></a>    f <font color=Red>=</font> take n <font color=Cyan>(</font>True <font color=Red><b>:</b></font> False <font color=Red><b>:</b></font> f<font color=Cyan>)</font>
<a name="line-293"></a>    g <font color=Red>=</font> take n <font color=Cyan>(</font>False <font color=Red><b>:</b></font> True <font color=Red><b>:</b></font> g<font color=Cyan>)</font>
<a name="line-294"></a>
</pre>
</body>
</html>