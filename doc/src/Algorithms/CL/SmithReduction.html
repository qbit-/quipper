<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>Haskell code</title>
</head>
<body>
<pre><a name="line-1"></a><font color=Blue><i>-- | This module provides functions for reducing (non-square) matrices </i></font>
<a name="line-2"></a><font color=Blue><i>-- towards Smith Normal Form, and hence for computing the structure of </i></font>
<a name="line-3"></a><font color=Blue><i>-- finitely-presented Abelian groups.</i></font>
<a name="line-4"></a><font color=Blue><i>--</i></font>
<a name="line-5"></a><font color=Blue><i>-- The SNF transformation is similar to Gaussian elimination, but over integer matrices,</i></font>
<a name="line-6"></a><font color=Blue><i>-- (more generally, matrices over any principal ideal domain)</i></font>
<a name="line-7"></a><font color=Blue><i>--</i></font>
<a name="line-8"></a><font color=Blue><i>-- For background on how this is used to compute the structure of Abelian groups,</i></font>
<a name="line-9"></a><font color=Blue><i>-- see the MathOverflow question &lt;<a href="http://mathoverflow.net/questions/12009/">http://mathoverflow.net/questions/12009/</a>&gt;,</i></font>
<a name="line-10"></a><font color=Blue><i>-- in particular Greg Kuperberg&#8217;s answer &lt;<a href="http://mathoverflow.net/questions/12009#12053">http://mathoverflow.net/questions/12009#12053</a>&gt;.</i></font>
<a name="line-11"></a><font color=Blue><i>-- </i></font>
<a name="line-12"></a><font color=Blue><i>-- We do not implement full SNF reduction here, but rather just as much as is</i></font>
<a name="line-13"></a><font color=Blue><i>-- needed to compute the structure of finitely presented Abelian groups from</i></font>
<a name="line-14"></a><font color=Blue><i>-- matrix presentations.</i></font>
<a name="line-15"></a>
<a name="line-16"></a><font color=Green><u>module</u></font> Algorithms<font color=Cyan>.</font>CL<font color=Cyan>.</font>SmithReduction <font color=Green><u>where</u></font>
<a name="line-17"></a>
<a name="line-18"></a><font color=Green><u>import</u></font> Data<font color=Cyan>.</font>Array
<a name="line-19"></a><font color=Green><u>import</u></font> Algorithms<font color=Cyan>.</font>CL<font color=Cyan>.</font>Auxiliary
<a name="line-20"></a>
<a name="line-21"></a><font color=Blue><i>-- * Matrix type and basic access functions.</i></font>
<a name="line-22"></a>
<a name="line-23"></a><a name="CLMatrix"></a><font color=Blue><i>-- | A data type to hold an /m/&#215;/n/ matrix (/M/[sub /ij/]),</i></font>
<a name="line-24"></a><a name="CLMatrix"></a><font color=Blue><i>-- with entries from an arbitrary type @a@.</i></font>
<a name="line-25"></a><a name="CLMatrix"></a><font color=Blue><i>-- </i></font>
<a name="line-26"></a><a name="CLMatrix"></a><font color=Blue><i>-- The fields are: integers /m/ and /n/; a flag /t/ to indicate that a matrix</i></font>
<a name="line-27"></a><a name="CLMatrix"></a><font color=Blue><i>-- should be considered formally transposed; and an /m/&#215;/n/ array /M/</i></font>
<a name="line-28"></a><a name="CLMatrix"></a><font color=Blue><i>-- containing the entries.  When /t/ is 'False', /m/ is the number of rows,</i></font>
<a name="line-29"></a><a name="CLMatrix"></a><font color=Blue><i>-- and /n/ the number of columns; when /t/ is 'True', this is reversed.</i></font>
<a name="line-30"></a><a name="CLMatrix"></a><font color=Blue><i>--</i></font>
<a name="line-31"></a><a name="CLMatrix"></a><font color=Blue><i>-- (The point of the flag is to allow efficient transposition, and hence to</i></font>
<a name="line-32"></a><a name="CLMatrix"></a><font color=Blue><i>-- allow operations on rows to be implemented in terms of the corresponding</i></font>
<a name="line-33"></a><a name="CLMatrix"></a><font color=Blue><i>-- operations on columns without loss of efficiency.) </i></font>
<a name="line-34"></a><a name="CLMatrix"></a><font color=Green><u>data</u></font> CLMatrix a <font color=Red>=</font> CLMatrix Int Int Bool <font color=Cyan>(</font>Array <font color=Cyan>(</font>Int<font color=Cyan>,</font> Int<font color=Cyan>)</font> a<font color=Cyan>)</font> <font color=Green><u>deriving</u></font> <font color=Cyan>(</font>Show<font color=Cyan>)</font>
<a name="line-35"></a>
<a name="line-36"></a><a name="transpose"></a><font color=Blue><i>-- | The transpose of a matrix</i></font>
<a name="line-37"></a><font color=Blue>transpose</font> <font color=Red>::</font> CLMatrix a <font color=Red>-&gt;</font> CLMatrix a
<a name="line-38"></a><font color=Blue>transpose</font> <font color=Cyan>(</font>CLMatrix m n t mtx<font color=Cyan>)</font> <font color=Red>=</font> CLMatrix m n <font color=Cyan>(</font>not t<font color=Cyan>)</font> mtx
<a name="line-39"></a>
<a name="line-40"></a><a name="rows"></a><font color=Blue><i>-- | The number of rows of a matrix</i></font>
<a name="line-41"></a><font color=Blue>rows</font> <font color=Red>::</font> CLMatrix a <font color=Red>-&gt;</font> Int
<a name="line-42"></a><font color=Blue>rows</font> <font color=Cyan>(</font>CLMatrix m n t <font color=Green><u>_</u></font><font color=Cyan>)</font> <font color=Red>=</font> <font color=Green><u>if</u></font> t <font color=Green><u>then</u></font> n <font color=Green><u>else</u></font> m
<a name="line-43"></a>
<a name="line-44"></a><a name="cols"></a><font color=Blue><i>-- | The number of columns of a matrix</i></font>
<a name="line-45"></a><font color=Blue>cols</font> <font color=Red>::</font> CLMatrix a <font color=Red>-&gt;</font> Int
<a name="line-46"></a><font color=Blue>cols</font> <font color=Cyan>(</font>CLMatrix m n t <font color=Green><u>_</u></font><font color=Cyan>)</font> <font color=Red>=</font> <font color=Green><u>if</u></font> t <font color=Green><u>then</u></font> m <font color=Green><u>else</u></font> n
<a name="line-47"></a>
<a name="line-48"></a><a name="row_list"></a><font color=Blue><i>-- | The row indices of a matrix.</i></font>
<a name="line-49"></a><font color=Blue>row_list</font> <font color=Red>::</font> CLMatrix a <font color=Red>-&gt;</font> <font color=Red>[</font>Int<font color=Red>]</font>
<a name="line-50"></a><font color=Blue>row_list</font> m <font color=Red>=</font> <font color=Red>[</font><font color=Magenta>0</font><font color=Red>..</font><font color=Cyan>(</font><font color=Cyan>(</font>rows m<font color=Cyan>)</font><font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>)</font><font color=Red>]</font>
<a name="line-51"></a>
<a name="line-52"></a><a name="col_list"></a><font color=Blue><i>-- | The column indices of a matrix.</i></font>
<a name="line-53"></a><font color=Blue>col_list</font> <font color=Red>::</font> CLMatrix a <font color=Red>-&gt;</font> <font color=Red>[</font>Int<font color=Red>]</font>
<a name="line-54"></a><font color=Blue>col_list</font> m <font color=Red>=</font> <font color=Red>[</font><font color=Magenta>0</font><font color=Red>..</font><font color=Cyan>(</font><font color=Cyan>(</font>cols m<font color=Cyan>)</font><font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>)</font><font color=Red>]</font>
<a name="line-55"></a>
<a name="line-56"></a><a name="idx"></a><font color=Blue><i>-- | An index tuple for a matrix, at a given row and column</i></font>
<a name="line-57"></a><font color=Blue>idx</font> <font color=Red>::</font> CLMatrix a <font color=Red>-&gt;</font> Int <font color=Red>-&gt;</font> Int <font color=Red>-&gt;</font> <font color=Cyan>(</font>Int<font color=Cyan>,</font> Int<font color=Cyan>)</font>
<a name="line-58"></a><font color=Blue>idx</font> <font color=Cyan>(</font>CLMatrix <font color=Green><u>_</u></font> <font color=Green><u>_</u></font> t <font color=Green><u>_</u></font><font color=Cyan>)</font> i j <font color=Red>=</font> <font color=Green><u>if</u></font> t <font color=Green><u>then</u></font> <font color=Cyan>(</font>j<font color=Cyan>,</font>i<font color=Cyan>)</font> <font color=Green><u>else</u></font> <font color=Cyan>(</font>i<font color=Cyan>,</font>j<font color=Cyan>)</font>
<a name="line-59"></a>
<a name="line-60"></a><font color=Green><u>infix</u></font> <font color=Magenta>9</font> <font color=Cyan>!!!</font>
<a name="line-61"></a>
<a name="line-62"></a><a name="!!!"></a><font color=Blue><i>-- | The matrix entry at a given row and column</i></font>
<a name="line-63"></a><font color=Cyan>(</font><font color=Cyan>!!!</font><font color=Cyan>)</font> <font color=Red>::</font> CLMatrix a <font color=Red>-&gt;</font> <font color=Cyan>(</font>Int<font color=Cyan>,</font>Int<font color=Cyan>)</font> <font color=Red>-&gt;</font> a
<a name="line-64"></a><font color=Cyan>(</font><font color=Cyan>!!!</font><font color=Cyan>)</font> mm<font color=Red>@</font><font color=Cyan>(</font>CLMatrix m n t mtx<font color=Cyan>)</font> <font color=Cyan>(</font>i<font color=Cyan>,</font>j<font color=Cyan>)</font> <font color=Red>=</font>
<a name="line-65"></a>    <font color=Green><u>if</u></font> <font color=Cyan>(</font>i <font color=Cyan>&gt;=</font> rows mm <font color=Cyan>||</font> j <font color=Cyan>&gt;=</font> cols mm<font color=Cyan>)</font>
<a name="line-66"></a>        <font color=Green><u>then</u></font> error <font color=Cyan>$</font> <font color=Magenta>"Matrix entry lookup (!!!): bad index i="</font> <font color=Cyan>++</font> show i <font color=Cyan>++</font> <font color=Magenta>", j="</font> <font color=Cyan>++</font> show j
<a name="line-67"></a>        <font color=Green><u>else</u></font> mtx <font color=Cyan>!</font> idx mm i j
<a name="line-68"></a>
<a name="line-69"></a><font color=Green><u>infixl</u></font> <font color=Magenta>9</font> <font color=Cyan>///</font>
<a name="line-70"></a>
<a name="line-71"></a><a name="///"></a><font color=Blue><i>-- | Update a matrix by a list of (/i/,/j/,/m_i_j/) pairs</i></font>
<a name="line-72"></a><font color=Blue><i>-- (all indexes assumed in range of original matrix).</i></font>
<a name="line-73"></a><font color=Cyan>(</font><font color=Cyan>///</font><font color=Cyan>)</font> <font color=Red>::</font> CLMatrix a <font color=Red>-&gt;</font> <font color=Red>[</font><font color=Cyan>(</font>Int<font color=Cyan>,</font>Int<font color=Cyan>,</font>a<font color=Cyan>)</font><font color=Red>]</font> <font color=Red>-&gt;</font> CLMatrix a
<a name="line-74"></a><font color=Cyan>(</font><font color=Cyan>///</font><font color=Cyan>)</font> mm<font color=Red>@</font><font color=Cyan>(</font>CLMatrix m n t mtx<font color=Cyan>)</font> l <font color=Red>=</font>
<a name="line-75"></a>    CLMatrix m n t <font color=Cyan>(</font>mtx <font color=Cyan>//</font> <font color=Red>[</font> <font color=Cyan>(</font>idx mm i j<font color=Cyan>,</font>e<font color=Cyan>)</font> <font color=Red>|</font> <font color=Cyan>(</font>i<font color=Cyan>,</font>j<font color=Cyan>,</font>e<font color=Cyan>)</font> <font color=Red>&lt;-</font> l <font color=Red>]</font><font color=Cyan>)</font>
<a name="line-76"></a>
<a name="line-77"></a><a name="matrix_from_list"></a><font color=Blue><i>-- | Construct an 'CLMatrix' from a list such as @[[1,0],[4,-5]]@.</i></font>
<a name="line-78"></a><font color=Blue><i>--</i></font>
<a name="line-79"></a><font color=Blue><i>-- Assumes that all inner lists are the same length, </i></font>
<a name="line-80"></a><font color=Blue><i>-- and that the overall list is of length &#8805;1.</i></font>
<a name="line-81"></a><font color=Blue>matrix_from_list</font> <font color=Red>::</font> <font color=Red>[</font><font color=Red>[</font>a<font color=Red>]</font><font color=Red>]</font> <font color=Red>-&gt;</font> CLMatrix a
<a name="line-82"></a><font color=Blue>matrix_from_list</font> [] <font color=Red>=</font> error <font color=Magenta>"matrixFromList: empty list"</font>
<a name="line-83"></a><font color=Blue>matrix_from_list</font> rs<font color=Red>@</font><font color=Cyan>(</font>r0<font color=Red><b>:</b></font><font color=Green><u>_</u></font><font color=Cyan>)</font> <font color=Red>=</font> CLMatrix <font color=Cyan>(</font>length rs<font color=Cyan>)</font> <font color=Cyan>(</font>length r0<font color=Cyan>)</font> False <font color=Cyan>$</font>
<a name="line-84"></a>   array <font color=Cyan>(</font><font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font><font color=Magenta>0</font><font color=Cyan>)</font><font color=Cyan>,</font> <font color=Cyan>(</font>length rs <font color=Blue><i>-</i></font> <font color=Magenta>1</font><font color=Cyan>,</font> length r0 <font color=Blue><i>-</i></font> <font color=Magenta>1</font><font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-85"></a>   <font color=Red>[</font> <font color=Cyan>(</font><font color=Cyan>(</font>i<font color=Cyan>,</font>j<font color=Cyan>)</font><font color=Cyan>,</font>x<font color=Cyan>)</font> <font color=Red>|</font> <font color=Cyan>(</font>ri<font color=Cyan>,</font>i<font color=Cyan>)</font> <font color=Red>&lt;-</font> zip rs <font color=Red>[</font><font color=Magenta>0</font><font color=Red>..</font><font color=Red>]</font><font color=Cyan>,</font> <font color=Cyan>(</font>x<font color=Cyan>,</font>j<font color=Cyan>)</font> <font color=Red>&lt;-</font> zip ri <font color=Red>[</font><font color=Magenta>0</font><font color=Red>..</font><font color=Red>]</font> <font color=Red>]</font>
<a name="line-86"></a>
<a name="line-87"></a><a name="delete_row"></a><font color=Blue><i>-- | Delete a row of a matrix</i></font>
<a name="line-88"></a><font color=Blue>delete_row</font> <font color=Red>::</font> Int <font color=Red>-&gt;</font> CLMatrix a <font color=Red>-&gt;</font> CLMatrix a
<a name="line-89"></a><font color=Blue>delete_row</font> i0 mm<font color=Red>@</font><font color=Cyan>(</font>CLMatrix m n t mtx<font color=Cyan>)</font> <font color=Red>=</font>
<a name="line-90"></a>  <font color=Green><u>if</u></font> <font color=Magenta>0</font> <font color=Cyan>&lt;=</font> i0 <font color=Cyan>&amp;&amp;</font> i0 <font color=Cyan>&lt;</font> rows mm 
<a name="line-91"></a>  <font color=Green><u>then</u></font>
<a name="line-92"></a>    <font color=Green><u>if</u></font> t <font color=Green><u>then</u></font> CLMatrix m <font color=Cyan>(</font>n<font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>)</font> t <font color=Cyan>$</font> ixmap <font color=Cyan>(</font><font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font><font color=Magenta>0</font><font color=Cyan>)</font><font color=Cyan>,</font><font color=Cyan>(</font>m<font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>,</font>n<font color=Blue><i>-</i></font><font color=Magenta>2</font><font color=Cyan>)</font><font color=Cyan>)</font> <font color=Cyan>(</font><font color=Red>\</font><font color=Cyan>(</font>j<font color=Cyan>,</font>i<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font>j<font color=Cyan>,</font>f i<font color=Cyan>)</font><font color=Cyan>)</font> mtx
<a name="line-93"></a>    <font color=Green><u>else</u></font> CLMatrix <font color=Cyan>(</font>m<font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>)</font> n t <font color=Cyan>$</font> ixmap <font color=Cyan>(</font><font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font><font color=Magenta>0</font><font color=Cyan>)</font><font color=Cyan>,</font><font color=Cyan>(</font>m<font color=Blue><i>-</i></font><font color=Magenta>2</font><font color=Cyan>,</font>n<font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>)</font><font color=Cyan>)</font> <font color=Cyan>(</font><font color=Red>\</font><font color=Cyan>(</font>i<font color=Cyan>,</font>j<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font>f i<font color=Cyan>,</font>j<font color=Cyan>)</font><font color=Cyan>)</font> mtx
<a name="line-94"></a>  <font color=Green><u>else</u></font> error <font color=Magenta>"delete_row: row out of range"</font>
<a name="line-95"></a>    <font color=Green><u>where</u></font> f i <font color=Red>=</font> <font color=Green><u>if</u></font> i <font color=Cyan>&lt;</font> i0 <font color=Green><u>then</u></font> i <font color=Green><u>else</u></font> i<font color=Cyan>+</font><font color=Magenta>1</font>
<a name="line-96"></a>
<a name="line-97"></a><a name="delete_col"></a><font color=Blue><i>-- | Delete the first column of a matrix</i></font>
<a name="line-98"></a><font color=Blue>delete_col</font> <font color=Red>::</font> Int <font color=Red>-&gt;</font> CLMatrix a <font color=Red>-&gt;</font> CLMatrix a
<a name="line-99"></a><font color=Blue>delete_col</font> j0 <font color=Red>=</font> transpose <font color=Cyan>.</font> <font color=Cyan>(</font>delete_row j0<font color=Cyan>)</font> <font color=Cyan>.</font> transpose
<a name="line-100"></a>
<a name="line-101"></a><font color=Blue><i>-- * Smith reduction</i></font>
<a name="line-102"></a>
<a name="line-103"></a><a name="elim_entry_with_pivot"></a><font color=Blue><i>-- | @'elim_entry_with_pivot' /M/ /i/ /j/ /j'/@: apply elementary column operations </i></font>
<a name="line-104"></a><font color=Blue><i>-- to /M/ (equivalently, post-multiply by an invertible matrix) to</i></font>
<a name="line-105"></a><font color=Blue><i>-- obtain /M'/ such that /M'/[sub /i/,/j/] is gcd(/M/[sub /i/,/j/], /M/[sub /i/,/j'/])</i></font>
<a name="line-106"></a><font color=Blue><i>-- and /M'/[sub /i/,/j'/] is 0.</i></font>
<a name="line-107"></a><font color=Blue>elim_entry_with_pivot</font> <font color=Red>::</font> <font color=Cyan>(</font>Integral int<font color=Cyan>)</font> <font color=Red>=&gt;</font> CLMatrix int <font color=Red>-&gt;</font> Int <font color=Red>-&gt;</font> Int <font color=Red>-&gt;</font> Int <font color=Red>-&gt;</font> CLMatrix int
<a name="line-108"></a><font color=Blue>elim_entry_with_pivot</font> m i0 j0 j1 <font color=Red>=</font>
<a name="line-109"></a>  <font color=Green><u>let</u></font> a <font color=Red>=</font> m <font color=Cyan>!!!</font> <font color=Cyan>(</font>i0<font color=Cyan>,</font>j0<font color=Cyan>)</font>
<a name="line-110"></a>      b <font color=Red>=</font> m <font color=Cyan>!!!</font> <font color=Cyan>(</font>i0<font color=Cyan>,</font>j1<font color=Cyan>)</font>
<a name="line-111"></a>  <font color=Green><u>in</u></font> <font color=Green><u>if</u></font> <font color=Cyan>(</font>a <font color=Cyan>==</font> <font color=Magenta>0</font> <font color=Cyan>&amp;&amp;</font> b <font color=Cyan>==</font> <font color=Magenta>0</font><font color=Cyan>)</font> <font color=Green><u>then</u></font> m
<a name="line-112"></a>  <font color=Green><u>else</u></font>
<a name="line-113"></a>  <font color=Green><u>let</u></font> <font color=Cyan>(</font>d<font color=Cyan>,</font>x<font color=Cyan>,</font>y<font color=Cyan>)</font> <font color=Red>=</font> extended_euclid a b
<a name="line-114"></a>      a' <font color=Red>=</font> a <font color=Cyan>`div`</font> d
<a name="line-115"></a>      b' <font color=Red>=</font> b <font color=Cyan>`div`</font> d
<a name="line-116"></a>  <font color=Blue><i>-- know that [x a + y b == d] and [d /= 0], so the matrix [[x,y],[&#8722;b',a']]</i></font>
<a name="line-117"></a>  <font color=Blue><i>-- is invertible; so premultiplication by it does not change the group</i></font>
<a name="line-118"></a>  <font color=Blue><i>-- presentation (and indeed could be obtained as a combination of elementary</i></font>
<a name="line-119"></a>  <font color=Blue><i>-- column operations).</i></font>
<a name="line-120"></a>  <font color=Green><u>in</u></font> m <font color=Cyan>///</font> <font color=Red>[</font> <font color=Cyan>(</font>i<font color=Cyan>,</font>j0<font color=Cyan>,</font> <font color=Cyan>(</font>x <font color=Cyan>*</font> m <font color=Cyan>!!!</font> <font color=Cyan>(</font>i<font color=Cyan>,</font>j0<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Cyan>+</font> <font color=Cyan>(</font>y <font color=Cyan>*</font> m <font color=Cyan>!!!</font> <font color=Cyan>(</font>i<font color=Cyan>,</font>j1<font color=Cyan>)</font><font color=Cyan>)</font><font color=Cyan>)</font> <font color=Red>|</font> i <font color=Red>&lt;-</font> row_list m <font color=Red>]</font>
<a name="line-121"></a>       <font color=Cyan>///</font> <font color=Red>[</font> <font color=Cyan>(</font>i<font color=Cyan>,</font>j1<font color=Cyan>,</font> <font color=Cyan>(</font><font color=Blue><i>-</i></font>b' <font color=Cyan>*</font> m <font color=Cyan>!!!</font> <font color=Cyan>(</font>i<font color=Cyan>,</font>j0<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Cyan>+</font> <font color=Cyan>(</font>a' <font color=Cyan>*</font> m <font color=Cyan>!!!</font> <font color=Cyan>(</font>i<font color=Cyan>,</font>j1<font color=Cyan>)</font><font color=Cyan>)</font><font color=Cyan>)</font> <font color=Red>|</font> i <font color=Red>&lt;-</font> row_list m<font color=Red>]</font> 
<a name="line-122"></a>
<a name="line-123"></a><a name="clean_first_row"></a><font color=Blue><i>-- | Given a matrix, repeatedly use 'elim_entry_with_pivot' to put the</i></font>
<a name="line-124"></a><font color=Blue><i>-- top row into clean form (/d/,0,&#8230;,0).</i></font>
<a name="line-125"></a><font color=Blue>clean_first_row</font> <font color=Red>::</font> <font color=Cyan>(</font>Integral int<font color=Cyan>)</font> <font color=Red>=&gt;</font> CLMatrix int <font color=Red>-&gt;</font> CLMatrix int
<a name="line-126"></a><font color=Blue>clean_first_row</font> m0 <font color=Red>=</font>
<a name="line-127"></a>  foldl <font color=Cyan>(</font><font color=Red>\</font>m j <font color=Red>-&gt;</font> elim_entry_with_pivot m <font color=Magenta>0</font> <font color=Magenta>0</font> j<font color=Cyan>)</font> m0 <font color=Cyan>(</font>tail <font color=Cyan>$</font> col_list m0<font color=Cyan>)</font>
<a name="line-128"></a>
<a name="line-129"></a><a name="clean_first_col"></a><font color=Blue><i>-- | Dual to 'clean_first_row'.</i></font>
<a name="line-130"></a><font color=Blue>clean_first_col</font> <font color=Red>::</font> <font color=Cyan>(</font>Integral int<font color=Cyan>)</font> <font color=Red>=&gt;</font> CLMatrix int <font color=Red>-&gt;</font> CLMatrix int
<a name="line-131"></a><font color=Blue>clean_first_col</font> <font color=Red>=</font> transpose <font color=Cyan>.</font> clean_first_row <font color=Cyan>.</font> transpose
<a name="line-132"></a>
<a name="line-133"></a><a name="clean_first_row_col"></a><font color=Blue><i>-- | Given a matrix, repeatedly apply 'clean_first_row' and its analogue</i></font>
<a name="line-134"></a><font color=Blue><i>-- on columns until the first row and column are both in clean form.</i></font>
<a name="line-135"></a><font color=Blue>clean_first_row_col</font> <font color=Red>::</font> <font color=Cyan>(</font>Integral int<font color=Cyan>)</font> <font color=Red>=&gt;</font> CLMatrix int <font color=Red>-&gt;</font> CLMatrix int
<a name="line-136"></a><font color=Blue>clean_first_row_col</font> m <font color=Red>=</font>
<a name="line-137"></a>  <font color=Green><u>if</u></font> not <font color=Cyan>$</font> all <font color=Cyan>(</font><font color=Cyan>==</font><font color=Magenta>0</font><font color=Cyan>)</font> <font color=Red>[</font> m <font color=Cyan>!!!</font> <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font>j<font color=Cyan>)</font> <font color=Red>|</font> j <font color=Red>&lt;-</font> tail <font color=Cyan>$</font> col_list m <font color=Red>]</font>
<a name="line-138"></a>  <font color=Green><u>then</u></font> clean_first_row_col <font color=Cyan>$</font> clean_first_row m
<a name="line-139"></a>  <font color=Green><u>else</u></font> <font color=Green><u>if</u></font> not <font color=Cyan>$</font> all <font color=Cyan>(</font><font color=Cyan>==</font><font color=Magenta>0</font><font color=Cyan>)</font> <font color=Red>[</font> m <font color=Cyan>!!!</font> <font color=Cyan>(</font>i<font color=Cyan>,</font><font color=Magenta>0</font><font color=Cyan>)</font> <font color=Red>|</font> i <font color=Red>&lt;-</font> tail <font color=Cyan>$</font> row_list m <font color=Red>]</font>
<a name="line-140"></a>  <font color=Green><u>then</u></font> clean_first_row_col <font color=Cyan>$</font> clean_first_col m
<a name="line-141"></a>  <font color=Green><u>else</u></font> m
<a name="line-142"></a>
<a name="line-143"></a><font color=Blue><i>-- * Structure of Abelian Groups</i></font>
<a name="line-144"></a>
<a name="line-145"></a><a name="structure_constants_from_matrix"></a><font color=Blue><i>-- | Given a matrix, taken as presenting an Abelian group (with generators</i></font>
<a name="line-146"></a><font color=Blue><i>-- corresponding to columns of the matrix, and relations specified by the </i></font>
<a name="line-147"></a><font color=Blue><i>-- rows), compute the structure constants of the group, not necessarily sorted.</i></font>
<a name="line-148"></a><font color=Blue><i>--</i></font>
<a name="line-149"></a><font color=Blue><i>-- That is, return a list of natural numbers [/n/[sub 0],&#8230;,/n/[sub /s/]] </i></font>
<a name="line-150"></a><font color=Blue><i>-- such that the group given by the input presentation is isomorphic to the</i></font>
<a name="line-151"></a><font color=Blue><i>-- product of the cyclic groups &#8484;\/(/n/[sub /i/]).</i></font>
<a name="line-152"></a><font color=Blue>structure_constants_from_matrix</font>  <font color=Red>::</font> <font color=Cyan>(</font>Show int<font color=Cyan>,</font> Integral int<font color=Cyan>)</font> <font color=Red>=&gt;</font> CLMatrix int <font color=Red>-&gt;</font> <font color=Red>[</font>int<font color=Red>]</font>
<a name="line-153"></a><font color=Blue>structure_constants_from_matrix</font> m <font color=Red>=</font>
<a name="line-154"></a>  <font color=Green><u>if</u></font> cols m <font color=Cyan>==</font> <font color=Magenta>0</font> <font color=Green><u>then</u></font> []
<a name="line-155"></a>  <font color=Green><u>else</u></font> <font color=Green><u>if</u></font> rows m <font color=Cyan>==</font> <font color=Magenta>0</font> <font color=Green><u>then</u></font> <font color=Cyan>(</font>replicate <font color=Cyan>(</font>cols m<font color=Cyan>)</font> <font color=Magenta>0</font><font color=Cyan>)</font> 
<a name="line-156"></a>  <font color=Green><u>else</u></font> <font color=Green><u>let</u></font> m' <font color=Red>=</font> clean_first_row_col m 
<a name="line-157"></a>  <font color=Green><u>in</u></font> <font color=Cyan>(</font>abs <font color=Cyan>$</font> m' <font color=Cyan>!!!</font> <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font><font color=Magenta>0</font><font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-158"></a>     <font color=Red><b>:</b></font> <font color=Cyan>(</font>structure_constants_from_matrix <font color=Cyan>$</font> delete_row <font color=Magenta>0</font> <font color=Cyan>$</font> delete_col <font color=Magenta>0</font> m'<font color=Cyan>)</font>
<a name="line-159"></a>
<a name="line-160"></a><a name="group_order_from_matrix"></a><font color=Blue><i>-- | Given a matrix, taken as presenting an Abelian group,</i></font>
<a name="line-161"></a><font color=Blue><i>-- compute the order of the group.</i></font>
<a name="line-162"></a><font color=Blue><i>--</i></font>
<a name="line-163"></a><font color=Blue><i>-- Returns 0 if the group is of infinite order.</i></font>
<a name="line-164"></a><font color=Blue>group_order_from_matrix</font> <font color=Red>::</font> <font color=Cyan>(</font>Show int<font color=Cyan>,</font> Integral int<font color=Cyan>)</font> <font color=Red>=&gt;</font> CLMatrix int <font color=Red>-&gt;</font> int
<a name="line-165"></a><font color=Blue>group_order_from_matrix</font> <font color=Red>=</font> product <font color=Cyan>.</font> structure_constants_from_matrix
</pre>
</body>
</html>