<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>Haskell code</title>
</head>
<body>
<pre><a name="line-1"></a><font color=Blue><i>-- | A Quipper library for synthesizing Clifford+/T/ circuits directly</i></font>
<a name="line-2"></a><font color=Blue><i>-- from a matrix description or Euler angle description of a unitary</i></font>
<a name="line-3"></a><font color=Blue><i>-- operator. This library provides both exact and approximate</i></font>
<a name="line-4"></a><font color=Blue><i>-- synthesis.</i></font>
<a name="line-5"></a>
<a name="line-6"></a><font color=Green><u>module</u></font> QuipperLib<font color=Cyan>.</font>Synthesis <font color=Green><u>where</u></font>
<a name="line-7"></a>
<a name="line-8"></a><font color=Green><u>import</u></font> Quipper
<a name="line-9"></a>
<a name="line-10"></a><font color=Green><u>import</u></font> Quipper<font color=Cyan>.</font>Internal
<a name="line-11"></a>
<a name="line-12"></a><font color=Green><u>import</u></font> Quantum<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>CliffordT
<a name="line-13"></a><font color=Green><u>import</u></font> Quantum<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>MultiQubitSynthesis
<a name="line-14"></a><font color=Green><u>import</u></font> Quantum<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>Ring
<a name="line-15"></a><font color=Green><u>import</u></font> Quantum<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>Matrix
<a name="line-16"></a><font color=Green><u>import</u></font> Quantum<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>Newsynth
<a name="line-17"></a><font color=Green><u>import</u></font> Quantum<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>SymReal
<a name="line-18"></a><font color=Green><u>import</u></font> Quantum<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>EulerAngles
<a name="line-19"></a>
<a name="line-20"></a><font color=Green><u>import</u></font> Libraries<font color=Cyan>.</font>Auxiliary <font color=Cyan>(</font>boollist_of_int_bh<font color=Cyan>)</font>
<a name="line-21"></a>
<a name="line-22"></a><font color=Green><u>import</u></font> Control<font color=Cyan>.</font>Monad <font color=Cyan>(</font>when<font color=Cyan>)</font>
<a name="line-23"></a><font color=Green><u>import</u></font> Data<font color=Cyan>.</font>Bits <font color=Cyan>(</font>xor<font color=Cyan>,</font> <font color=Cyan>(</font><font color=Cyan>.&amp;.</font><font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-24"></a><font color=Green><u>import</u></font> System<font color=Cyan>.</font>Random
<a name="line-25"></a><font color=Green><u>import</u></font> Text<font color=Cyan>.</font>Printf
<a name="line-26"></a>
<a name="line-27"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-28"></a><font color=Blue><i>-- * Precision</i></font>
<a name="line-29"></a>
<a name="line-30"></a><a name="Precision"></a><font color=Blue><i>-- | A type to measure precision. Precision is expressed as a number</i></font>
<a name="line-31"></a><a name="Precision"></a><font color=Blue><i>-- /b/ of bits, i.e., binary digits, so that &#949; = 2[sup &#8722;/b/].</i></font>
<a name="line-32"></a><a name="Precision"></a><font color=Green><u>type</u></font> Precision <font color=Red>=</font> Double
<a name="line-33"></a>
<a name="line-34"></a><a name="bits"></a><font color=Blue><i>-- | Binary digits, as a unit of precision. For example, the following</i></font>
<a name="line-35"></a><font color=Blue><i>-- specifies a precision of 20 binary digits:</i></font>
<a name="line-36"></a><font color=Blue><i>-- </i></font>
<a name="line-37"></a><font color=Blue><i>-- &gt; prec = 20 * bits</i></font>
<a name="line-38"></a><font color=Blue>bits</font> <font color=Red>::</font> Precision
<a name="line-39"></a><font color=Blue>bits</font> <font color=Red>=</font> <font color=Magenta>1</font>
<a name="line-40"></a>
<a name="line-41"></a><a name="digits"></a><font color=Blue><i>-- | Decimal digits, as a unit of precision. For example, the</i></font>
<a name="line-42"></a><font color=Blue><i>-- following specifies a precision of 30 decimal digits:</i></font>
<a name="line-43"></a><font color=Blue><i>-- </i></font>
<a name="line-44"></a><font color=Blue><i>-- &gt; prec = 30 * digits</i></font>
<a name="line-45"></a><font color=Blue>digits</font> <font color=Red>::</font> Precision
<a name="line-46"></a><font color=Blue>digits</font> <font color=Red>=</font> logBase <font color=Magenta>2</font> <font color=Magenta>10</font>
<a name="line-47"></a>
<a name="line-48"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-49"></a><font color=Blue><i>-- * Phase</i></font>
<a name="line-50"></a>
<a name="line-51"></a><a name="KeepPhase"></a><font color=Blue><i>-- | A boolean flag indicating whether to respect global phases</i></font>
<a name="line-52"></a><a name="KeepPhase"></a><font color=Blue><i>-- during circuit synthesis ('True') or disregard them ('False').</i></font>
<a name="line-53"></a><a name="KeepPhase"></a><font color=Green><u>type</u></font> KeepPhase <font color=Red>=</font> Bool
<a name="line-54"></a>    
<a name="line-55"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-56"></a><font color=Blue><i>-- * Auxiliary functions</i></font>
<a name="line-57"></a>
<a name="line-58"></a><a name="apply_gate_at"></a><font color=Blue><i>-- | Apply a gate (from the type 'Gate' of Clifford+/T/ operators) to</i></font>
<a name="line-59"></a><font color=Blue><i>-- the given 'Qubit'.</i></font>
<a name="line-60"></a><font color=Blue>apply_gate_at</font> <font color=Red>::</font> Gate <font color=Red>-&gt;</font> Qubit <font color=Red>-&gt;</font> Circ ()
<a name="line-61"></a><font color=Blue>apply_gate_at</font> X q <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-62"></a>  gate_X_at q
<a name="line-63"></a><font color=Blue>apply_gate_at</font> Y q <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-64"></a>  gate_Y_at q
<a name="line-65"></a><font color=Blue>apply_gate_at</font> Z q <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-66"></a>  gate_Z_at q
<a name="line-67"></a><font color=Blue>apply_gate_at</font> H q <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-68"></a>  hadamard_at q
<a name="line-69"></a><font color=Blue>apply_gate_at</font> S q <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-70"></a>  gate_S_at q
<a name="line-71"></a><font color=Blue>apply_gate_at</font> T q <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-72"></a>  gate_T_at q
<a name="line-73"></a><font color=Blue>apply_gate_at</font> E q <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-74"></a>  gate_E_at q
<a name="line-75"></a><font color=Blue>apply_gate_at</font> W q <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-76"></a>  gate_omega_at q
<a name="line-77"></a>
<a name="line-78"></a><a name="apply_gates_at"></a><font color=Blue><i>-- | Apply a gate list (from the type 'Gate' of Clifford+/T/</i></font>
<a name="line-79"></a><font color=Blue><i>-- operators) to the given 'Qubit'. </i></font>
<a name="line-80"></a><font color=Blue><i>-- </i></font>
<a name="line-81"></a><font color=Blue><i>-- Note: the operators in the list are applied right-to-left, i.e.,</i></font>
<a name="line-82"></a><font color=Blue><i>-- the gate list is assumed given in matrix multiplication order, but</i></font>
<a name="line-83"></a><font color=Blue><i>-- are applied in circuit order.</i></font>
<a name="line-84"></a><font color=Blue>apply_gates_at</font> <font color=Red>::</font> <font color=Red>[</font>Gate<font color=Red>]</font> <font color=Red>-&gt;</font> Qubit <font color=Red>-&gt;</font> Circ ()
<a name="line-85"></a><font color=Blue>apply_gates_at</font> gates q <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-86"></a>  sequence_ <font color=Red>[</font> apply_gate_at g q <font color=Red>|</font> g <font color=Red>&lt;-</font> reverse gates <font color=Red>]</font>
<a name="line-87"></a>
<a name="line-88"></a><a name="apply_gates2_at"></a><font color=Blue><i>-- | Like 'apply_gates_at', but apply the same list of gates to two</i></font>
<a name="line-89"></a><font color=Blue><i>-- qubits in parallel.</i></font>
<a name="line-90"></a><font color=Blue>apply_gates2_at</font> <font color=Red>::</font> <font color=Red>[</font>Gate<font color=Red>]</font> <font color=Red>-&gt;</font> Qubit <font color=Red>-&gt;</font> Qubit <font color=Red>-&gt;</font> Circ ()
<a name="line-91"></a><font color=Blue>apply_gates2_at</font> gates q1 q2 <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-92"></a>  sequence_ <font color=Red>[</font> <font color=Green><u>do</u></font>
<a name="line-93"></a>                 apply_gate_at g q1
<a name="line-94"></a>                 apply_gate_at g q2
<a name="line-95"></a>            <font color=Red>|</font> g <font color=Red>&lt;-</font> reverse gates <font color=Red>]</font>
<a name="line-96"></a>
<a name="line-97"></a><a name="twolevel"></a><font color=Blue><i>-- | Input two indices /i/ and /j/, a list of qubits /qlist/, and an</i></font>
<a name="line-98"></a><font color=Blue><i>-- imperative-style single-qubit gate /U/. Apply the two-level</i></font>
<a name="line-99"></a><font color=Blue><i>-- operator /U/[sub /i/,/j/] to /qlist/. Intended usage:</i></font>
<a name="line-100"></a><font color=Blue><i>-- </i></font>
<a name="line-101"></a><font color=Blue><i>-- &gt; twolevel i j qlist gate_U_at</i></font>
<a name="line-102"></a><font color=Blue><i>-- </i></font>
<a name="line-103"></a><font color=Blue><i>-- The qubits in /qlist/ are ordered lexicographically left-to-right,</i></font>
<a name="line-104"></a><font color=Blue><i>-- e.g., [|00&#9002;, |01&#9002;, |10&#9002;, |11&#9002;].</i></font>
<a name="line-105"></a><font color=Blue><i>-- </i></font>
<a name="line-106"></a><font color=Blue><i>-- This function implements an improved version of Gray codes.</i></font>
<a name="line-107"></a><font color=Blue>twolevel</font> <font color=Red>::</font> Index <font color=Red>-&gt;</font> Index <font color=Red>-&gt;</font> <font color=Red>[</font>Qubit<font color=Red>]</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font>Qubit <font color=Red>-&gt;</font> Circ ()<font color=Cyan>)</font> <font color=Red>-&gt;</font> Circ ()
<a name="line-108"></a><font color=Blue>twolevel</font> i j qlist body <font color=Red>=</font> aux l1 l2 qlist <font color=Green><u>where</u></font>
<a name="line-109"></a>  n <font color=Red>=</font> length qlist
<a name="line-110"></a>  l1 <font color=Red>=</font> boollist_of_int_bh n i
<a name="line-111"></a>  l2 <font color=Red>=</font> boollist_of_int_bh n j
<a name="line-112"></a>
<a name="line-113"></a>  aux [] [] [] <font color=Red>=</font> error <font color=Magenta>"twolevel: i=j"</font>
<a name="line-114"></a>  aux <font color=Cyan>(</font>h1<font color=Red><b>:</b></font>t1<font color=Cyan>)</font> <font color=Cyan>(</font>h2<font color=Red><b>:</b></font>t2<font color=Cyan>)</font> <font color=Cyan>(</font>q<font color=Red><b>:</b></font>qs<font color=Cyan>)</font>
<a name="line-115"></a>    <font color=Red>|</font> h1 <font color=Cyan>==</font> h2 <font color=Red>=</font>
<a name="line-116"></a>      with_controls <font color=Cyan>(</font>q <font color=Cyan>.==.</font> h1<font color=Cyan>)</font> <font color=Cyan>$</font> <font color=Green><u>do</u></font>
<a name="line-117"></a>        aux t1 t2 qs
<a name="line-118"></a>    <font color=Red>|</font> h1 <font color=Cyan>==</font> True <font color=Red>=</font>
<a name="line-119"></a>      with_basis_change <font color=Cyan>(</font>qnot_at q<font color=Cyan>)</font> <font color=Cyan>$</font> <font color=Green><u>do</u></font>
<a name="line-120"></a>        aux2 t1 t2 q qs
<a name="line-121"></a>    <font color=Red>|</font> otherwise <font color=Red>=</font>
<a name="line-122"></a>      aux2 t1 t2 q qs
<a name="line-123"></a>  aux <font color=Green><u>_</u></font> <font color=Green><u>_</u></font> <font color=Green><u>_</u></font> <font color=Red>=</font> error <font color=Magenta>"twolevel: internal error 1"</font> <font color=Blue><i>-- not reached</i></font>
<a name="line-124"></a>
<a name="line-125"></a>  aux2 [] [] q [] <font color=Red>=</font>
<a name="line-126"></a>    body q
<a name="line-127"></a>  aux2 <font color=Cyan>(</font>h1<font color=Red><b>:</b></font>t1<font color=Cyan>)</font> <font color=Cyan>(</font>h2<font color=Red><b>:</b></font>t2<font color=Cyan>)</font> q0 <font color=Cyan>(</font>q<font color=Red><b>:</b></font>qs<font color=Cyan>)</font>
<a name="line-128"></a>    <font color=Red>|</font> h1 <font color=Cyan>==</font> h2 <font color=Red>=</font>
<a name="line-129"></a>      with_controls <font color=Cyan>(</font>q <font color=Cyan>.==.</font> h1<font color=Cyan>)</font> <font color=Cyan>$</font> <font color=Green><u>do</u></font>
<a name="line-130"></a>        aux2 t1 t2 q0 qs
<a name="line-131"></a>    <font color=Red>|</font> otherwise <font color=Red>=</font>
<a name="line-132"></a>      with_basis_change <font color=Cyan>(</font>qnot_at q <font color=Cyan>`controlled`</font> q0<font color=Cyan>)</font> <font color=Cyan>$</font> <font color=Green><u>do</u></font>
<a name="line-133"></a>        with_controls <font color=Cyan>(</font>q <font color=Cyan>.==.</font> h1<font color=Cyan>)</font> <font color=Cyan>$</font> <font color=Green><u>do</u></font>
<a name="line-134"></a>          aux2 t1 t2 q0 qs
<a name="line-135"></a>  aux2 <font color=Green><u>_</u></font> <font color=Green><u>_</u></font> <font color=Green><u>_</u></font> <font color=Green><u>_</u></font> <font color=Red>=</font> error <font color=Magenta>"twolevel: internal error 2"</font> <font color=Blue><i>-- not reached</i></font>
<a name="line-136"></a>
<a name="line-137"></a><a name="gate_T_power_at"></a><font color=Blue><i>-- | Apply a /T/[sup /m/] gate. This gate is decomposed into /Z/, /S/,</i></font>
<a name="line-138"></a><font color=Blue><i>-- /S/[sup &#8224;], /T/, and /T/[sup &#8224;] gates.</i></font>
<a name="line-139"></a><font color=Blue>gate_T_power_at</font> <font color=Red>::</font> Int <font color=Red>-&gt;</font> Qubit <font color=Red>-&gt;</font> Circ ()
<a name="line-140"></a><font color=Blue>gate_T_power_at</font> <font color=Magenta>0</font> q <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-141"></a>  return ()
<a name="line-142"></a><font color=Blue>gate_T_power_at</font> <font color=Magenta>1</font> q <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-143"></a>  gate_T_at q
<a name="line-144"></a><font color=Blue>gate_T_power_at</font> <font color=Magenta>2</font> q <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-145"></a>  gate_S_at q
<a name="line-146"></a><font color=Blue>gate_T_power_at</font> <font color=Magenta>3</font> q <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-147"></a>  gate_S_at q
<a name="line-148"></a>  gate_T_at q
<a name="line-149"></a><font color=Blue>gate_T_power_at</font> <font color=Magenta>4</font> q <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-150"></a>  gate_Z_at q
<a name="line-151"></a><font color=Blue>gate_T_power_at</font> <font color=Magenta>5</font> q <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-152"></a>  gate_Z_at q
<a name="line-153"></a>  gate_T_at q
<a name="line-154"></a><font color=Blue>gate_T_power_at</font> <font color=Magenta>6</font> q <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-155"></a>  gate_S_inv_at q
<a name="line-156"></a><font color=Blue>gate_T_power_at</font> <font color=Magenta>7</font> q <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-157"></a>  gate_T_inv_at q
<a name="line-158"></a><font color=Blue>gate_T_power_at</font> m q <font color=Red>=</font> gate_T_power_at <font color=Cyan>(</font>m <font color=Cyan>`mod`</font> <font color=Magenta>8</font><font color=Cyan>)</font> q
<a name="line-159"></a>
<a name="line-160"></a><a name="apply_twolevel_at"></a><font color=Blue><i>-- | Apply a 'TwoLevel' gate to the given list of qubits. </i></font>
<a name="line-161"></a><font color=Blue><i>-- The qubits in /qlist/ are ordered lexicographically left-to-right,</i></font>
<a name="line-162"></a><font color=Blue><i>-- e.g., [|00&#9002;, |01&#9002;, |10&#9002;, |11&#9002;].</i></font>
<a name="line-163"></a><font color=Blue>apply_twolevel_at</font> <font color=Red>::</font> TwoLevel <font color=Red>-&gt;</font> <font color=Red>[</font>Qubit<font color=Red>]</font> <font color=Red>-&gt;</font> Circ ()
<a name="line-164"></a><font color=Blue>apply_twolevel_at</font> <font color=Cyan>(</font>TL_X i j<font color=Cyan>)</font> qlist <font color=Red>=</font>
<a name="line-165"></a>  twolevel i j qlist <font color=Cyan>$</font> <font color=Red>\</font>q <font color=Red>-&gt;</font> <font color=Green><u>do</u></font>
<a name="line-166"></a>    gate_X_at q
<a name="line-167"></a><font color=Blue>apply_twolevel_at</font> <font color=Cyan>(</font>TL_H i j<font color=Cyan>)</font> qlist <font color=Red>=</font>
<a name="line-168"></a>  twolevel i j qlist <font color=Cyan>$</font> <font color=Red>\</font>q <font color=Red>-&gt;</font> <font color=Green><u>do</u></font>
<a name="line-169"></a>    hadamard_at q
<a name="line-170"></a><font color=Blue>apply_twolevel_at</font> <font color=Cyan>(</font>TL_T m i j<font color=Cyan>)</font> qlist
<a name="line-171"></a>  <font color=Red>|</font> m <font color=Cyan>`mod`</font> <font color=Magenta>8</font> <font color=Cyan>==</font> <font color=Magenta>0</font> <font color=Red>=</font> return ()
<a name="line-172"></a>  <font color=Red>|</font> otherwise <font color=Red>=</font>
<a name="line-173"></a>    twolevel i j qlist <font color=Cyan>$</font> <font color=Red>\</font>q <font color=Red>-&gt;</font> <font color=Green><u>do</u></font>
<a name="line-174"></a>      gate_T_power_at m q
<a name="line-175"></a><font color=Blue>apply_twolevel_at</font> <font color=Cyan>(</font>TL_omega m i<font color=Cyan>)</font> qlist
<a name="line-176"></a>  <font color=Red>|</font> m' <font color=Cyan>==</font> <font color=Magenta>0</font> <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-177"></a>    return ()
<a name="line-178"></a>  <font color=Red>|</font> qlist <font color=Cyan>==</font> [] <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-179"></a>    global_phase <font color=Cyan>(</font>fromIntegral m' <font color=Cyan>*</font> <font color=Magenta>0.25</font><font color=Cyan>)</font>
<a name="line-180"></a>  <font color=Red>|</font> otherwise <font color=Red>=</font>
<a name="line-181"></a>    apply_twolevel_at <font color=Cyan>(</font>TL_T m j i<font color=Cyan>)</font> qlist
<a name="line-182"></a>  <font color=Green><u>where</u></font>
<a name="line-183"></a>    j <font color=Red>=</font> <font color=Green><u>if</u></font> i <font color=Cyan>==</font> <font color=Magenta>0</font> <font color=Green><u>then</u></font> <font color=Magenta>1</font> <font color=Green><u>else</u></font> i <font color=Cyan>.&amp;.</font> <font color=Cyan>(</font>i<font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-184"></a>    m' <font color=Red>=</font> m <font color=Cyan>`mod`</font> <font color=Magenta>8</font>
<a name="line-185"></a>
<a name="line-186"></a><font color=Blue><i>-- | Apply a list of 'TwoLevel' gates to the given list of</i></font>
<a name="line-187"></a><font color=Blue><i>-- qubits. </i></font>
<a name="line-188"></a><font color=Blue><i>-- </i></font>
<a name="line-189"></a><font color=Blue><i>-- The qubits in /qlist/ are ordered lexicographically left-to-right,</i></font>
<a name="line-190"></a><font color=Blue><i>-- e.g., [|00&#9002;, |01&#9002;, |10&#9002;, |11&#9002;].</i></font>
<a name="line-191"></a><font color=Blue><i>-- </i></font>
<a name="line-192"></a><font color=Blue><i>-- Note: the operators in the list are applied right-to-left, i.e.,</i></font>
<a name="line-193"></a><font color=Blue><i>-- the gate list is assumed given in matrix multiplication order, but</i></font>
<a name="line-194"></a><font color=Blue><i>-- are applied in circuit order.</i></font>
<a name="line-195"></a>
<a name="line-196"></a><a name="apply_twolevels_at"></a><font color=Blue><i>-- Implementation note: this could be improved by combining</i></font>
<a name="line-197"></a><font color=Blue><i>-- consecutive two-level gates if they share the same i and j</i></font>
<a name="line-198"></a><font color=Blue>apply_twolevels_at</font> <font color=Red>::</font> <font color=Red>[</font>TwoLevel<font color=Red>]</font> <font color=Red>-&gt;</font> <font color=Red>[</font>Qubit<font color=Red>]</font> <font color=Red>-&gt;</font> Circ ()
<a name="line-199"></a><font color=Blue>apply_twolevels_at</font> ops qlist <font color=Red>=</font>
<a name="line-200"></a>  sequence_ <font color=Red>[</font> apply_twolevel_at g qlist <font color=Red>|</font> g <font color=Red>&lt;-</font> reverse ops <font color=Red>]</font>
<a name="line-201"></a>
<a name="line-202"></a><a name="apply_twolevel_alt_at"></a><font color=Blue><i>-- | Like 'apply_twolevel_at', but use the alternate generators for</i></font>
<a name="line-203"></a><font color=Blue><i>-- two-level gates.</i></font>
<a name="line-204"></a><font color=Blue>apply_twolevel_alt_at</font> <font color=Red>::</font> TwoLevelAlt <font color=Red>-&gt;</font> <font color=Red>[</font>Qubit<font color=Red>]</font> <font color=Red>-&gt;</font> Circ ()
<a name="line-205"></a><font color=Blue>apply_twolevel_alt_at</font> <font color=Cyan>(</font>TL_iX j l<font color=Cyan>)</font> qlist <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-206"></a>  twolevel j l qlist <font color=Cyan>$</font> <font color=Red>\</font>q <font color=Red>-&gt;</font> <font color=Green><u>do</u></font>
<a name="line-207"></a>    gate_iX_at q
<a name="line-208"></a><font color=Blue>apply_twolevel_alt_at</font> <font color=Cyan>(</font>TL_TiHT m j l<font color=Cyan>)</font> qlist <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-209"></a>  twolevel j l qlist <font color=Cyan>$</font> <font color=Red>\</font>q <font color=Red>-&gt;</font> <font color=Green><u>do</u></font>
<a name="line-210"></a>    <font color=Green><u>let</u></font> basischange <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-211"></a>          gate_T_power_at m q
<a name="line-212"></a>          gate_S_at q
<a name="line-213"></a>          gate_H_at q
<a name="line-214"></a>          gate_T_at q
<a name="line-215"></a>    with_basis_change basischange <font color=Cyan>$</font> <font color=Green><u>do</u></font>
<a name="line-216"></a>      gate_iX_at q
<a name="line-217"></a><font color=Blue>apply_twolevel_alt_at</font> <font color=Cyan>(</font>TL_W m j l<font color=Cyan>)</font> qlist 
<a name="line-218"></a>  <font color=Red>|</font> m' <font color=Cyan>==</font> <font color=Magenta>0</font> <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-219"></a>    return ()
<a name="line-220"></a>  <font color=Red>|</font> otherwise <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-221"></a>    twolevel j l qlist <font color=Cyan>$</font> <font color=Red>\</font>q <font color=Red>-&gt;</font> <font color=Green><u>do</u></font>
<a name="line-222"></a>      gate_iX_at q
<a name="line-223"></a>      <font color=Green><u>let</u></font> basischange <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-224"></a>            gate_T_power_at m' q
<a name="line-225"></a>      with_basis_change basischange <font color=Cyan>$</font> <font color=Green><u>do</u></font>
<a name="line-226"></a>        gate_iX_inv_at q
<a name="line-227"></a>  <font color=Green><u>where</u></font>
<a name="line-228"></a>    m' <font color=Red>=</font> m <font color=Cyan>`mod`</font> <font color=Magenta>8</font>
<a name="line-229"></a><font color=Blue>apply_twolevel_alt_at</font> <font color=Cyan>(</font>TL_omega_alt m j<font color=Cyan>)</font> qlist
<a name="line-230"></a>  <font color=Red>|</font> m' <font color=Cyan>==</font> <font color=Magenta>0</font> <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-231"></a>    return ()
<a name="line-232"></a>  <font color=Red>|</font> qlist <font color=Cyan>==</font> [] <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-233"></a>    global_phase <font color=Cyan>(</font>fromIntegral m' <font color=Cyan>*</font> <font color=Magenta>0.25</font><font color=Cyan>)</font>
<a name="line-234"></a>  <font color=Red>|</font> otherwise <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-235"></a>    apply_twolevel_at <font color=Cyan>(</font>TL_T m l j<font color=Cyan>)</font> qlist
<a name="line-236"></a>  <font color=Green><u>where</u></font>
<a name="line-237"></a>    l <font color=Red>=</font> <font color=Green><u>if</u></font> j <font color=Cyan>==</font> <font color=Magenta>0</font> <font color=Green><u>then</u></font> <font color=Magenta>1</font> <font color=Green><u>else</u></font> j <font color=Cyan>.&amp;.</font> <font color=Cyan>(</font>j<font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-238"></a>    m' <font color=Red>=</font> m <font color=Cyan>`mod`</font> <font color=Magenta>8</font>
<a name="line-239"></a>
<a name="line-240"></a><font color=Blue><i>-- | Apply a list of 'TwoLevelAlt' gates to the given list of</i></font>
<a name="line-241"></a><font color=Blue><i>-- qubits. </i></font>
<a name="line-242"></a><font color=Blue><i>-- </i></font>
<a name="line-243"></a><font color=Blue><i>-- The qubits in /qlist/ are ordered lexicographically left-to-right,</i></font>
<a name="line-244"></a><font color=Blue><i>-- e.g., [|00&#9002;, |01&#9002;, |10&#9002;, |11&#9002;].</i></font>
<a name="line-245"></a><font color=Blue><i>-- </i></font>
<a name="line-246"></a><font color=Blue><i>-- Note: the operators in the list are applied right-to-left, i.e.,</i></font>
<a name="line-247"></a><font color=Blue><i>-- the gate list is assumed given in matrix multiplication order, but</i></font>
<a name="line-248"></a><font color=Blue><i>-- are applied in circuit order.</i></font>
<a name="line-249"></a>
<a name="line-250"></a><a name="apply_twolevels_alt_at"></a><font color=Blue><i>-- Implementation note: this could be improved by combining</i></font>
<a name="line-251"></a><font color=Blue><i>-- consecutive two-level gates if they share the same i and j</i></font>
<a name="line-252"></a><font color=Blue>apply_twolevels_alt_at</font> <font color=Red>::</font> <font color=Red>[</font>TwoLevelAlt<font color=Red>]</font> <font color=Red>-&gt;</font> <font color=Red>[</font>Qubit<font color=Red>]</font> <font color=Red>-&gt;</font> Circ ()
<a name="line-253"></a><font color=Blue>apply_twolevels_alt_at</font> ops qlist <font color=Red>=</font>
<a name="line-254"></a>  sequence_ <font color=Red>[</font> apply_twolevel_alt_at g qlist <font color=Red>|</font> g <font color=Red>&lt;-</font> reverse ops <font color=Red>]</font>
<a name="line-255"></a>
<a name="line-256"></a>
<a name="line-257"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-258"></a><font color=Blue><i>-- * Single-qubit exact synthesis</i></font>
<a name="line-259"></a>
<a name="line-260"></a><a name="exact_synthesis1"></a><font color=Blue><i>-- | Decompose the given operator exactly into a single-qubit</i></font>
<a name="line-261"></a><font color=Blue><i>-- Clifford+/T/ circuit. The operator must be given in one of the</i></font>
<a name="line-262"></a><font color=Blue><i>-- available exact formats, i.e., any instance of the 'ToGates' class.</i></font>
<a name="line-263"></a><font color=Blue><i>-- Typical instances are:</i></font>
<a name="line-264"></a><font color=Blue><i>-- </i></font>
<a name="line-265"></a><font color=Blue><i>-- * 'U2' 'DRComplex': a 2&#215;2 unitary operator with entries from the</i></font>
<a name="line-266"></a><font color=Blue><i>-- ring &#8484;[1\/&#8730;2, /i/];</i></font>
<a name="line-267"></a><font color=Blue><i>-- </i></font>
<a name="line-268"></a><font color=Blue><i>-- * 'U2' 'DOmega': a 2&#215;2 unitary operator with entries from the ring</i></font>
<a name="line-269"></a><font color=Blue><i>-- [bold D][&#969;];</i></font>
<a name="line-270"></a><font color=Blue><i>-- </i></font>
<a name="line-271"></a><font color=Blue><i>-- * 'SO3' 'DRootTwo': a 3&#215;3 Bloch sphere operator with entries from the</i></font>
<a name="line-272"></a><font color=Blue><i>-- ring &#8484;[1\/&#8730;2]. In this last case, the operator will be synthesized</i></font>
<a name="line-273"></a><font color=Blue><i>-- up to an unspecified global phase.</i></font>
<a name="line-274"></a><font color=Blue>exact_synthesis1</font> <font color=Red>::</font> <font color=Cyan>(</font>ToGates a<font color=Cyan>)</font> <font color=Red>=&gt;</font> a <font color=Red>-&gt;</font> Qubit <font color=Red>-&gt;</font> Circ Qubit
<a name="line-275"></a><font color=Blue>exact_synthesis1</font> op q <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-276"></a>  comment_with_label <font color=Magenta>"ENTER: exact_synthesis1"</font> q <font color=Magenta>"q"</font>
<a name="line-277"></a>  apply_gates_at gates q
<a name="line-278"></a>  comment_with_label <font color=Magenta>"EXIT: exact_synthesis1"</font> q <font color=Magenta>"q"</font>
<a name="line-279"></a>  return q
<a name="line-280"></a>  <font color=Green><u>where</u></font>
<a name="line-281"></a>    gates <font color=Red>=</font> convert <font color=Cyan>(</font>normalize op<font color=Cyan>)</font> <font color=Red>::</font> <font color=Red>[</font>Gate<font color=Red>]</font>
<a name="line-282"></a>
<a name="line-283"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-284"></a><font color=Blue><i>-- * Multi-qubit exact synthesis</i></font>
<a name="line-285"></a>
<a name="line-286"></a><a name="exact_synthesis"></a><font color=Blue><i>-- | Decompose the given operator exactly into a Clifford+/T/ circuit.</i></font>
<a name="line-287"></a><font color=Blue><i>-- The operator must be given as an /n/&#215;/n/-matrix with coefficients</i></font>
<a name="line-288"></a><font color=Blue><i>-- in a ring that is an instance of the 'ToQRComplex' class. Typical</i></font>
<a name="line-289"></a><font color=Blue><i>-- examples of such rings are 'DRComplex', 'DOmega', and 'QRComplex'.</i></font>
<a name="line-290"></a><font color=Blue><i>-- </i></font>
<a name="line-291"></a><font color=Blue><i>-- If this function is applied to a list of /m/ qubits, then we must</i></font>
<a name="line-292"></a><font color=Blue><i>-- have /n/ &#8804; 2[sup /m/].</i></font>
<a name="line-293"></a><font color=Blue><i>-- </i></font>
<a name="line-294"></a><font color=Blue><i>-- The qubits in /qlist/ are ordered lexicographically left-to-right,</i></font>
<a name="line-295"></a><font color=Blue><i>-- e.g., [|00&#9002;, |01&#9002;, |10&#9002;, |11&#9002;].</i></font>
<a name="line-296"></a><font color=Blue><i>-- </i></font>
<a name="line-297"></a><font color=Blue><i>-- The generated circuit contains no ancillas, but may contain</i></font>
<a name="line-298"></a><font color=Blue><i>-- multi-controlled gates whose decomposition into Clifford+/T/</i></font>
<a name="line-299"></a><font color=Blue><i>-- generators requires ancillas.</i></font>
<a name="line-300"></a><font color=Blue>exact_synthesis</font> <font color=Red>::</font> <font color=Cyan>(</font>ToQOmega a<font color=Cyan>,</font> Nat n<font color=Cyan>)</font> <font color=Red>=&gt;</font> Matrix n n a <font color=Red>-&gt;</font> <font color=Red>[</font>Qubit<font color=Red>]</font> <font color=Red>-&gt;</font> Circ <font color=Red>[</font>Qubit<font color=Red>]</font>
<a name="line-301"></a><font color=Blue>exact_synthesis</font> op qlist <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-302"></a>  comment_with_label <font color=Magenta>"ENTER: exact_synthesis"</font> qlist <font color=Magenta>"q"</font>
<a name="line-303"></a>  apply_twolevels_at twolevels qlist
<a name="line-304"></a>  comment_with_label <font color=Magenta>"EXIT: exact_synthesis"</font> qlist <font color=Magenta>"q"</font>
<a name="line-305"></a>  return qlist
<a name="line-306"></a>  <font color=Green><u>where</u></font>
<a name="line-307"></a>    op_DOmega <font color=Red>=</font> matrix_map <font color=Cyan>(</font>to_dyadic <font color=Cyan>.</font> toQOmega<font color=Cyan>)</font> op
<a name="line-308"></a>    twolevels <font color=Red>=</font> synthesis_nqubit op_DOmega
<a name="line-309"></a>
<a name="line-310"></a><a name="exact_synthesis_alt"></a><font color=Blue><i>-- | Like 'exact_synthesis', but use the alternate algorithm from</i></font>
<a name="line-311"></a><font color=Blue><i>-- Section 6 of Giles-Selinger. This means all but at most one of the</i></font>
<a name="line-312"></a><font color=Blue><i>-- generated multi-controlled gates have determinant 1, which means</i></font>
<a name="line-313"></a><font color=Blue><i>-- they can be further decomposed without ancillas.</i></font>
<a name="line-314"></a><font color=Blue>exact_synthesis_alt</font> <font color=Red>::</font> <font color=Cyan>(</font>ToQOmega a<font color=Cyan>,</font> Nat n<font color=Cyan>)</font> <font color=Red>=&gt;</font> Matrix n n a <font color=Red>-&gt;</font> <font color=Red>[</font>Qubit<font color=Red>]</font> <font color=Red>-&gt;</font> Circ <font color=Red>[</font>Qubit<font color=Red>]</font>
<a name="line-315"></a><font color=Blue>exact_synthesis_alt</font> op qlist <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-316"></a>  comment_with_label <font color=Magenta>"ENTER: exact_synthesis_alt"</font> qlist <font color=Magenta>"q"</font>
<a name="line-317"></a>  apply_twolevels_alt_at twolevels qlist
<a name="line-318"></a>  comment_with_label <font color=Magenta>"EXIT: exact_synthesis_alt"</font> qlist <font color=Magenta>"q"</font>
<a name="line-319"></a>  return qlist
<a name="line-320"></a>  <font color=Green><u>where</u></font>
<a name="line-321"></a>    op_DOmega <font color=Red>=</font> matrix_map <font color=Cyan>(</font>to_dyadic <font color=Cyan>.</font> toQOmega<font color=Cyan>)</font> op
<a name="line-322"></a>    twolevels <font color=Red>=</font> synthesis_nqubit_alt op_DOmega
<a name="line-323"></a>
<a name="line-324"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-325"></a><font color=Blue><i>-- * Single-qubit approximate synthesis</i></font>
<a name="line-326"></a>
<a name="line-327"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-328"></a><font color=Blue><i>-- ** /z/-Rotations</i></font>
<a name="line-329"></a>
<a name="line-330"></a><a name="approximate_synthesis_zrot"></a><font color=Blue><i>-- | Decompose an /R/[sub /z/](&#952;) = [exp &#8722;/i/&#952;/Z/\/2] gate into a</i></font>
<a name="line-331"></a><font color=Blue><i>-- single-qubit Clifford+/T/ circuit up to the given precision. </i></font>
<a name="line-332"></a><font color=Blue><i>-- </i></font>
<a name="line-333"></a><font color=Blue><i>-- \[image Rz.png]</i></font>
<a name="line-334"></a><font color=Blue><i>-- </i></font>
<a name="line-335"></a><font color=Blue><i>-- The parameters are:</i></font>
<a name="line-336"></a><font color=Blue><i>-- </i></font>
<a name="line-337"></a><font color=Blue><i>-- * a precision /b/ &#8805; 0;</i></font>
<a name="line-338"></a><font color=Blue><i>-- </i></font>
<a name="line-339"></a><font color=Blue><i>-- * an angle &#952;, given as a 'SymReal' value;</i></font>
<a name="line-340"></a><font color=Blue><i>-- </i></font>
<a name="line-341"></a><font color=Blue><i>-- * a source of randomness /g/.</i></font>
<a name="line-342"></a><font color=Blue>approximate_synthesis_zrot</font> <font color=Red>::</font> <font color=Cyan>(</font>RandomGen g<font color=Cyan>)</font> <font color=Red>=&gt;</font> Precision <font color=Red>-&gt;</font> SymReal <font color=Red>-&gt;</font> g <font color=Red>-&gt;</font> Qubit <font color=Red>-&gt;</font> Circ Qubit
<a name="line-343"></a><font color=Blue>approximate_synthesis_zrot</font> b theta g q <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-344"></a>  comment_with_label <font color=Cyan>(</font>printf <font color=Magenta>"ENTER: approximate_synthesis_zrot (b=%.2f, theta=%s)"</font> b <font color=Cyan>(</font>show theta<font color=Cyan>)</font><font color=Cyan>)</font> q <font color=Magenta>"q"</font>
<a name="line-345"></a>  q <font color=Red>&lt;-</font> without_comments <font color=Cyan>$</font> <font color=Green><u>do</u></font>
<a name="line-346"></a>    exact_synthesis1 op q 
<a name="line-347"></a>  comment_with_label <font color=Magenta>"EXIT: approximate_synthesis_zrot"</font> q <font color=Magenta>"q"</font>
<a name="line-348"></a>  return q  
<a name="line-349"></a>  <font color=Green><u>where</u></font>
<a name="line-350"></a>    op <font color=Red>=</font> newsynth b theta g
<a name="line-351"></a>
<a name="line-352"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-353"></a><font color=Blue><i>-- ** Global phase gates</i></font>
<a name="line-354"></a>
<a name="line-355"></a><a name="approximate_synthesis_phase"></a><font color=Blue><i>-- | Construct a Clifford+/T/ circuit (with no inputs and outputs)</i></font>
<a name="line-356"></a><font color=Blue><i>-- that approximates a scalar global phase gate [exp /i/&#952;] up to the</i></font>
<a name="line-357"></a><font color=Blue><i>-- given precision. The parameters are:</i></font>
<a name="line-358"></a><font color=Blue><i>-- </i></font>
<a name="line-359"></a><font color=Blue><i>-- * a flag /keepphase/ to indicate whether global phase should be</i></font>
<a name="line-360"></a><font color=Blue><i>-- respected. (Note that if this is set to 'False', then this function</i></font>
<a name="line-361"></a><font color=Blue><i>-- is just a no-op);</i></font>
<a name="line-362"></a><font color=Blue><i>-- </i></font>
<a name="line-363"></a><font color=Blue><i>-- * a precision /b/ &#8805; 0;</i></font>
<a name="line-364"></a><font color=Blue><i>-- </i></font>
<a name="line-365"></a><font color=Blue><i>-- * an angle &#952;, given as a 'SymReal' value;</i></font>
<a name="line-366"></a><font color=Blue><i>-- </i></font>
<a name="line-367"></a><font color=Blue><i>-- * a source of randomness /g/.</i></font>
<a name="line-368"></a><font color=Blue><i>-- </i></font>
<a name="line-369"></a><font color=Blue><i>-- We use the following decomposition:</i></font>
<a name="line-370"></a><font color=Blue><i>-- </i></font>
<a name="line-371"></a><font color=Blue><i>-- \[image phase.png]</i></font>
<a name="line-372"></a><font color=Blue>approximate_synthesis_phase</font> <font color=Red>::</font> <font color=Cyan>(</font>RandomGen g<font color=Cyan>)</font> <font color=Red>=&gt;</font> KeepPhase <font color=Red>-&gt;</font> Precision <font color=Red>-&gt;</font> SymReal <font color=Red>-&gt;</font> g <font color=Red>-&gt;</font> Circ ()
<a name="line-373"></a><font color=Blue>approximate_synthesis_phase</font> False b theta g <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-374"></a>  return ()
<a name="line-375"></a><font color=Blue>approximate_synthesis_phase</font> True b theta g <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-376"></a>  comment <font color=Cyan>(</font>printf <font color=Magenta>"ENTER: approximate_synthesis_phase (b=%.2f, theta=%s)"</font> b <font color=Cyan>(</font>show theta<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-377"></a>  when <font color=Cyan>(</font>gates <font color=Cyan>/=</font> []<font color=Cyan>)</font> <font color=Cyan>$</font> <font color=Green><u>do</u></font>
<a name="line-378"></a>    q <font color=Red>&lt;-</font> qinit <font color=Magenta>0</font>
<a name="line-379"></a>    apply_gates_at gates q
<a name="line-380"></a>    qterm <font color=Magenta>0</font> q
<a name="line-381"></a>  comment <font color=Magenta>"EXIT: approximate_synthesis_phase"</font>
<a name="line-382"></a>  <font color=Green><u>where</u></font>
<a name="line-383"></a>    op <font color=Red>=</font> newsynth b <font color=Cyan>(</font><font color=Blue><i>-</i></font><font color=Magenta>2</font><font color=Cyan>*</font>theta<font color=Cyan>)</font> g
<a name="line-384"></a>    gates <font color=Red>=</font> convert <font color=Cyan>(</font>normalize op<font color=Cyan>)</font> <font color=Red>::</font> <font color=Red>[</font>Gate<font color=Red>]</font>
<a name="line-385"></a>
<a name="line-386"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-387"></a><font color=Blue><i>-- ** /U/(2) from Euler angles</i></font>
<a name="line-388"></a>
<a name="line-389"></a><a name="approximate_synthesis_euler"></a><font color=Blue><i>-- | Decompose the operator</i></font>
<a name="line-390"></a><font color=Blue><i>-- </i></font>
<a name="line-391"></a><font color=Blue><i>-- * /U/ = [exp /i/&#945;] R[sub /z/](&#946;) R[sub /x/](&#947;) R[sub /z/](&#948;)</i></font>
<a name="line-392"></a><font color=Blue><i>-- </i></font>
<a name="line-393"></a><font color=Blue><i>-- into the Clifford+/T/ gate base, up to the given precision.</i></font>
<a name="line-394"></a><font color=Blue><i>-- The parameters are:</i></font>
<a name="line-395"></a><font color=Blue><i>-- </i></font>
<a name="line-396"></a><font color=Blue><i>-- * a flag /keepphase/ to indicate whether global phase should be</i></font>
<a name="line-397"></a><font color=Blue><i>--   respected. If this is 'False', the angle &#945; is disregarded;</i></font>
<a name="line-398"></a><font color=Blue><i>-- </i></font>
<a name="line-399"></a><font color=Blue><i>-- * a precision /b/ &#8805; 0;</i></font>
<a name="line-400"></a><font color=Blue><i>-- </i></font>
<a name="line-401"></a><font color=Blue><i>-- * a tuple of Euler angles (&#945;, &#946;, &#947;, &#948;), given as 'SymReal' values;</i></font>
<a name="line-402"></a><font color=Blue><i>-- </i></font>
<a name="line-403"></a><font color=Blue><i>-- * a source of randomness /g/.</i></font>
<a name="line-404"></a><font color=Blue>approximate_synthesis_euler</font> <font color=Red>::</font> <font color=Cyan>(</font>RandomGen g<font color=Cyan>)</font> <font color=Red>=&gt;</font> KeepPhase <font color=Red>-&gt;</font> Precision <font color=Red>-&gt;</font> <font color=Cyan>(</font>SymReal<font color=Cyan>,</font> SymReal<font color=Cyan>,</font> SymReal<font color=Cyan>,</font> SymReal<font color=Cyan>)</font> <font color=Red>-&gt;</font> g <font color=Red>-&gt;</font> Qubit <font color=Red>-&gt;</font> Circ Qubit
<a name="line-405"></a><font color=Blue>approximate_synthesis_euler</font> keepphase b <font color=Cyan>(</font>alpha<font color=Cyan>,</font> beta<font color=Cyan>,</font> gamma<font color=Cyan>,</font> delta<font color=Cyan>)</font> g q <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-406"></a>  comment_with_label <font color=Cyan>(</font>printf <font color=Magenta>"ENTER: approximate_synthesis_euler (b=%.2f, alpha=%s, beta=%s, gamma=%s, delta=%s, keepphase=%s)"</font> b <font color=Cyan>(</font>show alpha<font color=Cyan>)</font> <font color=Cyan>(</font>show beta<font color=Cyan>)</font> <font color=Cyan>(</font>show gamma<font color=Cyan>)</font> <font color=Cyan>(</font>show delta<font color=Cyan>)</font> <font color=Cyan>(</font>show keepphase<font color=Cyan>)</font><font color=Cyan>)</font> q <font color=Magenta>"q"</font>
<a name="line-407"></a>  without_comments <font color=Cyan>$</font> <font color=Green><u>do</u></font>
<a name="line-408"></a>    exact_synthesis1 <font color=Cyan>(</font>op_beta <font color=Cyan>*</font> u2_H <font color=Cyan>*</font> op_gamma <font color=Cyan>*</font> u2_H <font color=Cyan>*</font> op_delta<font color=Cyan>)</font> q
<a name="line-409"></a>    approximate_synthesis_phase keepphase b' alpha g1
<a name="line-410"></a>  comment_with_label <font color=Magenta>"EXIT: approximate_synthesis_euler"</font> q <font color=Magenta>"q"</font>
<a name="line-411"></a>  return q
<a name="line-412"></a>  <font color=Green><u>where</u></font>
<a name="line-413"></a>    op_beta <font color=Red>=</font> newsynth b' beta g2
<a name="line-414"></a>    op_gamma <font color=Red>=</font> newsynth b' gamma g3
<a name="line-415"></a>    op_delta <font color=Red>=</font> newsynth b' delta g4
<a name="line-416"></a>    <font color=Cyan>(</font>g'<font color=Cyan>,</font> g''<font color=Cyan>)</font> <font color=Red>=</font> split g
<a name="line-417"></a>    <font color=Cyan>(</font>g1<font color=Cyan>,</font> g2<font color=Cyan>)</font> <font color=Red>=</font> split g'
<a name="line-418"></a>    <font color=Cyan>(</font>g3<font color=Cyan>,</font> g4<font color=Cyan>)</font> <font color=Red>=</font> split g''
<a name="line-419"></a>    b' <font color=Red>=</font> b <font color=Cyan>+</font> <font color=Magenta>2</font>    <font color=Blue><i>-- &#949;' = &#949; / 4</i></font>
<a name="line-420"></a>
<a name="line-421"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-422"></a><font color=Blue><i>-- ** /U/(2) from matrix</i></font>
<a name="line-423"></a>
<a name="line-424"></a><a name="approximate_synthesis_u2"></a><font color=Blue><i>-- | Decompose a single-qubit unitary gate /U/ into the Clifford+/T/</i></font>
<a name="line-425"></a><font color=Blue><i>-- gate base, up to the given precision, provided that det /U/ = 1.</i></font>
<a name="line-426"></a><font color=Blue><i>-- The parameters are:</i></font>
<a name="line-427"></a><font color=Blue><i>-- </i></font>
<a name="line-428"></a><font color=Blue><i>-- * a flag /keepphase/ to indicate whether global phase should be</i></font>
<a name="line-429"></a><font color=Blue><i>-- respected;</i></font>
<a name="line-430"></a><font color=Blue><i>-- </i></font>
<a name="line-431"></a><font color=Blue><i>-- * a precision /b/ &#8805; 0;</i></font>
<a name="line-432"></a><font color=Blue><i>-- </i></font>
<a name="line-433"></a><font color=Blue><i>-- * a 2&#215;2 complex matrix, with entries expressed as 'Cplx' 'SymReal' values;</i></font>
<a name="line-434"></a><font color=Blue><i>-- </i></font>
<a name="line-435"></a><font color=Blue><i>-- * a source of randomness /g/.</i></font>
<a name="line-436"></a><font color=Blue>approximate_synthesis_u2</font> <font color=Red>::</font> <font color=Cyan>(</font>RandomGen g<font color=Cyan>)</font> <font color=Red>=&gt;</font> KeepPhase <font color=Red>-&gt;</font> Precision <font color=Red>-&gt;</font> U2 <font color=Cyan>(</font>Cplx SymReal<font color=Cyan>)</font> <font color=Red>-&gt;</font> g <font color=Red>-&gt;</font> Qubit <font color=Red>-&gt;</font> Circ Qubit
<a name="line-437"></a><font color=Blue>approximate_synthesis_u2</font> keepphase b op g q <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-438"></a>  comment_with_label <font color=Cyan>(</font>printf <font color=Magenta>"ENTER: approximate_synthesis_u2 (b=%.2f, op=%s, keepphase=%s)"</font> b <font color=Cyan>(</font>show op<font color=Cyan>)</font> <font color=Cyan>(</font>show keepphase<font color=Cyan>)</font><font color=Cyan>)</font> q <font color=Magenta>"q"</font>
<a name="line-439"></a>  q <font color=Red>&lt;-</font> without_comments <font color=Cyan>$</font> <font color=Green><u>do</u></font>
<a name="line-440"></a>    approximate_synthesis_euler keepphase b <font color=Cyan>(</font>alpha<font color=Cyan>,</font> beta<font color=Cyan>,</font> gamma<font color=Cyan>,</font> delta<font color=Cyan>)</font> g q
<a name="line-441"></a>  comment_with_label <font color=Magenta>"EXIT: approximate_synthesis_u2"</font> q <font color=Magenta>"q"</font>
<a name="line-442"></a>  return q
<a name="line-443"></a>  <font color=Green><u>where</u></font>
<a name="line-444"></a>    <font color=Cyan>(</font>alpha<font color=Cyan>,</font> beta<font color=Cyan>,</font> gamma<font color=Cyan>,</font> delta<font color=Cyan>)</font> <font color=Red>=</font> euler_angles op
<a name="line-445"></a>
<a name="line-446"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-447"></a><font color=Blue><i>-- ** Controlled gates</i></font>
<a name="line-448"></a>
<a name="line-449"></a><a name="approximate_synthesis_zrot_ctrl"></a><font color=Blue><i>-- | Decompose a controlled /R/[sub /z/](&#952;) = [exp &#8722;/i/&#952;/Z/\/2] gate</i></font>
<a name="line-450"></a><font color=Blue><i>-- into a single-qubit Clifford+/T/ circuit up to the given</i></font>
<a name="line-451"></a><font color=Blue><i>-- precision. The parameters are as for 'approximate_synthesis_phase'.</i></font>
<a name="line-452"></a><font color=Blue><i>-- The first input is the target qubit, and the second input the</i></font>
<a name="line-453"></a><font color=Blue><i>-- control.</i></font>
<a name="line-454"></a><font color=Blue><i>-- </i></font>
<a name="line-455"></a><font color=Blue><i>-- We use the following decomposition. It has lower /T/-count than the</i></font>
<a name="line-456"></a><font color=Blue><i>-- alternatives and makes good use of parallelism. Since it uses the</i></font>
<a name="line-457"></a><font color=Blue><i>-- same rotation twice, only a single run of the synthesis algorithm</i></font>
<a name="line-458"></a><font color=Blue><i>-- is required.</i></font>
<a name="line-459"></a><font color=Blue><i>-- </i></font>
<a name="line-460"></a><font color=Blue><i>-- \[image controlled-zrot.png]</i></font>
<a name="line-461"></a><font color=Blue>approximate_synthesis_zrot_ctrl</font> <font color=Red>::</font> <font color=Cyan>(</font>RandomGen g<font color=Cyan>)</font> <font color=Red>=&gt;</font> Precision <font color=Red>-&gt;</font> SymReal <font color=Red>-&gt;</font> g <font color=Red>-&gt;</font> Qubit <font color=Red>-&gt;</font> Qubit <font color=Red>-&gt;</font> Circ Qubit
<a name="line-462"></a><font color=Blue>approximate_synthesis_zrot_ctrl</font> b theta g q1 c2 <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-463"></a>  comment_with_label <font color=Cyan>(</font>printf <font color=Magenta>"ENTER: approximate_synthesis_zrot_ctrl (b=%.2f, theta=%s)"</font> b <font color=Cyan>(</font>show theta<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Cyan>(</font>q1<font color=Cyan>,</font>c2<font color=Cyan>)</font> <font color=Cyan>(</font><font color=Magenta>"q"</font><font color=Cyan>,</font> <font color=Magenta>"c"</font><font color=Cyan>)</font>
<a name="line-464"></a>  qnot_at c2 <font color=Cyan>`controlled`</font> q1 <font color=Cyan>.==.</font> False
<a name="line-465"></a>  apply_gates2_at gates q1 c2
<a name="line-466"></a>  qnot_at c2 <font color=Cyan>`controlled`</font> q1 <font color=Cyan>.==.</font> False
<a name="line-467"></a>  comment_with_label <font color=Magenta>"EXIT: approximate_synthesis_zrot_ctrl"</font> <font color=Cyan>(</font>q1<font color=Cyan>,</font>c2<font color=Cyan>)</font> <font color=Cyan>(</font><font color=Magenta>"q"</font><font color=Cyan>,</font> <font color=Magenta>"c"</font><font color=Cyan>)</font>
<a name="line-468"></a>  return q1
<a name="line-469"></a>  <font color=Green><u>where</u></font>
<a name="line-470"></a>    gates <font color=Red>=</font> convert <font color=Cyan>(</font>normalize op<font color=Cyan>)</font> <font color=Red>::</font> <font color=Red>[</font>Gate<font color=Red>]</font>
<a name="line-471"></a>    op <font color=Red>=</font> newsynth <font color=Cyan>(</font>b<font color=Cyan>+</font><font color=Magenta>1</font><font color=Cyan>)</font> <font color=Cyan>(</font>theta<font color=Cyan>/</font><font color=Magenta>2</font><font color=Cyan>)</font> g
<a name="line-472"></a>
<a name="line-473"></a><a name="approximate_synthesis_phase_ctrl"></a><font color=Blue><i>-- | Decompose a controlled phase gate</i></font>
<a name="line-474"></a><font color=Blue><i>-- </i></font>
<a name="line-475"></a><font color=Blue><i>-- \[image controlled_phase.png]</i></font>
<a name="line-476"></a><font color=Blue><i>-- </i></font>
<a name="line-477"></a><font color=Blue><i>-- into the Clifford+/T/ gate base. The parameters are as for</i></font>
<a name="line-478"></a><font color=Blue><i>-- 'approximate_synthesis_phase'.</i></font>
<a name="line-479"></a><font color=Blue><i>-- </i></font>
<a name="line-480"></a><font color=Blue><i>-- We use the following decomposition. It has lower /T/-count than the</i></font>
<a name="line-481"></a><font color=Blue><i>-- alternatives and makes good use of parallelism. Since it uses the</i></font>
<a name="line-482"></a><font color=Blue><i>-- same rotation twice, only a single run of the synthesis algorithm</i></font>
<a name="line-483"></a><font color=Blue><i>-- is required.</i></font>
<a name="line-484"></a><font color=Blue><i>-- </i></font>
<a name="line-485"></a><font color=Blue><i>-- \[image controlled-phase-decomp.png]</i></font>
<a name="line-486"></a><font color=Blue><i>-- </i></font>
<a name="line-487"></a><font color=Blue><i>-- If the 'KeepPhase' flag is set, respect global phase; otherwise,</i></font>
<a name="line-488"></a><font color=Blue><i>-- disregard it.</i></font>
<a name="line-489"></a><font color=Blue>approximate_synthesis_phase_ctrl</font> <font color=Red>::</font> <font color=Cyan>(</font>RandomGen g<font color=Cyan>)</font> <font color=Red>=&gt;</font> KeepPhase <font color=Red>-&gt;</font> Precision <font color=Red>-&gt;</font> SymReal <font color=Red>-&gt;</font> g <font color=Red>-&gt;</font> Qubit <font color=Red>-&gt;</font> Circ Qubit
<a name="line-490"></a><font color=Blue>approximate_synthesis_phase_ctrl</font> keepphase b theta g q1 <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-491"></a>  comment_with_label <font color=Cyan>(</font>printf <font color=Magenta>"ENTER: approximate_synthesis_phase_ctrl (b=%.2f, theta=%s keepphase=%s)"</font> b <font color=Cyan>(</font>show theta<font color=Cyan>)</font> <font color=Cyan>(</font>show keepphase<font color=Cyan>)</font><font color=Cyan>)</font> q1 <font color=Magenta>"q"</font>
<a name="line-492"></a>  <font color=Green><u>if</u></font> keepphase <font color=Green><u>then</u></font> <font color=Green><u>do</u></font>
<a name="line-493"></a>    q2 <font color=Red>&lt;-</font> qinit True
<a name="line-494"></a>    apply_gates2_at gates q2 q1
<a name="line-495"></a>    qterm True q2
<a name="line-496"></a>  <font color=Green><u>else</u></font> <font color=Green><u>do</u></font>
<a name="line-497"></a>    approximate_synthesis_zrot b theta g q1
<a name="line-498"></a>    return ()
<a name="line-499"></a>  comment_with_label <font color=Magenta>"EXIT: approximate_synthesis_phase_ctrl"</font> q1 <font color=Magenta>"q"</font>
<a name="line-500"></a>  return q1
<a name="line-501"></a>  <font color=Green><u>where</u></font>
<a name="line-502"></a>    gates <font color=Red>=</font> convert <font color=Cyan>(</font>normalize op<font color=Cyan>)</font> <font color=Red>::</font> <font color=Red>[</font>Gate<font color=Red>]</font>
<a name="line-503"></a>    op <font color=Red>=</font> newsynth <font color=Cyan>(</font>b<font color=Cyan>+</font><font color=Magenta>1</font><font color=Cyan>)</font> theta g
</pre>
</body>
</html>