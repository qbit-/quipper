<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>Haskell code</title>
</head>
<body>
<pre><a name="line-1"></a><font color=Blue><i>{-# LANGUAGE MultiParamTypeClasses #-}</i></font>
<a name="line-2"></a><font color=Blue><i>{-# LANGUAGE FunctionalDependencies #-}</i></font>
<a name="line-3"></a><font color=Blue><i>{-# LANGUAGE FlexibleInstances #-}</i></font>
<a name="line-4"></a><font color=Blue><i>{-# LANGUAGE UndecidableInstances #-}</i></font>
<a name="line-5"></a>
<a name="line-6"></a><font color=Blue><i>-- | This module provides miscellaneous general-purpose auxiliary</i></font>
<a name="line-7"></a><font color=Blue><i>-- functions.</i></font>
<a name="line-8"></a>
<a name="line-9"></a><font color=Green><u>module</u></font> Libraries<font color=Cyan>.</font>Auxiliary <font color=Cyan>(</font>
<a name="line-10"></a>  <font color=Blue><i>-- * List operations</i></font>
<a name="line-11"></a>  applyAt<font color=Cyan>,</font>
<a name="line-12"></a>  overwriteAt<font color=Cyan>,</font>
<a name="line-13"></a>  has_duplicates<font color=Cyan>,</font>
<a name="line-14"></a>  substitute<font color=Cyan>,</font>
<a name="line-15"></a>  
<a name="line-16"></a>  <font color=Blue><i>-- * Set and Map related operations</i></font>
<a name="line-17"></a>  map_provide<font color=Cyan>,</font>
<a name="line-18"></a>  intset_inserts<font color=Cyan>,</font>
<a name="line-19"></a>  intmap_zip<font color=Cyan>,</font>
<a name="line-20"></a>  intmap_zip_errmsg<font color=Cyan>,</font>
<a name="line-21"></a>  intmap_map<font color=Cyan>,</font>
<a name="line-22"></a>  intmap_mapM<font color=Cyan>,</font>
<a name="line-23"></a>  
<a name="line-24"></a>  <font color=Blue><i>-- * XIntMaps</i></font>
<a name="line-25"></a>  XIntMap<font color=Cyan>,</font>
<a name="line-26"></a>  xintmap_delete<font color=Cyan>,</font>
<a name="line-27"></a>  xintmap_deletes<font color=Cyan>,</font>
<a name="line-28"></a>  xintmap_insert<font color=Cyan>,</font>
<a name="line-29"></a>  xintmap_inserts<font color=Cyan>,</font>
<a name="line-30"></a>  xintmap_lookup<font color=Cyan>,</font>
<a name="line-31"></a>  xintmap_member<font color=Cyan>,</font>
<a name="line-32"></a>  xintmap_empty<font color=Cyan>,</font>
<a name="line-33"></a>  xintmap_freshkey<font color=Cyan>,</font>
<a name="line-34"></a>  xintmap_freshkeys<font color=Cyan>,</font>
<a name="line-35"></a>  xintmap_to_intmap<font color=Cyan>,</font>
<a name="line-36"></a>  xintmap_size<font color=Cyan>,</font>
<a name="line-37"></a>  xintmap_dirty<font color=Cyan>,</font>
<a name="line-38"></a>  xintmap_reserves<font color=Cyan>,</font>
<a name="line-39"></a>  xintmap_unreserves<font color=Cyan>,</font>  
<a name="line-40"></a>  xintmap_makeclean<font color=Cyan>,</font>
<a name="line-41"></a>  
<a name="line-42"></a>  <font color=Blue><i>-- * Various map- and fold-like list combinators</i></font>
<a name="line-43"></a>  loop<font color=Cyan>,</font>
<a name="line-44"></a>  loop_with_index<font color=Cyan>,</font>
<a name="line-45"></a>  fold_right_zip<font color=Cyan>,</font>
<a name="line-46"></a>  zip_strict<font color=Cyan>,</font>
<a name="line-47"></a>  zip_strict_errmsg<font color=Cyan>,</font>
<a name="line-48"></a>  zip_rightstrict<font color=Cyan>,</font>
<a name="line-49"></a>  zip_rightstrict_errmsg<font color=Cyan>,</font>
<a name="line-50"></a>  zipWith_strict<font color=Cyan>,</font>
<a name="line-51"></a>  zipWith_rightstrict<font color=Cyan>,</font>
<a name="line-52"></a>  
<a name="line-53"></a>  <font color=Blue><i>-- * Monadic versions of list combinators</i></font>
<a name="line-54"></a>  loopM<font color=Cyan>,</font>
<a name="line-55"></a>  loop_with_indexM<font color=Cyan>,</font>
<a name="line-56"></a>  zipRightWithRightStrictM<font color=Cyan>,</font>
<a name="line-57"></a>  zipRightWithRightStrictM_<font color=Cyan>,</font>
<a name="line-58"></a>  fold_right_zipM<font color=Cyan>,</font>
<a name="line-59"></a>  foldRightPairM<font color=Cyan>,</font>
<a name="line-60"></a>  foldRightPairM_<font color=Cyan>,</font>
<a name="line-61"></a>  sequence_right<font color=Cyan>,</font>
<a name="line-62"></a>  sequence_right_<font color=Cyan>,</font>
<a name="line-63"></a>  
<a name="line-64"></a>  <font color=Blue><i>-- * Loops</i></font>
<a name="line-65"></a>  <font color=Blue><i>-- $LOOPS</i></font>
<a name="line-66"></a>  for<font color=Cyan>,</font>
<a name="line-67"></a>  endfor<font color=Cyan>,</font>
<a name="line-68"></a>  foreach<font color=Cyan>,</font>
<a name="line-69"></a>  
<a name="line-70"></a>  <font color=Blue><i>-- * Operations for monads</i></font>
<a name="line-71"></a>  mmap<font color=Cyan>,</font>
<a name="line-72"></a>  monad_join1<font color=Cyan>,</font>
<a name="line-73"></a>  
<a name="line-74"></a>  <font color=Blue><i>-- * Operations for disjoint unions</i></font>
<a name="line-75"></a>  map_either<font color=Cyan>,</font>
<a name="line-76"></a>  map_eitherM<font color=Cyan>,</font>
<a name="line-77"></a>  
<a name="line-78"></a>  <font color=Blue><i>-- * Operations for tuples</i></font>
<a name="line-79"></a>  map_pair<font color=Cyan>,</font>
<a name="line-80"></a>  map_pairM<font color=Cyan>,</font>
<a name="line-81"></a>  
<a name="line-82"></a>  <font color=Blue><i>-- * Arithmetic operations</i></font>
<a name="line-83"></a>  int_ceiling<font color=Cyan>,</font>
<a name="line-84"></a>  
<a name="line-85"></a>  <font color=Blue><i>-- * Bit vectors</i></font>
<a name="line-86"></a>  Boollist<font color=Cyan>(</font><font color=Red>..</font><font color=Cyan>)</font><font color=Cyan>,</font>
<a name="line-87"></a>  boollist_of_int_bh<font color=Cyan>,</font>
<a name="line-88"></a>  boollist_of_int_lh<font color=Cyan>,</font>
<a name="line-89"></a>  int_of_boollist_unsigned_bh<font color=Cyan>,</font>
<a name="line-90"></a>  int_of_boollist_signed_bh<font color=Cyan>,</font>
<a name="line-91"></a>  bool_xor<font color=Cyan>,</font>
<a name="line-92"></a>  boollist_xor<font color=Cyan>,</font>
<a name="line-93"></a>  
<a name="line-94"></a>  <font color=Blue><i>-- * Formatting of lists and strings</i></font>
<a name="line-95"></a>  string_of_list<font color=Cyan>,</font>
<a name="line-96"></a>  optional<font color=Cyan>,</font>
<a name="line-97"></a>  
<a name="line-98"></a>  <font color=Blue><i>-- * Lists optimized for fast concatenation</i></font>
<a name="line-99"></a>  BList<font color=Cyan>,</font>
<a name="line-100"></a>  blist_of_list<font color=Cyan>,</font>
<a name="line-101"></a>  list_of_blist<font color=Cyan>,</font>
<a name="line-102"></a>  <font color=Cyan>(</font><font color=Cyan>+++</font><font color=Cyan>)</font><font color=Cyan>,</font>
<a name="line-103"></a>  blist_empty<font color=Cyan>,</font>
<a name="line-104"></a>  blist_concat<font color=Cyan>,</font>
<a name="line-105"></a>  
<a name="line-106"></a>  <font color=Blue><i>-- * Strings optimized for fast concatenation</i></font>
<a name="line-107"></a>  Strbuf<font color=Cyan>,</font>
<a name="line-108"></a>  strbuf_of_string<font color=Cyan>,</font>
<a name="line-109"></a>  string_of_strbuf<font color=Cyan>,</font>
<a name="line-110"></a>  strbuf_empty<font color=Cyan>,</font>
<a name="line-111"></a>  strbuf_concat<font color=Cyan>,</font>
<a name="line-112"></a>  
<a name="line-113"></a>  <font color=Blue><i>-- * The identity monad</i></font>
<a name="line-114"></a>  Id<font color=Cyan>(</font><font color=Red>..</font><font color=Cyan>)</font><font color=Cyan>,</font>
<a name="line-115"></a>  
<a name="line-116"></a>  <font color=Blue><i>-- * Identity types</i></font>
<a name="line-117"></a>  Identity<font color=Cyan>,</font>
<a name="line-118"></a>  reflexivity<font color=Cyan>,</font>
<a name="line-119"></a>  symmetry<font color=Cyan>,</font>
<a name="line-120"></a>  transitivity<font color=Cyan>,</font>
<a name="line-121"></a>  identity<font color=Cyan>,</font>
<a name="line-122"></a>  
<a name="line-123"></a>  <font color=Blue><i>-- * Error messages</i></font>
<a name="line-124"></a>  ErrMsg<font color=Cyan>,</font>
<a name="line-125"></a>  
<a name="line-126"></a>  <font color=Blue><i>-- * The Curry type class</i></font>
<a name="line-127"></a>  Curry <font color=Cyan>(</font><font color=Red>..</font><font color=Cyan>)</font>
<a name="line-128"></a>  <font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-129"></a>
<a name="line-130"></a><font color=Blue><i>-- import other stuff</i></font>
<a name="line-131"></a><font color=Green><u>import</u></font> Data<font color=Cyan>.</font>List <font color=Cyan>(</font>foldl'<font color=Cyan>)</font>
<a name="line-132"></a>
<a name="line-133"></a><font color=Green><u>import</u></font> Data<font color=Cyan>.</font>Set <font color=Cyan>(</font>Set<font color=Cyan>)</font>
<a name="line-134"></a><font color=Green><u>import</u></font> <font color=Green><u>qualified</u></font> Data<font color=Cyan>.</font>Set <font color=Green><u>as</u></font> Set
<a name="line-135"></a>
<a name="line-136"></a><font color=Green><u>import</u></font> Data<font color=Cyan>.</font>Map <font color=Cyan>(</font>Map<font color=Cyan>)</font>
<a name="line-137"></a><font color=Green><u>import</u></font> <font color=Green><u>qualified</u></font> Data<font color=Cyan>.</font>Map <font color=Green><u>as</u></font> Map
<a name="line-138"></a>
<a name="line-139"></a><font color=Green><u>import</u></font> Data<font color=Cyan>.</font>IntSet <font color=Cyan>(</font>IntSet<font color=Cyan>)</font>
<a name="line-140"></a><font color=Green><u>import</u></font> <font color=Green><u>qualified</u></font> Data<font color=Cyan>.</font>IntSet <font color=Green><u>as</u></font> IntSet
<a name="line-141"></a>
<a name="line-142"></a><font color=Green><u>import</u></font> Data<font color=Cyan>.</font>IntMap <font color=Cyan>(</font>IntMap<font color=Cyan>)</font>
<a name="line-143"></a><font color=Green><u>import</u></font> <font color=Green><u>qualified</u></font> Data<font color=Cyan>.</font>IntMap <font color=Green><u>as</u></font> IntMap
<a name="line-144"></a>
<a name="line-145"></a><font color=Green><u>import</u></font> <font color=Green><u>qualified</u></font> Data<font color=Cyan>.</font>Traversable <font color=Green><u>as</u></font> Traversable
<a name="line-146"></a>
<a name="line-147"></a><font color=Green><u>import</u></font> Control<font color=Cyan>.</font>Applicative <font color=Cyan>(</font>Applicative<font color=Cyan>(</font><font color=Red>..</font><font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-148"></a><font color=Green><u>import</u></font> Control<font color=Cyan>.</font>Monad <font color=Cyan>(</font>liftM<font color=Cyan>,</font> ap<font color=Cyan>)</font>
<a name="line-149"></a>
<a name="line-150"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-151"></a><font color=Blue><i>-- * List operations</i></font>
<a name="line-152"></a>
<a name="line-153"></a><a name="applyAt"></a><font color=Blue><i>-- | Apply a function to a specified position in a list.</i></font>
<a name="line-154"></a><font color=Blue>applyAt</font> <font color=Red>::</font> Int <font color=Red>-&gt;</font> <font color=Cyan>(</font>a <font color=Red>-&gt;</font> a<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Red>[</font>a<font color=Red>]</font> <font color=Red>-&gt;</font> <font color=Red>[</font>a<font color=Red>]</font>
<a name="line-155"></a><font color=Blue>applyAt</font> <font color=Green><u>_</u></font> <font color=Green><u>_</u></font> [] <font color=Red>=</font> []
<a name="line-156"></a><font color=Blue>applyAt</font> <font color=Magenta>0</font> f <font color=Cyan>(</font>x<font color=Red><b>:</b></font>xs<font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font>f x<font color=Cyan>)</font><font color=Red><b>:</b></font>xs
<a name="line-157"></a><font color=Blue>applyAt</font> n f <font color=Cyan>(</font>x<font color=Red><b>:</b></font>xs<font color=Cyan>)</font> <font color=Red>=</font> x<font color=Red><b>:</b></font><font color=Cyan>(</font>applyAt <font color=Cyan>(</font>n<font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>)</font> f xs<font color=Cyan>)</font>
<a name="line-158"></a>
<a name="line-159"></a><a name="overwriteAt"></a><font color=Blue><i>-- | Overwrite an element at a specified position in a list.</i></font>
<a name="line-160"></a><font color=Blue>overwriteAt</font> <font color=Red>::</font> Int <font color=Red>-&gt;</font> a <font color=Red>-&gt;</font> <font color=Red>[</font>a<font color=Red>]</font> <font color=Red>-&gt;</font> <font color=Red>[</font>a<font color=Red>]</font>
<a name="line-161"></a><font color=Blue>overwriteAt</font> n a <font color=Red>=</font> applyAt n <font color=Cyan>(</font>const a<font color=Cyan>)</font>
<a name="line-162"></a>
<a name="line-163"></a><a name="has_duplicates"></a><font color=Blue><i>-- | Check whether a list has duplicates.</i></font>
<a name="line-164"></a><font color=Blue>has_duplicates</font> <font color=Red>::</font> Ord a <font color=Red>=&gt;</font> <font color=Red>[</font>a<font color=Red>]</font> <font color=Red>-&gt;</font> Bool
<a name="line-165"></a><font color=Blue>has_duplicates</font> list <font color=Red>=</font> aux list <font color=Cyan>(</font>Set<font color=Cyan>.</font>empty<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-166"></a>  aux [] <font color=Green><u>_</u></font> <font color=Red>=</font> False
<a name="line-167"></a>  aux <font color=Cyan>(</font>h<font color=Red><b>:</b></font>t<font color=Cyan>)</font> set <font color=Red>=</font> <font color=Green><u>if</u></font> Set<font color=Cyan>.</font>member h set <font color=Green><u>then</u></font> True <font color=Green><u>else</u></font> aux t <font color=Cyan>(</font>Set<font color=Cyan>.</font>insert h set<font color=Cyan>)</font>
<a name="line-168"></a>
<a name="line-169"></a><a name="substitute"></a><font color=Blue><i>-- | @'substitute' string character replacement@: </i></font>
<a name="line-170"></a><font color=Blue><i>-- Replace the first occurrence of /character/ in /string/ by /replacement/.</i></font>
<a name="line-171"></a><font color=Blue>substitute</font> <font color=Red>::</font> <font color=Cyan>(</font>Eq a<font color=Cyan>)</font> <font color=Red>=&gt;</font> <font color=Red>[</font>a<font color=Red>]</font> <font color=Red>-&gt;</font> a <font color=Red>-&gt;</font> <font color=Red>[</font>a<font color=Red>]</font> <font color=Red>-&gt;</font> <font color=Red>[</font>a<font color=Red>]</font>
<a name="line-172"></a><font color=Blue>substitute</font> string character replacement <font color=Red>=</font>    
<a name="line-173"></a>  <font color=Green><u>case</u></font> break <font color=Cyan>(</font><font color=Cyan>==</font> character<font color=Cyan>)</font> string <font color=Green><u>of</u></font>
<a name="line-174"></a>    <font color=Cyan>(</font>x<font color=Cyan>,</font> []<font color=Cyan>)</font> <font color=Red>-&gt;</font> x
<a name="line-175"></a>    <font color=Cyan>(</font>x<font color=Cyan>,</font> h<font color=Red><b>:</b></font>y<font color=Cyan>)</font> <font color=Red>-&gt;</font> x <font color=Cyan>++</font> replacement <font color=Cyan>++</font> y
<a name="line-176"></a>
<a name="line-177"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-178"></a><font color=Blue><i>-- * Set related operations</i></font>
<a name="line-179"></a>
<a name="line-180"></a><a name="intset_inserts"></a><font color=Blue><i>-- | Insert the elements of a list in an 'IntSet' (cf. 'IntSet.insert').</i></font>
<a name="line-181"></a><font color=Blue>intset_inserts</font> <font color=Red>::</font> <font color=Red>[</font>Int<font color=Red>]</font> <font color=Red>-&gt;</font> IntSet <font color=Red>-&gt;</font> IntSet
<a name="line-182"></a><font color=Blue>intset_inserts</font> list set <font color=Red>=</font>
<a name="line-183"></a>  foldl' <font color=Cyan>(</font><font color=Red>\</font>t x <font color=Red>-&gt;</font> IntSet<font color=Cyan>.</font>insert x t<font color=Cyan>)</font> set list
<a name="line-184"></a>
<a name="line-185"></a>
<a name="line-186"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-187"></a><font color=Blue><i>-- * Map related operations</i></font>
<a name="line-188"></a>
<a name="line-189"></a><a name="map_provide"></a><font color=Blue><i>-- | Insert the given key-value pair in a 'Map', but only if the given</i></font>
<a name="line-190"></a><font color=Blue><i>-- key is not already present. If the key is present, keep the old</i></font>
<a name="line-191"></a><font color=Blue><i>-- value.</i></font>
<a name="line-192"></a><font color=Blue>map_provide</font> <font color=Red>::</font> Ord k <font color=Red>=&gt;</font> k <font color=Red>-&gt;</font> a <font color=Red>-&gt;</font> Map k a <font color=Red>-&gt;</font> Map k a
<a name="line-193"></a><font color=Blue>map_provide</font> <font color=Red>=</font> Map<font color=Cyan>.</font>insertWith <font color=Cyan>(</font><font color=Red>\</font>x y <font color=Red>-&gt;</font> y<font color=Cyan>)</font>
<a name="line-194"></a>
<a name="line-195"></a><a name="intmap_zipright"></a><font color=Blue><i>-- | Take two 'IntMap's /m/[sub 1] and /m/[sub 2], and form a new</i></font>
<a name="line-196"></a><font color=Blue><i>-- 'IntMap' whose domain is that of /m/[sub 2], and whose value at /k/</i></font>
<a name="line-197"></a><font color=Blue><i>-- is the pair (/m/[sub 1] ! /k/, /m/[sub 2] ! /k/). It is an error if</i></font>
<a name="line-198"></a><font color=Blue><i>-- the domain of /m/[sub 2] is not a subset of the domain of /m/[sub 1].</i></font>
<a name="line-199"></a><font color=Blue>intmap_zipright</font> <font color=Red>::</font> IntMap x <font color=Red>-&gt;</font> IntMap y <font color=Red>-&gt;</font> IntMap <font color=Cyan>(</font>x<font color=Cyan>,</font> y<font color=Cyan>)</font>
<a name="line-200"></a><font color=Blue>intmap_zipright</font> m1 m2 <font color=Red>=</font> m <font color=Green><u>where</u></font>
<a name="line-201"></a>  m <font color=Red>=</font> IntMap<font color=Cyan>.</font>mapWithKey f m2
<a name="line-202"></a>  f k y <font color=Red>=</font> <font color=Green><u>case</u></font> IntMap<font color=Cyan>.</font>lookup k m1 <font color=Green><u>of</u></font>
<a name="line-203"></a>    Just x <font color=Red>-&gt;</font> <font color=Cyan>(</font>x<font color=Cyan>,</font> y<font color=Cyan>)</font>
<a name="line-204"></a>    Nothing <font color=Red>-&gt;</font> error <font color=Magenta>"intmap_zipright: shape mismatch"</font>
<a name="line-205"></a>  
<a name="line-206"></a><a name="intmap_zip"></a><font color=Blue><i>-- | Take two 'IntMap's with the same domain, and form a new 'IntMap'</i></font>
<a name="line-207"></a><font color=Blue><i>-- whose values are pairs. It is an error if the two inputs don't have</i></font>
<a name="line-208"></a><font color=Blue><i>-- identical domains.</i></font>
<a name="line-209"></a><font color=Blue>intmap_zip</font> <font color=Red>::</font> IntMap x <font color=Red>-&gt;</font> IntMap y <font color=Red>-&gt;</font> IntMap <font color=Cyan>(</font>x<font color=Cyan>,</font> y<font color=Cyan>)</font>
<a name="line-210"></a><font color=Blue>intmap_zip</font> m1 m2 <font color=Red>=</font> intmap_zip_errmsg m1 m2 <font color=Magenta>"intmap_zip: shape mismatch"</font>
<a name="line-211"></a>  
<a name="line-212"></a><a name="intmap_zip_errmsg"></a><font color=Blue><i>-- | Like 'intmap_zip', but also takes an error message to use in case of</i></font>
<a name="line-213"></a><font color=Blue><i>-- domain mismatch.</i></font>
<a name="line-214"></a><font color=Blue>intmap_zip_errmsg</font> <font color=Red>::</font> IntMap x <font color=Red>-&gt;</font> IntMap y <font color=Red>-&gt;</font> String <font color=Red>-&gt;</font> IntMap <font color=Cyan>(</font>x<font color=Cyan>,</font> y<font color=Cyan>)</font>
<a name="line-215"></a><font color=Blue>intmap_zip_errmsg</font> m1 m2 errmsg <font color=Red>=</font> 
<a name="line-216"></a>  <font color=Green><u>if</u></font> all <font color=Cyan>(</font><font color=Red>\</font>k <font color=Red>-&gt;</font> IntMap<font color=Cyan>.</font>member k m2<font color=Cyan>)</font> <font color=Cyan>(</font>IntMap<font color=Cyan>.</font>keys m1<font color=Cyan>)</font> 
<a name="line-217"></a>    <font color=Green><u>then</u></font> intmap_zipright m1 m2
<a name="line-218"></a>    <font color=Green><u>else</u></font> error errmsg
<a name="line-219"></a>  
<a name="line-220"></a><a name="intmap_map"></a><font color=Blue><i>-- | Map a function over all values in an 'IntMap'.</i></font>
<a name="line-221"></a><font color=Blue>intmap_map</font> <font color=Red>::</font> <font color=Cyan>(</font>x <font color=Red>-&gt;</font> y<font color=Cyan>)</font> <font color=Red>-&gt;</font> IntMap x <font color=Red>-&gt;</font> IntMap y
<a name="line-222"></a><font color=Blue>intmap_map</font> <font color=Red>=</font> IntMap<font color=Cyan>.</font>map
<a name="line-223"></a>
<a name="line-224"></a><a name="intmap_mapM"></a><font color=Blue><i>-- | Monadic version of 'intmap_map'. Map a function over all values</i></font>
<a name="line-225"></a><font color=Blue><i>-- in an 'IntMap'.</i></font>
<a name="line-226"></a><font color=Blue>intmap_mapM</font> <font color=Red>::</font> <font color=Cyan>(</font>Monad m<font color=Cyan>)</font> <font color=Red>=&gt;</font> <font color=Cyan>(</font>x <font color=Red>-&gt;</font> m y<font color=Cyan>)</font> <font color=Red>-&gt;</font> IntMap x <font color=Red>-&gt;</font> m <font color=Cyan>(</font>IntMap y<font color=Cyan>)</font>
<a name="line-227"></a><font color=Blue>intmap_mapM</font> <font color=Red>=</font> Traversable<font color=Cyan>.</font>mapM
<a name="line-228"></a>
<a name="line-229"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-230"></a><font color=Blue><i>-- * XIntMaps. </i></font>
<a name="line-231"></a>
<a name="line-232"></a><font color=Blue><i>-- | A 'XIntMap' is just like an 'IntMap', except that it supports</i></font>
<a name="line-233"></a><font color=Blue><i>-- some additional efficient operations: to find the smallest unused</i></font>
<a name="line-234"></a><font color=Blue><i>-- key, to find the set of all keys ever used in the past, and to</i></font>
<a name="line-235"></a><font color=Blue><i>-- reserve a set of keys so that they will not be allocated. Moreover,</i></font>
<a name="line-236"></a><font color=Blue><i>-- it keeps track of the highest key ever used (whether or not it is</i></font>
<a name="line-237"></a><font color=Blue><i>-- still used in the current map).</i></font>
<a name="line-238"></a>
<a name="line-239"></a><font color=Blue><i>-- This is implemented as a tuple (/m/, /n/, /free/, /h/), where /m/ is an</i></font>
<a name="line-240"></a><font color=Blue><i>-- 'IntMap', /n/ is an integer such that dom /m/ &#8838; [0../n/-1], /free/</i></font>
<a name="line-241"></a><font color=Blue><i>-- &#8838; [0../n/-1] \\ dom /m/ is a set of integers not currently reserved</i></font>
<a name="line-242"></a><font color=Blue><i>-- or used, and /h/ is the set of all integers used in the past (the</i></font>
<a name="line-243"></a><font color=Blue><i>-- set of /touched/ wires).</i></font>
<a name="line-244"></a>
<a name="line-245"></a><a name="XIntMap"></a><font color=Green><u>data</u></font> XIntMap a <font color=Red>=</font> XIntMap <font color=Cyan>!</font><font color=Cyan>(</font>IntMap a<font color=Cyan>)</font> <font color=Cyan>!</font>Int <font color=Cyan>!</font>IntSet <font color=Cyan>!</font>IntSet
<a name="line-246"></a>
<a name="line-247"></a><a name="instance%20Show%20(XIntMap%20a)"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Show a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Show <font color=Cyan>(</font>XIntMap a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-248"></a>  show <font color=Red>=</font> show <font color=Cyan>.</font> xintmap_to_intmap
<a name="line-249"></a>    
<a name="line-250"></a><a name="xintmap_delete"></a><font color=Blue><i>-- | Delete a key from the 'XIntMap'.</i></font>
<a name="line-251"></a><font color=Blue>xintmap_delete</font> <font color=Red>::</font> Int <font color=Red>-&gt;</font> XIntMap a <font color=Red>-&gt;</font> XIntMap a
<a name="line-252"></a><font color=Blue>xintmap_delete</font> k <font color=Cyan>(</font>XIntMap m n free h<font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font>XIntMap m' n free' h<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-253"></a>  m' <font color=Red>=</font> IntMap<font color=Cyan>.</font>delete k m
<a name="line-254"></a>  free' <font color=Red>=</font> IntSet<font color=Cyan>.</font>insert k free
<a name="line-255"></a>  
<a name="line-256"></a><a name="xintmap_deletes"></a><font color=Blue><i>-- | Delete a list of keys from a 'XIntMap'.</i></font>
<a name="line-257"></a><font color=Blue>xintmap_deletes</font> <font color=Red>::</font> <font color=Red>[</font>Int<font color=Red>]</font> <font color=Red>-&gt;</font> XIntMap a <font color=Red>-&gt;</font> XIntMap a
<a name="line-258"></a><font color=Blue>xintmap_deletes</font> list map <font color=Red>=</font>
<a name="line-259"></a>  foldl' <font color=Cyan>(</font><font color=Red>\</font>map k <font color=Red>-&gt;</font> xintmap_delete k map<font color=Cyan>)</font> map list
<a name="line-260"></a>
<a name="line-261"></a><a name="xintmap_insert"></a><font color=Blue><i>-- | Insert a new key-value pair in the 'XIntMap'. </i></font>
<a name="line-262"></a><font color=Blue>xintmap_insert</font> <font color=Red>::</font> Int <font color=Red>-&gt;</font> a <font color=Red>-&gt;</font> XIntMap a <font color=Red>-&gt;</font> XIntMap a
<a name="line-263"></a><font color=Blue>xintmap_insert</font> k v <font color=Cyan>(</font>XIntMap m n free h<font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font>XIntMap m' n' free' h'<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-264"></a>  m' <font color=Red>=</font> IntMap<font color=Cyan>.</font>insert k v m
<a name="line-265"></a>  h' <font color=Red>=</font> IntSet<font color=Cyan>.</font>insert k h
<a name="line-266"></a>  n' <font color=Red>=</font> max n <font color=Cyan>(</font>k<font color=Cyan>+</font><font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-267"></a>  free' <font color=Red>=</font> IntSet<font color=Cyan>.</font>delete k <font color=Cyan>(</font>intset_inserts <font color=Red>[</font>n<font color=Red>..</font>n'<font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Red>]</font> free<font color=Cyan>)</font>
<a name="line-268"></a>
<a name="line-269"></a><a name="xintmap_inserts"></a><font color=Blue><i>-- | Insert a list of key-value pairs in the 'XIntMap'.</i></font>
<a name="line-270"></a><font color=Blue>xintmap_inserts</font> <font color=Red>::</font> <font color=Red>[</font><font color=Cyan>(</font>Int<font color=Cyan>,</font>a<font color=Cyan>)</font><font color=Red>]</font> <font color=Red>-&gt;</font> XIntMap a <font color=Red>-&gt;</font> XIntMap a
<a name="line-271"></a><font color=Blue>xintmap_inserts</font> list map <font color=Red>=</font>
<a name="line-272"></a>  foldl' <font color=Cyan>(</font><font color=Red>\</font>map <font color=Cyan>(</font>k<font color=Cyan>,</font>v<font color=Cyan>)</font> <font color=Red>-&gt;</font> xintmap_insert k v map<font color=Cyan>)</font> map list
<a name="line-273"></a>
<a name="line-274"></a><a name="xintmap_lookup"></a><font color=Blue><i>-- | Look up the value at a key in the 'XIntMap'. Return 'Nothing' if</i></font>
<a name="line-275"></a><font color=Blue><i>-- not found.</i></font>
<a name="line-276"></a><font color=Blue>xintmap_lookup</font> <font color=Red>::</font> Int <font color=Red>-&gt;</font> XIntMap a <font color=Red>-&gt;</font> Maybe a
<a name="line-277"></a><font color=Blue>xintmap_lookup</font> k <font color=Cyan>(</font>XIntMap m n free h<font color=Cyan>)</font> <font color=Red>=</font>
<a name="line-278"></a>  IntMap<font color=Cyan>.</font>lookup k m
<a name="line-279"></a>
<a name="line-280"></a><a name="xintmap_member"></a><font color=Blue><i>-- | Check whether the given key is in the 'XIntMap'.</i></font>
<a name="line-281"></a><font color=Blue>xintmap_member</font> <font color=Red>::</font> Int <font color=Red>-&gt;</font> XIntMap a <font color=Red>-&gt;</font> Bool
<a name="line-282"></a><font color=Blue>xintmap_member</font> k <font color=Cyan>(</font>XIntMap m n free h<font color=Cyan>)</font> <font color=Red>=</font>
<a name="line-283"></a>    IntMap<font color=Cyan>.</font>member k m
<a name="line-284"></a>
<a name="line-285"></a><a name="xintmap_empty"></a><font color=Blue><i>-- | The empty 'XIntMap'.</i></font>
<a name="line-286"></a><font color=Blue>xintmap_empty</font> <font color=Red>::</font> XIntMap a
<a name="line-287"></a><font color=Blue>xintmap_empty</font> <font color=Red>=</font> <font color=Cyan>(</font>XIntMap m n free h<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-288"></a>  m <font color=Red>=</font> IntMap<font color=Cyan>.</font>empty
<a name="line-289"></a>  n <font color=Red>=</font> <font color=Magenta>0</font>
<a name="line-290"></a>  free <font color=Red>=</font> IntSet<font color=Cyan>.</font>empty
<a name="line-291"></a>  h <font color=Red>=</font> IntSet<font color=Cyan>.</font>empty
<a name="line-292"></a>
<a name="line-293"></a><a name="xintmap_freshkey"></a><font color=Blue><i>-- | Return the first free key in the 'XIntMap', but without actually</i></font>
<a name="line-294"></a><font color=Blue><i>-- using it yet.</i></font>
<a name="line-295"></a><font color=Blue>xintmap_freshkey</font> <font color=Red>::</font> XIntMap a <font color=Red>-&gt;</font> Int
<a name="line-296"></a><font color=Blue>xintmap_freshkey</font> <font color=Cyan>(</font>XIntMap m n free h<font color=Cyan>)</font> <font color=Red>=</font> 
<a name="line-297"></a>  <font color=Green><u>if</u></font> IntSet<font color=Cyan>.</font>null free <font color=Green><u>then</u></font> n <font color=Green><u>else</u></font> IntSet<font color=Cyan>.</font>findMin free
<a name="line-298"></a>
<a name="line-299"></a><a name="xintmap_freshkeys"></a><font color=Blue><i>-- | Return the next /k/ unused keys in the 'XIntMap', but without</i></font>
<a name="line-300"></a><font color=Blue><i>-- actually using them yet.</i></font>
<a name="line-301"></a><font color=Blue>xintmap_freshkeys</font> <font color=Red>::</font> Int <font color=Red>-&gt;</font> XIntMap a <font color=Red>-&gt;</font> <font color=Red>[</font>Int<font color=Red>]</font>
<a name="line-302"></a><font color=Blue>xintmap_freshkeys</font> k <font color=Cyan>(</font>XIntMap m n free h<font color=Cyan>)</font> <font color=Red>=</font> ks1 <font color=Cyan>++</font> ks2 <font color=Green><u>where</u></font>
<a name="line-303"></a>  ks1 <font color=Red>=</font> take k <font color=Cyan>(</font>IntSet<font color=Cyan>.</font>elems free<font color=Cyan>)</font>
<a name="line-304"></a>  delta <font color=Red>=</font> k <font color=Blue><i>-</i></font> <font color=Cyan>(</font>length ks1<font color=Cyan>)</font>
<a name="line-305"></a>  ks2 <font color=Red>=</font> <font color=Red>[</font>n <font color=Red>..</font> n<font color=Cyan>+</font>delta<font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Red>]</font>
<a name="line-306"></a>
<a name="line-307"></a><a name="xintmap_to_intmap"></a><font color=Blue><i>-- | Convert a 'XIntMap' to an 'IntMap'.</i></font>
<a name="line-308"></a><font color=Blue>xintmap_to_intmap</font> <font color=Red>::</font> XIntMap a <font color=Red>-&gt;</font> IntMap a
<a name="line-309"></a><font color=Blue>xintmap_to_intmap</font> <font color=Cyan>(</font>XIntMap m n free h<font color=Cyan>)</font> <font color=Red>=</font> m
<a name="line-310"></a>
<a name="line-311"></a><a name="xintmap_size"></a><font color=Blue><i>-- | Return the smallest key never used in the 'XIntMap'.</i></font>
<a name="line-312"></a><font color=Blue>xintmap_size</font> <font color=Red>::</font> XIntMap a <font color=Red>-&gt;</font> Int
<a name="line-313"></a><font color=Blue>xintmap_size</font> <font color=Cyan>(</font>XIntMap m n free k<font color=Cyan>)</font> <font color=Red>=</font> n
<a name="line-314"></a>
<a name="line-315"></a><a name="xintmap_touched"></a><font color=Blue><i>-- | Return the set of all keys ever used in the 'XIntMap'.</i></font>
<a name="line-316"></a><font color=Blue>xintmap_touched</font> <font color=Red>::</font> XIntMap a <font color=Red>-&gt;</font> IntSet
<a name="line-317"></a><font color=Blue>xintmap_touched</font> <font color=Cyan>(</font>XIntMap m n free h<font color=Cyan>)</font> <font color=Red>=</font> h 
<a name="line-318"></a>
<a name="line-319"></a><a name="xintmap_dirty"></a><font color=Blue><i>-- | A wire is /dirty/ if it is touched but currently free. </i></font>
<a name="line-320"></a><font color=Blue>xintmap_dirty</font> <font color=Red>::</font> XIntMap a <font color=Red>-&gt;</font> IntSet
<a name="line-321"></a><font color=Blue>xintmap_dirty</font> <font color=Cyan>(</font>XIntMap m n free h<font color=Cyan>)</font> <font color=Red>=</font> h <font color=Cyan>`</font>IntSet<font color=Cyan>.</font>intersection<font color=Cyan>`</font> free
<a name="line-322"></a>
<a name="line-323"></a><a name="xintmap_reserve"></a><font color=Blue><i>-- | Reserve a key in the 'XIntMap'. If the key is not free, do</i></font>
<a name="line-324"></a><font color=Blue><i>-- nothing. The key must have been used before; for example, this is</i></font>
<a name="line-325"></a><font color=Blue><i>-- the case if it was returned by 'xintmap_dirty'.</i></font>
<a name="line-326"></a><font color=Blue>xintmap_reserve</font> <font color=Red>::</font> Int <font color=Red>-&gt;</font> XIntMap a <font color=Red>-&gt;</font> XIntMap a
<a name="line-327"></a><font color=Blue>xintmap_reserve</font> k <font color=Cyan>(</font>XIntMap m n free h<font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font>XIntMap m n free' h<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-328"></a>  free' <font color=Red>=</font> IntSet<font color=Cyan>.</font>delete k free
<a name="line-329"></a>  
<a name="line-330"></a><a name="xintmap_reserves"></a><font color=Blue><i>-- | Reserve a set of keys in the 'XIntMap'. For any keys that are not</i></font>
<a name="line-331"></a><font color=Blue><i>-- free, do nothing. All keys must have been used before; for example,</i></font>
<a name="line-332"></a><font color=Blue><i>-- this is the case if they were returned by 'xintmap_dirty'.</i></font>
<a name="line-333"></a><font color=Blue>xintmap_reserves</font> <font color=Red>::</font> IntSet <font color=Red>-&gt;</font> XIntMap a <font color=Red>-&gt;</font> XIntMap a
<a name="line-334"></a><font color=Blue>xintmap_reserves</font> ks <font color=Cyan>(</font>XIntMap m n free h<font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font>XIntMap m n free' h<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-335"></a>  free' <font color=Red>=</font> free <font color=Cyan>`</font>IntSet<font color=Cyan>.</font>difference<font color=Cyan>`</font> ks
<a name="line-336"></a>
<a name="line-337"></a><a name="xintmap_unreserve"></a><font color=Blue><i>-- | Unreserve a key in the 'XIntMap'. If the key is currently used,</i></font>
<a name="line-338"></a><font color=Blue><i>-- do nothing. The key must have been reserved before, and (therefore)</i></font>
<a name="line-339"></a><font color=Blue><i>-- must have been used before.</i></font>
<a name="line-340"></a><font color=Blue>xintmap_unreserve</font> <font color=Red>::</font> Int <font color=Red>-&gt;</font> XIntMap a <font color=Red>-&gt;</font> XIntMap a
<a name="line-341"></a><font color=Blue>xintmap_unreserve</font> k <font color=Cyan>(</font>XIntMap m n free h<font color=Cyan>)</font> 
<a name="line-342"></a>  <font color=Red>|</font> IntMap<font color=Cyan>.</font>member k m <font color=Red>=</font> <font color=Cyan>(</font>XIntMap m n free h<font color=Cyan>)</font>
<a name="line-343"></a>  <font color=Red>|</font> otherwise <font color=Red>=</font> <font color=Cyan>(</font>XIntMap m n free' h<font color=Cyan>)</font>
<a name="line-344"></a>    <font color=Green><u>where</u></font>
<a name="line-345"></a>      free' <font color=Red>=</font> IntSet<font color=Cyan>.</font>insert k free
<a name="line-346"></a>
<a name="line-347"></a><a name="xintmap_unreserves"></a><font color=Blue><i>-- | Unreserve a list of keys in the 'XIntMap'. If any key is</i></font>
<a name="line-348"></a><font color=Blue><i>-- currently used, do nothing. All keys must have been reserved</i></font>
<a name="line-349"></a><font color=Blue><i>-- before, and (therefore) must have been used before.</i></font>
<a name="line-350"></a><font color=Blue>xintmap_unreserves</font> <font color=Red>::</font> IntSet <font color=Red>-&gt;</font> XIntMap a <font color=Red>-&gt;</font> XIntMap a
<a name="line-351"></a><font color=Blue>xintmap_unreserves</font> ks map <font color=Red>=</font> 
<a name="line-352"></a>  IntSet<font color=Cyan>.</font>fold <font color=Cyan>(</font><font color=Red>\</font>k map <font color=Red>-&gt;</font> xintmap_unreserve k map<font color=Cyan>)</font> map ks
<a name="line-353"></a>
<a name="line-354"></a><a name="xintmap_makeclean"></a><font color=Blue><i>-- | Make an exact copy of the 'XIntMap', except that the set of</i></font>
<a name="line-355"></a><font color=Blue><i>-- touched wires is initially set to the set of used wires. In other</i></font>
<a name="line-356"></a><font color=Blue><i>-- words, we mark all free and reserved wires as untouched.</i></font>
<a name="line-357"></a><font color=Blue>xintmap_makeclean</font> <font color=Red>::</font> XIntMap a <font color=Red>-&gt;</font> XIntMap a
<a name="line-358"></a><font color=Blue>xintmap_makeclean</font> <font color=Cyan>(</font>XIntMap m n free h<font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font>XIntMap m n free h'<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-359"></a>  h' <font color=Red>=</font> IntMap<font color=Cyan>.</font>keysSet m
<a name="line-360"></a>
<a name="line-361"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-362"></a><font color=Blue><i>-- * Map- and fold-like list combinators</i></font>
<a name="line-363"></a>
<a name="line-364"></a><font color=Blue><i>-- ** Combinators for looping</i></font>
<a name="line-365"></a>
<a name="line-366"></a><a name="loop_with_index"></a><font color=Blue><i>-- | Like 'loop', but also pass a loop counter to the function being</i></font>
<a name="line-367"></a><font color=Blue><i>-- iterated. Example:</i></font>
<a name="line-368"></a><font color=Blue><i>-- </i></font>
<a name="line-369"></a><font color=Blue><i>-- &gt; loop_with_index 3 x f = f 2 (f 1 (f 0 x))</i></font>
<a name="line-370"></a><font color=Blue>loop_with_index</font> <font color=Red>::</font> <font color=Cyan>(</font>Eq int<font color=Cyan>,</font> Num int<font color=Cyan>)</font> <font color=Red>=&gt;</font> int <font color=Red>-&gt;</font> t <font color=Red>-&gt;</font> <font color=Cyan>(</font>int <font color=Red>-&gt;</font> t <font color=Red>-&gt;</font> t<font color=Cyan>)</font> <font color=Red>-&gt;</font> t
<a name="line-371"></a><font color=Blue>loop_with_index</font> n x f <font color=Red>=</font> aux <font color=Magenta>0</font> x
<a name="line-372"></a>  <font color=Green><u>where</u></font>
<a name="line-373"></a>    aux i x <font color=Red>=</font> <font color=Green><u>if</u></font> i <font color=Cyan>==</font> n <font color=Green><u>then</u></font> x <font color=Green><u>else</u></font> aux <font color=Cyan>(</font>i<font color=Cyan>+</font><font color=Magenta>1</font><font color=Cyan>)</font> <font color=Cyan>(</font>f i x<font color=Cyan>)</font>
<a name="line-374"></a>
<a name="line-375"></a><a name="loop_with_indexM"></a><font color=Blue><i>-- | Monadic version of 'loop_with_index'. Thus, </i></font>
<a name="line-376"></a><font color=Blue><i>-- </i></font>
<a name="line-377"></a><font color=Blue><i>-- &gt; loop_with_indexM 3 x0 f</i></font>
<a name="line-378"></a><font color=Blue><i>-- </i></font>
<a name="line-379"></a><font color=Blue><i>-- will do the following:</i></font>
<a name="line-380"></a><font color=Blue><i>-- </i></font>
<a name="line-381"></a><font color=Blue><i>-- &gt; do</i></font>
<a name="line-382"></a><font color=Blue><i>-- &gt;   x1 &lt;- f 0 x0</i></font>
<a name="line-383"></a><font color=Blue><i>-- &gt;   x2 &lt;- f 1 x1</i></font>
<a name="line-384"></a><font color=Blue><i>-- &gt;   x3 &lt;- f 2 x2    </i></font>
<a name="line-385"></a><font color=Blue><i>-- &gt;   return x3</i></font>
<a name="line-386"></a><font color=Blue>loop_with_indexM</font> <font color=Red>::</font> <font color=Cyan>(</font>Eq int<font color=Cyan>,</font> Num int<font color=Cyan>,</font> Monad m<font color=Cyan>)</font> <font color=Red>=&gt;</font> int <font color=Red>-&gt;</font> t <font color=Red>-&gt;</font> <font color=Cyan>(</font>int <font color=Red>-&gt;</font> t <font color=Red>-&gt;</font> m t<font color=Cyan>)</font> <font color=Red>-&gt;</font> m t
<a name="line-387"></a><font color=Blue>loop_with_indexM</font> n x f <font color=Red>=</font> aux <font color=Magenta>0</font> x
<a name="line-388"></a>  <font color=Green><u>where</u></font>
<a name="line-389"></a>    aux i x <font color=Red>=</font>
<a name="line-390"></a>      <font color=Green><u>if</u></font> i <font color=Cyan>==</font> n <font color=Green><u>then</u></font> return x <font color=Green><u>else</u></font> <font color=Green><u>do</u></font>
<a name="line-391"></a>        x <font color=Red>&lt;-</font> f i x
<a name="line-392"></a>        aux <font color=Cyan>(</font>i<font color=Cyan>+</font><font color=Magenta>1</font><font color=Cyan>)</font> x
<a name="line-393"></a>
<a name="line-394"></a><a name="loop"></a><font color=Blue><i>-- | Iterate a function /n/ times. Example: </i></font>
<a name="line-395"></a><font color=Blue><i>-- </i></font>
<a name="line-396"></a><font color=Blue><i>-- &gt; loop 3 x f = f (f (f x))</i></font>
<a name="line-397"></a><font color=Blue>loop</font> <font color=Red>::</font> <font color=Cyan>(</font>Eq int<font color=Cyan>,</font> Num int<font color=Cyan>)</font> <font color=Red>=&gt;</font> int <font color=Red>-&gt;</font> t <font color=Red>-&gt;</font> <font color=Cyan>(</font>t <font color=Red>-&gt;</font> t<font color=Cyan>)</font> <font color=Red>-&gt;</font> t
<a name="line-398"></a><font color=Blue>loop</font> n x f <font color=Red>=</font> loop_with_index n x <font color=Cyan>(</font><font color=Red>\</font><font color=Green><u>_</u></font> <font color=Red>-&gt;</font> f<font color=Cyan>)</font>
<a name="line-399"></a>
<a name="line-400"></a><a name="loopM"></a><font color=Blue><i>-- | Monadic version of 'loop'.</i></font>
<a name="line-401"></a><font color=Blue>loopM</font> <font color=Red>::</font> <font color=Cyan>(</font>Eq int<font color=Cyan>,</font> Num int<font color=Cyan>,</font> Monad m<font color=Cyan>)</font> <font color=Red>=&gt;</font> int <font color=Red>-&gt;</font> t <font color=Red>-&gt;</font> <font color=Cyan>(</font>t <font color=Red>-&gt;</font> m t<font color=Cyan>)</font> <font color=Red>-&gt;</font> m t
<a name="line-402"></a><font color=Blue>loopM</font> n x f <font color=Red>=</font> loop_with_indexM n x <font color=Cyan>(</font><font color=Red>\</font><font color=Green><u>_</u></font> <font color=Red>-&gt;</font> f<font color=Cyan>)</font>
<a name="line-403"></a>
<a name="line-404"></a><font color=Blue><i>-- ** Combinators for sequencing</i></font>
<a name="line-405"></a>
<a name="line-406"></a><a name="sequence_right"></a><font color=Blue><i>-- | A right-to-left version of 'sequence': Evaluate each action in the</i></font>
<a name="line-407"></a><font color=Blue><i>-- sequence from right to left, and collect the results.</i></font>
<a name="line-408"></a><font color=Blue>sequence_right</font> <font color=Red>::</font> Monad m <font color=Red>=&gt;</font> <font color=Red>[</font>m a<font color=Red>]</font> <font color=Red>-&gt;</font> m <font color=Red>[</font>a<font color=Red>]</font>
<a name="line-409"></a><font color=Blue>sequence_right</font> [] <font color=Red>=</font> return []
<a name="line-410"></a><font color=Blue>sequence_right</font> <font color=Cyan>(</font>x<font color=Red><b>:</b></font>xs<font color=Cyan>)</font> <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-411"></a>  ys <font color=Red>&lt;-</font> sequence_right xs
<a name="line-412"></a>  y <font color=Red>&lt;-</font> x
<a name="line-413"></a>  return <font color=Cyan>(</font>y<font color=Red><b>:</b></font>ys<font color=Cyan>)</font>
<a name="line-414"></a>
<a name="line-415"></a><a name="sequence_right_"></a><font color=Blue><i>-- | Same as 'sequence_right', but ignore the result.</i></font>
<a name="line-416"></a><font color=Blue>sequence_right_</font> <font color=Red>::</font> Monad m <font color=Red>=&gt;</font> <font color=Red>[</font>m a<font color=Red>]</font> <font color=Red>-&gt;</font> m ()
<a name="line-417"></a><font color=Blue>sequence_right_</font> [] <font color=Red>=</font> return ()
<a name="line-418"></a><font color=Blue>sequence_right_</font> <font color=Cyan>(</font>x<font color=Red><b>:</b></font>xs<font color=Cyan>)</font> <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-419"></a>  ys <font color=Red>&lt;-</font> sequence_right_ xs
<a name="line-420"></a>  y <font color=Red>&lt;-</font> x
<a name="line-421"></a>  return ()
<a name="line-422"></a>
<a name="line-423"></a><font color=Blue><i>-- ** Combinators for zipping</i></font>
<a name="line-424"></a>
<a name="line-425"></a><a name="zip_strict"></a><font color=Blue><i>-- | A \"strict\" version of 'zip', i.e., raises an error when the</i></font>
<a name="line-426"></a><font color=Blue><i>-- lists are not of the same length.</i></font>
<a name="line-427"></a><font color=Blue>zip_strict</font> <font color=Red>::</font> <font color=Red>[</font>a<font color=Red>]</font> <font color=Red>-&gt;</font> <font color=Red>[</font>b<font color=Red>]</font> <font color=Red>-&gt;</font> <font color=Red>[</font><font color=Cyan>(</font>a<font color=Cyan>,</font> b<font color=Cyan>)</font><font color=Red>]</font>
<a name="line-428"></a><font color=Blue>zip_strict</font> a b <font color=Red>=</font> zip_strict_errmsg a b <font color=Magenta>"zip_strict: lists are not of the same length"</font>
<a name="line-429"></a>
<a name="line-430"></a><a name="zip_strict_errmsg"></a><font color=Blue><i>-- | Like 'zip_strict', but also takes an explicit error message to</i></font>
<a name="line-431"></a><font color=Blue><i>-- use in case of failure.</i></font>
<a name="line-432"></a><font color=Blue>zip_strict_errmsg</font> <font color=Red>::</font> <font color=Red>[</font>a<font color=Red>]</font> <font color=Red>-&gt;</font> <font color=Red>[</font>b<font color=Red>]</font> <font color=Red>-&gt;</font> String <font color=Red>-&gt;</font> <font color=Red>[</font><font color=Cyan>(</font>a<font color=Cyan>,</font> b<font color=Cyan>)</font><font color=Red>]</font>
<a name="line-433"></a><font color=Blue>zip_strict_errmsg</font> [] [] e <font color=Red>=</font> []
<a name="line-434"></a><font color=Blue>zip_strict_errmsg</font> <font color=Cyan>(</font>h<font color=Red><b>:</b></font>t<font color=Cyan>)</font> <font color=Cyan>(</font>h'<font color=Red><b>:</b></font>t'<font color=Cyan>)</font> e <font color=Red>=</font> <font color=Cyan>(</font>h<font color=Cyan>,</font>h'<font color=Cyan>)</font> <font color=Red><b>:</b></font> zip_strict_errmsg t t' e
<a name="line-435"></a><font color=Blue>zip_strict_errmsg</font> <font color=Green><u>_</u></font> <font color=Green><u>_</u></font> e <font color=Red>=</font> error e
<a name="line-436"></a>
<a name="line-437"></a><a name="zip_rightstrict"></a><font color=Blue><i>-- | A \"right strict\" version of 'zip', i.e., raises an error when the</i></font>
<a name="line-438"></a><font color=Blue><i>-- left list is shorter than the right one. </i></font>
<a name="line-439"></a><font color=Blue>zip_rightstrict</font> <font color=Red>::</font> <font color=Red>[</font>a<font color=Red>]</font> <font color=Red>-&gt;</font> <font color=Red>[</font>b<font color=Red>]</font> <font color=Red>-&gt;</font> <font color=Red>[</font><font color=Cyan>(</font>a<font color=Cyan>,</font> b<font color=Cyan>)</font><font color=Red>]</font>
<a name="line-440"></a><font color=Blue>zip_rightstrict</font> a b <font color=Red>=</font> zip_rightstrict_errmsg a b <font color=Magenta>"zip_rightstrict: list too short"</font>
<a name="line-441"></a>
<a name="line-442"></a><a name="zip_rightstrict_errmsg"></a><font color=Blue><i>-- | A version of 'zip_rightstrict' that also takes an explicit error</i></font>
<a name="line-443"></a><font color=Blue><i>-- message to use in case of failure.</i></font>
<a name="line-444"></a><font color=Blue>zip_rightstrict_errmsg</font> <font color=Red>::</font> <font color=Red>[</font>a<font color=Red>]</font> <font color=Red>-&gt;</font> <font color=Red>[</font>b<font color=Red>]</font> <font color=Red>-&gt;</font> String <font color=Red>-&gt;</font> <font color=Red>[</font><font color=Cyan>(</font>a<font color=Cyan>,</font> b<font color=Cyan>)</font><font color=Red>]</font>
<a name="line-445"></a><font color=Blue>zip_rightstrict_errmsg</font> <font color=Green><u>_</u></font> [] s <font color=Red>=</font> []
<a name="line-446"></a><font color=Blue>zip_rightstrict_errmsg</font> <font color=Cyan>(</font>h<font color=Red><b>:</b></font>t<font color=Cyan>)</font> <font color=Cyan>(</font>h'<font color=Red><b>:</b></font>t'<font color=Cyan>)</font> s <font color=Red>=</font> <font color=Cyan>(</font>h<font color=Cyan>,</font>h'<font color=Cyan>)</font> <font color=Red><b>:</b></font> zip_rightstrict_errmsg t t' s
<a name="line-447"></a><font color=Blue>zip_rightstrict_errmsg</font> <font color=Green><u>_</u></font> <font color=Green><u>_</u></font> s <font color=Red>=</font> error s
<a name="line-448"></a>
<a name="line-449"></a><a name="zipWith_strict"></a><font color=Blue><i>-- | A \"strict\" version of 'zipWith', i.e., raises an error when the</i></font>
<a name="line-450"></a><font color=Blue><i>-- lists are not of the same length.</i></font>
<a name="line-451"></a><font color=Blue>zipWith_strict</font> <font color=Red>::</font> <font color=Cyan>(</font>a <font color=Red>-&gt;</font> b <font color=Red>-&gt;</font> c<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Red>[</font>a<font color=Red>]</font> <font color=Red>-&gt;</font> <font color=Red>[</font>b<font color=Red>]</font> <font color=Red>-&gt;</font> <font color=Red>[</font>c<font color=Red>]</font>
<a name="line-452"></a><font color=Blue>zipWith_strict</font> f [] [] <font color=Red>=</font> []
<a name="line-453"></a><font color=Blue>zipWith_strict</font> f <font color=Cyan>(</font>h<font color=Red><b>:</b></font>t<font color=Cyan>)</font> <font color=Cyan>(</font>h'<font color=Red><b>:</b></font>t'<font color=Cyan>)</font> <font color=Red>=</font> f h h' <font color=Red><b>:</b></font> zipWith_strict f t t'
<a name="line-454"></a><font color=Blue>zipWith_strict</font> f <font color=Green><u>_</u></font> <font color=Green><u>_</u></font> <font color=Red>=</font> error <font color=Magenta>"zipWith_strict: lists are not of the same length"</font>
<a name="line-455"></a>
<a name="line-456"></a><a name="zipWith_rightstrict"></a><font color=Blue><i>-- | A \"right strict\" version of 'zipWith', i.e., raises an error when the</i></font>
<a name="line-457"></a><font color=Blue><i>-- right list is shorter than the left one.</i></font>
<a name="line-458"></a><font color=Blue>zipWith_rightstrict</font> <font color=Red>::</font> <font color=Cyan>(</font>a <font color=Red>-&gt;</font> b <font color=Red>-&gt;</font> c<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Red>[</font>a<font color=Red>]</font> <font color=Red>-&gt;</font> <font color=Red>[</font>b<font color=Red>]</font> <font color=Red>-&gt;</font> <font color=Red>[</font>c<font color=Red>]</font>
<a name="line-459"></a><font color=Blue>zipWith_rightstrict</font> f <font color=Green><u>_</u></font> [] <font color=Red>=</font> []
<a name="line-460"></a><font color=Blue>zipWith_rightstrict</font> f <font color=Cyan>(</font>h<font color=Red><b>:</b></font>t<font color=Cyan>)</font> <font color=Cyan>(</font>h'<font color=Red><b>:</b></font>t'<font color=Cyan>)</font> <font color=Red>=</font> f h h' <font color=Red><b>:</b></font> zipWith_rightstrict f t t'
<a name="line-461"></a><font color=Blue>zipWith_rightstrict</font> f <font color=Green><u>_</u></font> <font color=Green><u>_</u></font> <font color=Red>=</font> error <font color=Magenta>"zipWith_rightstrict: list too short"</font>
<a name="line-462"></a>
<a name="line-463"></a><a name="zipRightWithRightStrictM"></a><font color=Blue><i>-- | A right-to-left version of 'zipWithM', which is also \"right</i></font>
<a name="line-464"></a><font color=Blue><i>-- strict\", i.e., raises an error when the right list is shorter than</i></font>
<a name="line-465"></a><font color=Blue><i>-- the left one. Example:</i></font>
<a name="line-466"></a><font color=Blue><i>-- </i></font>
<a name="line-467"></a><font color=Blue><i>-- &gt; zipRightWithM f [a,b] [x,y] = [f a x, f b y],</i></font>
<a name="line-468"></a><font color=Blue><i>-- </i></font>
<a name="line-469"></a><font color=Blue><i>-- computed right-to-left.</i></font>
<a name="line-470"></a><font color=Blue>zipRightWithRightStrictM</font> <font color=Red>::</font> <font color=Cyan>(</font>Monad m<font color=Cyan>)</font> <font color=Red>=&gt;</font> <font color=Cyan>(</font>a <font color=Red>-&gt;</font> b <font color=Red>-&gt;</font> m c<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Red>[</font>a<font color=Red>]</font> <font color=Red>-&gt;</font> <font color=Red>[</font>b<font color=Red>]</font> <font color=Red>-&gt;</font> m <font color=Red>[</font>c<font color=Red>]</font>
<a name="line-471"></a><font color=Blue>zipRightWithRightStrictM</font> f l1 l2 <font color=Red>=</font>
<a name="line-472"></a>  sequence_right <font color=Cyan>$</font> zipWith_rightstrict f l1 l2
<a name="line-473"></a>
<a name="line-474"></a><a name="zipRightWithRightStrictM_"></a><font color=Blue><i>-- | Same as 'zipRightWithM', but ignore the result.</i></font>
<a name="line-475"></a><font color=Blue>zipRightWithRightStrictM_</font> <font color=Red>::</font> <font color=Cyan>(</font>Monad m<font color=Cyan>)</font> <font color=Red>=&gt;</font> <font color=Cyan>(</font>a <font color=Red>-&gt;</font> b <font color=Red>-&gt;</font> m c<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Red>[</font>a<font color=Red>]</font> <font color=Red>-&gt;</font> <font color=Red>[</font>b<font color=Red>]</font> <font color=Red>-&gt;</font> m ()
<a name="line-476"></a><font color=Blue>zipRightWithRightStrictM_</font> f l1 l2 <font color=Red>=</font>
<a name="line-477"></a>  sequence_right_ <font color=Cyan>$</font> zipWith_rightstrict f l1 l2
<a name="line-478"></a>
<a name="line-479"></a><font color=Blue><i>-- ** Combinators combining mapping with folding</i></font>
<a name="line-480"></a>
<a name="line-481"></a><a name="foldRightPairM"></a><font color=Blue><i>-- | Fold over two lists with state, and do it right-to-left.  For example,</i></font>
<a name="line-482"></a><font color=Blue><i>-- </i></font>
<a name="line-483"></a><font color=Blue><i>-- &gt; foldRightPairM (w0, [1,2,3], [a,b,c]) f</i></font>
<a name="line-484"></a><font color=Blue><i>-- </i></font>
<a name="line-485"></a><font color=Blue><i>-- will do the following:</i></font>
<a name="line-486"></a><font color=Blue><i>-- </i></font>
<a name="line-487"></a><font color=Blue><i>-- &gt; do</i></font>
<a name="line-488"></a><font color=Blue><i>-- &gt;   w1 &lt;- f (w0, 3, c)</i></font>
<a name="line-489"></a><font color=Blue><i>-- &gt;   w2 &lt;- f (w1, 2, b)</i></font>
<a name="line-490"></a><font color=Blue><i>-- &gt;   w3 &lt;- f (w2, 1, a)</i></font>
<a name="line-491"></a><font color=Blue><i>-- &gt;   return w3</i></font>
<a name="line-492"></a><font color=Blue>foldRightPairM</font> <font color=Red>::</font> <font color=Cyan>(</font>Monad m<font color=Cyan>)</font> <font color=Red>=&gt;</font> <font color=Cyan>(</font>w<font color=Cyan>,</font> <font color=Red>[</font>a<font color=Red>]</font><font color=Cyan>,</font> <font color=Red>[</font>b<font color=Red>]</font><font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font><font color=Cyan>(</font>w<font color=Cyan>,</font> a<font color=Cyan>,</font> b<font color=Cyan>)</font> <font color=Red>-&gt;</font> m w<font color=Cyan>)</font> <font color=Red>-&gt;</font> m w
<a name="line-493"></a><font color=Blue>foldRightPairM</font> <font color=Cyan>(</font>w<font color=Cyan>,</font> []<font color=Cyan>,</font> <font color=Green><u>_</u></font><font color=Cyan>)</font> f <font color=Red>=</font> return w
<a name="line-494"></a><font color=Blue>foldRightPairM</font> <font color=Cyan>(</font>w<font color=Cyan>,</font> <font color=Green><u>_</u></font><font color=Cyan>,</font> []<font color=Cyan>)</font> f <font color=Red>=</font> return w
<a name="line-495"></a><font color=Blue>foldRightPairM</font> <font color=Cyan>(</font>w<font color=Cyan>,</font> a<font color=Red><b>:</b></font><font color=Green><u>as</u></font><font color=Cyan>,</font> b<font color=Red><b>:</b></font>bs<font color=Cyan>)</font> f <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-496"></a>  w <font color=Red>&lt;-</font> foldRightPairM <font color=Cyan>(</font>w<font color=Cyan>,</font> <font color=Green><u>as</u></font><font color=Cyan>,</font> bs<font color=Cyan>)</font> f
<a name="line-497"></a>  w <font color=Red>&lt;-</font> f <font color=Cyan>(</font>w<font color=Cyan>,</font> a<font color=Cyan>,</font> b<font color=Cyan>)</font>
<a name="line-498"></a>  return w
<a name="line-499"></a>
<a name="line-500"></a><a name="foldRightPairM_"></a><font color=Blue><i>-- | Like 'foldRightPairM', but ignore the final result.</i></font>
<a name="line-501"></a><font color=Blue>foldRightPairM_</font> <font color=Red>::</font> <font color=Cyan>(</font>Monad m<font color=Cyan>)</font> <font color=Red>=&gt;</font> <font color=Cyan>(</font>w<font color=Cyan>,</font> <font color=Red>[</font>a<font color=Red>]</font><font color=Cyan>,</font> <font color=Red>[</font>b<font color=Red>]</font><font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font><font color=Cyan>(</font>w<font color=Cyan>,</font> a<font color=Cyan>,</font> b<font color=Cyan>)</font> <font color=Red>-&gt;</font> m w<font color=Cyan>)</font> <font color=Red>-&gt;</font> m ()
<a name="line-502"></a><font color=Blue>foldRightPairM_</font> x f <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-503"></a>  foldRightPairM x f
<a name="line-504"></a>  return ()
<a name="line-505"></a>
<a name="line-506"></a><a name="fold_right_zip"></a><font color=Blue><i>-- | Combine right-to-left zipping and folding. Example:</i></font>
<a name="line-507"></a><font color=Blue><i>-- </i></font>
<a name="line-508"></a><font color=Blue><i>-- &gt; fold_right_zip f (w0, [a,b,c], [x,y,z]) = (w3, [a',b',c'])</i></font>
<a name="line-509"></a><font color=Blue><i>-- &gt;  where f (w0,c,z) = (w1,c')</i></font>
<a name="line-510"></a><font color=Blue><i>-- &gt;        f (w1,b,y) = (w2,b')</i></font>
<a name="line-511"></a><font color=Blue><i>-- &gt;        f (w2,a,x) = (w3,a')</i></font>
<a name="line-512"></a><font color=Blue>fold_right_zip</font> <font color=Red>::</font> <font color=Cyan>(</font><font color=Cyan>(</font>w<font color=Cyan>,</font> a<font color=Cyan>,</font> b<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font>w<font color=Cyan>,</font> c<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font>w<font color=Cyan>,</font> <font color=Red>[</font>a<font color=Red>]</font><font color=Cyan>,</font> <font color=Red>[</font>b<font color=Red>]</font><font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font>w<font color=Cyan>,</font> <font color=Red>[</font>c<font color=Red>]</font><font color=Cyan>)</font>
<a name="line-513"></a><font color=Blue>fold_right_zip</font> f <font color=Cyan>(</font>w<font color=Cyan>,</font> []<font color=Cyan>,</font> []<font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font>w<font color=Cyan>,</font> []<font color=Cyan>)</font>
<a name="line-514"></a><font color=Blue>fold_right_zip</font> f <font color=Cyan>(</font>w<font color=Cyan>,</font> a<font color=Red><b>:</b></font>bb<font color=Cyan>,</font> x<font color=Red><b>:</b></font>yy<font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font>w2<font color=Cyan>,</font> a'<font color=Red><b>:</b></font>bb'<font color=Cyan>)</font>
<a name="line-515"></a>  <font color=Green><u>where</u></font>
<a name="line-516"></a>    <font color=Cyan>(</font>w1<font color=Cyan>,</font> bb'<font color=Cyan>)</font> <font color=Red>=</font> fold_right_zip f <font color=Cyan>(</font>w<font color=Cyan>,</font> bb<font color=Cyan>,</font> yy<font color=Cyan>)</font>
<a name="line-517"></a>    <font color=Cyan>(</font>w2<font color=Cyan>,</font> a'<font color=Cyan>)</font> <font color=Red>=</font> f <font color=Cyan>(</font>w1<font color=Cyan>,</font> a<font color=Cyan>,</font> x<font color=Cyan>)</font>
<a name="line-518"></a><font color=Blue>fold_right_zip</font> f <font color=Green><u>_</u></font> <font color=Red>=</font> error <font color=Magenta>"fold_right_zip"</font>
<a name="line-519"></a>
<a name="line-520"></a><a name="fold_right_zipM"></a><font color=Blue><i>-- | Monadic version of 'fold_right_zip'.</i></font>
<a name="line-521"></a><font color=Blue>fold_right_zipM</font> <font color=Red>::</font>
<a name="line-522"></a>  <font color=Cyan>(</font>Monad m<font color=Cyan>)</font> <font color=Red>=&gt;</font> <font color=Cyan>(</font><font color=Cyan>(</font>w<font color=Cyan>,</font> a<font color=Cyan>,</font> b<font color=Cyan>)</font> <font color=Red>-&gt;</font> m<font color=Cyan>(</font>w<font color=Cyan>,</font> c<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font>w<font color=Cyan>,</font> <font color=Red>[</font>a<font color=Red>]</font><font color=Cyan>,</font> <font color=Red>[</font>b<font color=Red>]</font><font color=Cyan>)</font> <font color=Red>-&gt;</font> m<font color=Cyan>(</font>w<font color=Cyan>,</font> <font color=Red>[</font>c<font color=Red>]</font><font color=Cyan>)</font>
<a name="line-523"></a><font color=Blue>fold_right_zipM</font> f <font color=Cyan>(</font>w<font color=Cyan>,</font> []<font color=Cyan>,</font> []<font color=Cyan>)</font> <font color=Red>=</font> return <font color=Cyan>(</font>w<font color=Cyan>,</font> []<font color=Cyan>)</font>
<a name="line-524"></a><font color=Blue>fold_right_zipM</font> f <font color=Cyan>(</font>w<font color=Cyan>,</font> a<font color=Red><b>:</b></font>bb<font color=Cyan>,</font> x<font color=Red><b>:</b></font>yy<font color=Cyan>)</font> <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-525"></a>    <font color=Cyan>(</font>w1<font color=Cyan>,</font> bb'<font color=Cyan>)</font> <font color=Red>&lt;-</font> fold_right_zipM f <font color=Cyan>(</font>w<font color=Cyan>,</font> bb<font color=Cyan>,</font> yy<font color=Cyan>)</font>
<a name="line-526"></a>    <font color=Cyan>(</font>w2<font color=Cyan>,</font> a'<font color=Cyan>)</font> <font color=Red>&lt;-</font> f <font color=Cyan>(</font>w1<font color=Cyan>,</font> a<font color=Cyan>,</font> x<font color=Cyan>)</font>
<a name="line-527"></a>    return <font color=Cyan>(</font>w2<font color=Cyan>,</font> a'<font color=Red><b>:</b></font>bb'<font color=Cyan>)</font>
<a name="line-528"></a><font color=Blue>fold_right_zipM</font> f <font color=Green><u>_</u></font> <font color=Red>=</font> error <font color=Magenta>"fold_right_zipM"</font>
<a name="line-529"></a>
<a name="line-530"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-531"></a><font color=Blue><i>-- * Loops.</i></font>
<a name="line-532"></a>
<a name="line-533"></a><font color=Blue><i>-- $LOOPS We provide a syntax for \"for\"-style loops.</i></font>
<a name="line-534"></a>
<a name="line-535"></a><font color=Blue><i>-- | A \"for\" loop. Counts from /a/ to /b/ in increments of /s/.</i></font>
<a name="line-536"></a><font color=Blue><i>-- </i></font>
<a name="line-537"></a><font color=Blue><i>-- Standard notation: </i></font>
<a name="line-538"></a><font color=Blue><i>-- </i></font>
<a name="line-539"></a><font color=Blue><i>-- &gt; for i = a to b by s do</i></font>
<a name="line-540"></a><font color=Blue><i>-- &gt;   commands             </i></font>
<a name="line-541"></a><font color=Blue><i>-- &gt; end for</i></font>
<a name="line-542"></a><font color=Blue><i>-- </i></font>
<a name="line-543"></a><font color=Blue><i>-- Our notation: </i></font>
<a name="line-544"></a><font color=Blue><i>-- </i></font>
<a name="line-545"></a><font color=Blue><i>-- &gt; for a b s $ \i -&gt; do</i></font>
<a name="line-546"></a><font color=Blue><i>-- &gt;   commands</i></font>
<a name="line-547"></a><font color=Blue><i>-- &gt; endfor</i></font>
<a name="line-548"></a>
<a name="line-549"></a><a name="for"></a><font color=Blue>for</font> <font color=Red>::</font> Monad m <font color=Red>=&gt;</font> Int <font color=Red>-&gt;</font> Int <font color=Red>-&gt;</font> Int <font color=Red>-&gt;</font> <font color=Cyan>(</font>Int <font color=Red>-&gt;</font> m()<font color=Cyan>)</font> <font color=Red>-&gt;</font> m()
<a name="line-550"></a><font color=Blue>for</font> a b s f <font color=Red>=</font> <font color=Green><u>if</u></font> s <font color=Cyan>&gt;</font> <font color=Magenta>0</font> <font color=Green><u>then</u></font> aux a <font color=Cyan>(</font><font color=Cyan>&lt;=</font> b<font color=Cyan>)</font> <font color=Green><u>else</u></font> aux a <font color=Cyan>(</font><font color=Cyan>&gt;=</font> b<font color=Cyan>)</font>
<a name="line-551"></a>  <font color=Green><u>where</u></font>
<a name="line-552"></a>    aux i cond <font color=Red>=</font> 
<a name="line-553"></a>      <font color=Green><u>if</u></font> cond i <font color=Green><u>then</u></font> <font color=Green><u>do</u></font>
<a name="line-554"></a>        f i
<a name="line-555"></a>        aux <font color=Cyan>(</font>i<font color=Cyan>+</font>s<font color=Cyan>)</font> cond
<a name="line-556"></a>      <font color=Green><u>else</u></font>
<a name="line-557"></a>        return ()
<a name="line-558"></a>
<a name="line-559"></a><a name="endfor"></a><font color=Blue><i>-- | Mark the end of a \"for\"-loop. This command actually does</i></font>
<a name="line-560"></a><font color=Blue><i>-- nothing, but can be used to make the loop look prettier.</i></font>
<a name="line-561"></a><font color=Blue>endfor</font> <font color=Red>::</font> Monad m <font color=Red>=&gt;</font> m()
<a name="line-562"></a><font color=Blue>endfor</font> <font color=Red>=</font> return ()
<a name="line-563"></a>
<a name="line-564"></a><font color=Blue><i>-- | Iterate a parameter over a list of values. It can be used as</i></font>
<a name="line-565"></a><font color=Blue><i>-- follows:</i></font>
<a name="line-566"></a><font color=Blue><i>-- </i></font>
<a name="line-567"></a><font color=Blue><i>-- &gt; foreach [1,2,3,4] $ \n -&gt; do</i></font>
<a name="line-568"></a><font color=Blue><i>-- &gt;   &lt;&lt;&lt;loop body depending on the parameter n&gt;&gt;&gt;</i></font>
<a name="line-569"></a><font color=Blue><i>-- &gt; endfor</i></font>
<a name="line-570"></a><font color=Blue><i>-- </i></font>
<a name="line-571"></a><font color=Blue><i>-- The loop body will get executed once for each /n/ &#8712; {1,2,3,4}.</i></font>
<a name="line-572"></a>
<a name="line-573"></a><a name="foreach"></a><font color=Blue>foreach</font> <font color=Red>::</font> Monad m <font color=Red>=&gt;</font> <font color=Red>[</font>a<font color=Red>]</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font>a <font color=Red>-&gt;</font> m b<font color=Cyan>)</font> <font color=Red>-&gt;</font> m ()
<a name="line-574"></a><font color=Blue>foreach</font> l f <font color=Red>=</font> mapM_ f l
<a name="line-575"></a>
<a name="line-576"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-577"></a><font color=Blue><i>-- * Operations for monads</i></font>
<a name="line-578"></a>
<a name="line-579"></a><a name="mmap"></a><font color=Blue><i>-- | Every monad is a functor. Input a function /f/ : /a/ &#8594; /b/ and output</i></font>
<a name="line-580"></a><font color=Blue><i>-- /m/ /f/ : /m/ /a/ &#8594; /m/ /b/.</i></font>
<a name="line-581"></a><font color=Blue>mmap</font> <font color=Red>::</font> <font color=Cyan>(</font>Monad m<font color=Cyan>)</font> <font color=Red>=&gt;</font> <font color=Cyan>(</font>a <font color=Red>-&gt;</font> b<font color=Cyan>)</font> <font color=Red>-&gt;</font> m a <font color=Red>-&gt;</font> m b
<a name="line-582"></a><font color=Blue>mmap</font> f a <font color=Red>=</font> a <font color=Cyan>&gt;&gt;=</font> <font color=Cyan>(</font>return <font color=Cyan>.</font> f<font color=Cyan>)</font>
<a name="line-583"></a>
<a name="line-584"></a><a name="monad_join1"></a><font color=Blue><i>-- | Remove an outer application of a monad from a monadic function.</i></font>
<a name="line-585"></a><font color=Blue>monad_join1</font> <font color=Red>::</font> <font color=Cyan>(</font>Monad m<font color=Cyan>)</font> <font color=Red>=&gt;</font> m <font color=Cyan>(</font>a <font color=Red>-&gt;</font> m b<font color=Cyan>)</font> <font color=Red>-&gt;</font> a <font color=Red>-&gt;</font> m b
<a name="line-586"></a><font color=Blue>monad_join1</font> mf a <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-587"></a>  f <font color=Red>&lt;-</font> mf
<a name="line-588"></a>  f a
<a name="line-589"></a>
<a name="line-590"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-591"></a><font color=Blue><i>-- * Operations for disjoint unions</i></font>
<a name="line-592"></a>
<a name="line-593"></a><a name="map_either"></a><font color=Blue><i>-- | Take two functions /f/ : /a/ &#8594; /b/ and /g/ : /c/ &#8594; /d/, and return</i></font>
<a name="line-594"></a><font color=Blue><i>-- /f/ &#8853; /g/ : /a/ &#8853; /c/ &#8594; /c/ &#8853; /d/.</i></font>
<a name="line-595"></a><font color=Blue>map_either</font> <font color=Red>::</font> <font color=Cyan>(</font>a <font color=Red>-&gt;</font> b<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font>c <font color=Red>-&gt;</font> d<font color=Cyan>)</font> <font color=Red>-&gt;</font> Either a c <font color=Red>-&gt;</font> Either b d
<a name="line-596"></a><font color=Blue>map_either</font> f g <font color=Cyan>(</font>Left x<font color=Cyan>)</font> <font color=Red>=</font> Left <font color=Cyan>(</font>f x<font color=Cyan>)</font>
<a name="line-597"></a><font color=Blue>map_either</font> f g <font color=Cyan>(</font>Right x<font color=Cyan>)</font> <font color=Red>=</font> Right <font color=Cyan>(</font>g x<font color=Cyan>)</font>
<a name="line-598"></a>
<a name="line-599"></a><a name="map_eitherM"></a><font color=Blue><i>-- | Monadic version of 'map_either'.</i></font>
<a name="line-600"></a><font color=Blue>map_eitherM</font> <font color=Red>::</font> <font color=Cyan>(</font>Monad m<font color=Cyan>)</font> <font color=Red>=&gt;</font> <font color=Cyan>(</font>a <font color=Red>-&gt;</font> m b<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font>c <font color=Red>-&gt;</font> m d<font color=Cyan>)</font> <font color=Red>-&gt;</font> Either a c <font color=Red>-&gt;</font> m <font color=Cyan>(</font>Either b d<font color=Cyan>)</font>
<a name="line-601"></a><font color=Blue>map_eitherM</font> f g <font color=Cyan>(</font>Left x<font color=Cyan>)</font> <font color=Red>=</font> mmap Left <font color=Cyan>(</font>f x<font color=Cyan>)</font>
<a name="line-602"></a><font color=Blue>map_eitherM</font> f g <font color=Cyan>(</font>Right x<font color=Cyan>)</font> <font color=Red>=</font> mmap Right <font color=Cyan>(</font>g x<font color=Cyan>)</font>
<a name="line-603"></a>
<a name="line-604"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-605"></a><font color=Blue><i>-- * Operations for tuples</i></font>
<a name="line-606"></a>
<a name="line-607"></a><a name="map_pair"></a><font color=Blue><i>-- | Take two functions /f/ : /a/ &#8594; /b/ and /g/ : /c/ &#8594; /d/, and return</i></font>
<a name="line-608"></a><font color=Blue><i>-- /f/ &#215; /g/ : /a/ &#215; /c/ &#8594; /c/ &#215; /d/.</i></font>
<a name="line-609"></a><font color=Blue>map_pair</font> <font color=Red>::</font> <font color=Cyan>(</font>a <font color=Red>-&gt;</font> b<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font>c <font color=Red>-&gt;</font> d<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font>a<font color=Cyan>,</font> c<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font>b<font color=Cyan>,</font> d<font color=Cyan>)</font>
<a name="line-610"></a><font color=Blue>map_pair</font> f g <font color=Cyan>(</font>x<font color=Cyan>,</font> y<font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font>f x<font color=Cyan>,</font> g y<font color=Cyan>)</font>
<a name="line-611"></a>
<a name="line-612"></a><a name="map_pairM"></a><font color=Blue><i>-- | Monadic version of 'mappair'.</i></font>
<a name="line-613"></a><font color=Blue>map_pairM</font> <font color=Red>::</font> <font color=Cyan>(</font>Monad m<font color=Cyan>)</font> <font color=Red>=&gt;</font> <font color=Cyan>(</font>a <font color=Red>-&gt;</font> m b<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font>c <font color=Red>-&gt;</font> m d<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font>a<font color=Cyan>,</font> c<font color=Cyan>)</font> <font color=Red>-&gt;</font> m <font color=Cyan>(</font>b<font color=Cyan>,</font> d<font color=Cyan>)</font>
<a name="line-614"></a><font color=Blue>map_pairM</font> f g <font color=Cyan>(</font>a<font color=Cyan>,</font> c<font color=Cyan>)</font> <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-615"></a>  b <font color=Red>&lt;-</font> f a
<a name="line-616"></a>  d <font color=Red>&lt;-</font> g c
<a name="line-617"></a>  return <font color=Cyan>(</font>b<font color=Cyan>,</font> d<font color=Cyan>)</font>
<a name="line-618"></a>
<a name="line-619"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-620"></a><font color=Blue><i>-- * Arithmetic operations</i></font>
<a name="line-621"></a>  
<a name="line-622"></a><a name="int_ceiling"></a><font color=Blue><i>-- | A version of the 'ceiling' function that returns an 'Integer'.</i></font>
<a name="line-623"></a><font color=Blue>int_ceiling</font> <font color=Red>::</font> RealFrac a <font color=Red>=&gt;</font> a <font color=Red>-&gt;</font> Integer
<a name="line-624"></a><font color=Blue>int_ceiling</font> <font color=Red>=</font> toInteger <font color=Cyan>.</font> ceiling
<a name="line-625"></a>
<a name="line-626"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-627"></a><font color=Blue><i>-- * Bit vectors</i></font>
<a name="line-628"></a>
<a name="line-629"></a><a name="Boollist"></a><font color=Blue><i>-- | The type of bit vectors. True = 1, False = 0.</i></font>
<a name="line-630"></a><a name="Boollist"></a><font color=Green><u>type</u></font> Boollist <font color=Red>=</font> <font color=Red>[</font>Bool<font color=Red>]</font>
<a name="line-631"></a>
<a name="line-632"></a><a name="boollist_of_int_bh"></a><font color=Blue><i>-- | Convert an integer to a bit vector. The first argument is the</i></font>
<a name="line-633"></a><font color=Blue><i>-- length in bits, and the second argument the integer to be</i></font>
<a name="line-634"></a><font color=Blue><i>-- converted. The conversion is big-headian (or equivalently,</i></font>
<a name="line-635"></a><font color=Blue><i>-- little-tailian), i.e., the head of the list holds the integer's most</i></font>
<a name="line-636"></a><font color=Blue><i>-- significant digit.</i></font>
<a name="line-637"></a><font color=Blue>boollist_of_int_bh</font> <font color=Red>::</font> Integral a <font color=Red>=&gt;</font> Int <font color=Red>-&gt;</font> a <font color=Red>-&gt;</font> Boollist
<a name="line-638"></a><font color=Blue>boollist_of_int_bh</font> m <font color=Red>=</font> reverse <font color=Cyan>.</font> boollist_of_int_lh m
<a name="line-639"></a>
<a name="line-640"></a><a name="boollist_of_int_lh"></a><font color=Blue><i>-- | Convert an integer to a bit vector. The first argument is the</i></font>
<a name="line-641"></a><font color=Blue><i>-- length in bits, and the second argument the integer to be</i></font>
<a name="line-642"></a><font color=Blue><i>-- converted. The conversion is little-headian (or equivalently,</i></font>
<a name="line-643"></a><font color=Blue><i>-- big-tailian), i.e., the head of the list holds the integer's least</i></font>
<a name="line-644"></a><font color=Blue><i>-- significant digit.</i></font>
<a name="line-645"></a><font color=Blue>boollist_of_int_lh</font> <font color=Red>::</font> Integral a <font color=Red>=&gt;</font> Int <font color=Red>-&gt;</font> a <font color=Red>-&gt;</font> Boollist
<a name="line-646"></a><font color=Blue>boollist_of_int_lh</font> m x <font color=Red>|</font> m <font color=Cyan>&lt;=</font> <font color=Magenta>0</font> <font color=Red>=</font> []
<a name="line-647"></a><font color=Blue>boollist_of_int_lh</font> m x <font color=Red>=</font> digit <font color=Red><b>:</b></font> boollist_of_int_lh <font color=Cyan>(</font>m<font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>)</font> tail <font color=Green><u>where</u></font>
<a name="line-648"></a>  digit <font color=Red>=</font> <font color=Cyan>(</font>x <font color=Cyan>`mod`</font> <font color=Magenta>2</font> <font color=Cyan>==</font> <font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-649"></a>  tail <font color=Red>=</font> x <font color=Cyan>`div`</font> <font color=Magenta>2</font>
<a name="line-650"></a>
<a name="line-651"></a><a name="int_of_boollist_unsigned_bh"></a><font color=Blue><i>-- | Convert a bit vector to an integer. The conversion is big-headian</i></font>
<a name="line-652"></a><font color=Blue><i>-- (or equivalently, little-tailian), i.e., the head of the list holds</i></font>
<a name="line-653"></a><font color=Blue><i>-- the integer's most significant digit. This function is unsigned,</i></font>
<a name="line-654"></a><font color=Blue><i>-- i.e., the integer returned is &#8805; 0.</i></font>
<a name="line-655"></a><font color=Blue>int_of_boollist_unsigned_bh</font> <font color=Red>::</font> Integral a <font color=Red>=&gt;</font> Boollist <font color=Red>-&gt;</font> a
<a name="line-656"></a><font color=Blue>int_of_boollist_unsigned_bh</font> v <font color=Red>=</font> aux v <font color=Magenta>0</font>
<a name="line-657"></a>  <font color=Green><u>where</u></font>
<a name="line-658"></a>    aux v acc <font color=Red>=</font>
<a name="line-659"></a>      <font color=Green><u>case</u></font> v <font color=Green><u>of</u></font>
<a name="line-660"></a>        [] <font color=Red>-&gt;</font> acc
<a name="line-661"></a>        digit <font color=Red><b>:</b></font> vs <font color=Red>-&gt;</font> aux vs <font color=Cyan>(</font><font color=Magenta>2</font><font color=Cyan>*</font>acc<font color=Cyan>+</font><font color=Cyan>(</font><font color=Green><u>if</u></font> digit <font color=Green><u>then</u></font> <font color=Magenta>1</font> <font color=Green><u>else</u></font> <font color=Magenta>0</font><font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-662"></a>
<a name="line-663"></a><a name="int_of_boollist_signed_bh"></a><font color=Blue><i>-- | Convert a bit vector to an integer, signed.</i></font>
<a name="line-664"></a><font color=Blue>int_of_boollist_signed_bh</font> <font color=Red>::</font> Integral a <font color=Red>=&gt;</font> Boollist <font color=Red>-&gt;</font> a
<a name="line-665"></a><font color=Blue>int_of_boollist_signed_bh</font> [] <font color=Red>=</font> <font color=Magenta>0</font>
<a name="line-666"></a><font color=Blue>int_of_boollist_signed_bh</font> <font color=Cyan>(</font>False<font color=Red><b>:</b></font>v<font color=Cyan>)</font> <font color=Red>=</font> int_of_boollist_unsigned_bh v
<a name="line-667"></a><font color=Blue>int_of_boollist_signed_bh</font> <font color=Cyan>(</font>True<font color=Red><b>:</b></font>v<font color=Cyan>)</font> <font color=Red>=</font> <font color=Blue><i>-</i></font><font color=Magenta>1</font> <font color=Blue><i>-</i></font> int_of_boollist_unsigned_bh <font color=Cyan>(</font>map not v<font color=Cyan>)</font>
<a name="line-668"></a>
<a name="line-669"></a><a name="bool_xor"></a><font color=Blue><i>-- | Exclusive or operation on booleans.</i></font>
<a name="line-670"></a><font color=Blue>bool_xor</font> <font color=Red>::</font> Bool <font color=Red>-&gt;</font> Bool <font color=Red>-&gt;</font> Bool
<a name="line-671"></a><font color=Blue>bool_xor</font> a b <font color=Red>=</font> <font color=Cyan>(</font>a <font color=Cyan>/=</font> b<font color=Cyan>)</font>
<a name="line-672"></a>
<a name="line-673"></a><a name="boollist_xor"></a><font color=Blue><i>-- | Exclusive or operation on bit vectors.</i></font>
<a name="line-674"></a><font color=Blue>boollist_xor</font> <font color=Red>::</font> Boollist <font color=Red>-&gt;</font> Boollist <font color=Red>-&gt;</font> Boollist
<a name="line-675"></a><font color=Blue>boollist_xor</font> <font color=Red>=</font> zipWith bool_xor
<a name="line-676"></a>
<a name="line-677"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-678"></a><font color=Blue><i>-- * Formatting of lists and strings</i></font>
<a name="line-679"></a>
<a name="line-680"></a><a name="string_of_list"></a><font color=Blue><i>-- | A general list-to-string function. Example:</i></font>
<a name="line-681"></a><font color=Blue><i>-- </i></font>
<a name="line-682"></a><font color=Blue><i>-- &gt; string_of_list "{" ", " "}" "{}" show [1,2,3] = "{1, 2, 3}"</i></font>
<a name="line-683"></a><font color=Blue>string_of_list</font> <font color=Red>::</font> String <font color=Red>-&gt;</font> String <font color=Red>-&gt;</font> String <font color=Red>-&gt;</font> String <font color=Red>-&gt;</font> <font color=Cyan>(</font>t <font color=Red>-&gt;</font> String<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Red>[</font>t<font color=Red>]</font> <font color=Red>-&gt;</font> String
<a name="line-684"></a><font color=Blue>string_of_list</font> lpar comma rpar nil string_of_elt lst <font color=Red>=</font>
<a name="line-685"></a>  <font color=Green><u>let</u></font> string_of_tail lst <font color=Red>=</font>
<a name="line-686"></a>        <font color=Green><u>case</u></font> lst <font color=Green><u>of</u></font>
<a name="line-687"></a>          [] <font color=Red>-&gt;</font> <font color=Magenta>""</font>
<a name="line-688"></a>          h<font color=Red><b>:</b></font>t <font color=Red>-&gt;</font> comma <font color=Cyan>++</font> string_of_elt h <font color=Cyan>++</font> string_of_tail t
<a name="line-689"></a>  <font color=Green><u>in</u></font>
<a name="line-690"></a>  <font color=Green><u>case</u></font> lst <font color=Green><u>of</u></font>
<a name="line-691"></a>    [] <font color=Red>-&gt;</font> nil
<a name="line-692"></a>    h<font color=Red><b>:</b></font>t <font color=Red>-&gt;</font> lpar <font color=Cyan>++</font> string_of_elt h <font color=Cyan>++</font> string_of_tail t <font color=Cyan>++</font> rpar
<a name="line-693"></a>
<a name="line-694"></a><a name="optional"></a><font color=Blue><i>-- | @'optional' b s@: if /b/ = 'True', return /s/, else the empty</i></font>
<a name="line-695"></a><font color=Blue><i>-- string. This function is for convenience.</i></font>
<a name="line-696"></a><font color=Blue>optional</font> <font color=Red>::</font> Bool <font color=Red>-&gt;</font> String <font color=Red>-&gt;</font> String
<a name="line-697"></a><font color=Blue>optional</font> True s <font color=Red>=</font> s
<a name="line-698"></a><font color=Blue>optional</font> False s <font color=Red>=</font> <font color=Magenta>""</font>
<a name="line-699"></a>
<a name="line-700"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-701"></a><font color=Blue><i>-- * Lists optimized for fast concatenation</i></font>
<a name="line-702"></a>
<a name="line-703"></a><a name="BList"></a><font color=Blue><i>-- | The type of bidirectional lists. This is similar to [a], but</i></font>
<a name="line-704"></a><a name="BList"></a><font color=Blue><i>-- optimized for fast concatenation and appending on both sides.</i></font>
<a name="line-705"></a><a name="BList"></a><font color=Green><u>newtype</u></font> BList a <font color=Red>=</font> BList <font color=Cyan>{</font> getBList <font color=Red>::</font> <font color=Red>[</font>a<font color=Red>]</font> <font color=Red>-&gt;</font> <font color=Red>[</font>a<font color=Red>]</font> <font color=Cyan>}</font>
<a name="line-706"></a>
<a name="line-707"></a><a name="blist_of_list"></a><font color=Blue><i>-- | Convert a List to a 'BList'.</i></font>
<a name="line-708"></a><font color=Blue>blist_of_list</font> <font color=Red>::</font> <font color=Red>[</font>a<font color=Red>]</font> <font color=Red>-&gt;</font> BList a
<a name="line-709"></a><font color=Blue>blist_of_list</font> s <font color=Red>=</font> BList <font color=Cyan>(</font><font color=Red>\</font>x <font color=Red>-&gt;</font> s <font color=Cyan>++</font> x<font color=Cyan>)</font>
<a name="line-710"></a>
<a name="line-711"></a><a name="list_of_blist"></a><font color=Blue><i>-- | Convert a 'BList' to a List.</i></font>
<a name="line-712"></a><font color=Blue>list_of_blist</font> <font color=Red>::</font> BList a <font color=Red>-&gt;</font> <font color=Red>[</font>a<font color=Red>]</font>
<a name="line-713"></a><font color=Blue>list_of_blist</font> buf <font color=Red>=</font> getBList buf []
<a name="line-714"></a>
<a name="line-715"></a><a name="+++"></a><font color=Blue><i>-- | Fast concatenation of 'BList's or string buffers.</i></font>
<a name="line-716"></a><font color=Cyan>(</font><font color=Cyan>+++</font><font color=Cyan>)</font> <font color=Red>::</font> BList a <font color=Red>-&gt;</font> BList a <font color=Red>-&gt;</font> BList a
<a name="line-717"></a><font color=Cyan>(</font><font color=Cyan>+++</font><font color=Cyan>)</font> buf1 buf2 <font color=Red>=</font> BList <font color=Cyan>(</font><font color=Cyan>(</font>getBList buf1<font color=Cyan>)</font> <font color=Cyan>.</font> <font color=Cyan>(</font>getBList buf2<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-718"></a>
<a name="line-719"></a><a name="blist_empty"></a><font color=Blue><i>-- | The empty 'BList'.</i></font>
<a name="line-720"></a><font color=Blue>blist_empty</font> <font color=Red>::</font> BList a
<a name="line-721"></a><font color=Blue>blist_empty</font> <font color=Red>=</font> BList id
<a name="line-722"></a>
<a name="line-723"></a><a name="blist_concat"></a><font color=Blue><i>-- | Concatenate a list of 'Blist's.</i></font>
<a name="line-724"></a><font color=Blue>blist_concat</font> <font color=Red>::</font> <font color=Red>[</font>BList a<font color=Red>]</font> <font color=Red>-&gt;</font> BList a
<a name="line-725"></a><font color=Blue>blist_concat</font> l <font color=Red>=</font> foldr <font color=Cyan>(</font><font color=Cyan>+++</font><font color=Cyan>)</font> blist_empty l
<a name="line-726"></a>
<a name="line-727"></a><a name="instance%20Show%20(BList%20a)"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Show a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Show <font color=Cyan>(</font>BList a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-728"></a>        show bl <font color=Red>=</font> show <font color=Cyan>(</font>list_of_blist bl<font color=Cyan>)</font> 
<a name="line-729"></a>
<a name="line-730"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-731"></a><font color=Blue><i>-- * Strings optimized for fast concatenation</i></font>
<a name="line-732"></a>
<a name="line-733"></a><a name="Strbuf"></a><font color=Blue><i>-- | A string buffer holds a string that is optimized for fast</i></font>
<a name="line-734"></a><a name="Strbuf"></a><font color=Blue><i>-- concatenation. Note that this is an instance of 'BList', and hence</i></font>
<a name="line-735"></a><a name="Strbuf"></a><font color=Blue><i>-- 'BList' operations (in particular '+++') can be applied to string</i></font>
<a name="line-736"></a><a name="Strbuf"></a><font color=Blue><i>-- buffers. The following functions are synonyms of the respective</i></font>
<a name="line-737"></a><a name="Strbuf"></a><font color=Blue><i>-- 'BList' functions, and are provided for convenience.</i></font>
<a name="line-738"></a><a name="Strbuf"></a><font color=Green><u>type</u></font> Strbuf <font color=Red>=</font> BList Char
<a name="line-739"></a>
<a name="line-740"></a><a name="strbuf_of_string"></a><font color=Blue><i>-- | Convert a string to a string buffer.</i></font>
<a name="line-741"></a><font color=Blue>strbuf_of_string</font> <font color=Red>::</font> String <font color=Red>-&gt;</font> Strbuf
<a name="line-742"></a><font color=Blue>strbuf_of_string</font> <font color=Red>=</font> blist_of_list
<a name="line-743"></a>
<a name="line-744"></a><a name="string_of_strbuf"></a><font color=Blue><i>-- | Convert a string buffer to a string.</i></font>
<a name="line-745"></a><font color=Blue>string_of_strbuf</font> <font color=Red>::</font> Strbuf <font color=Red>-&gt;</font> String
<a name="line-746"></a><font color=Blue>string_of_strbuf</font> <font color=Red>=</font> list_of_blist
<a name="line-747"></a>
<a name="line-748"></a><a name="strbuf_empty"></a><font color=Blue><i>-- | The empty string buffer.</i></font>
<a name="line-749"></a><font color=Blue>strbuf_empty</font> <font color=Red>::</font> Strbuf
<a name="line-750"></a><font color=Blue>strbuf_empty</font> <font color=Red>=</font> blist_empty
<a name="line-751"></a>
<a name="line-752"></a><a name="strbuf_concat"></a><font color=Blue><i>-- | Concatenate a list of string buffers.</i></font>
<a name="line-753"></a><font color=Blue>strbuf_concat</font> <font color=Red>::</font> <font color=Red>[</font>Strbuf<font color=Red>]</font> <font color=Red>-&gt;</font> Strbuf
<a name="line-754"></a><font color=Blue>strbuf_concat</font> <font color=Red>=</font> blist_concat
<a name="line-755"></a>
<a name="line-756"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-757"></a><font color=Blue><i>-- * The identity monad</i></font>
<a name="line-758"></a>      
<a name="line-759"></a><a name="Id"></a><font color=Blue><i>-- | The identity monad. Using /m/ = 'Id' gives useful special cases</i></font>
<a name="line-760"></a><a name="Id"></a><font color=Blue><i>-- of monadic functions.</i></font>
<a name="line-761"></a><a name="Id"></a><font color=Green><u>newtype</u></font> Id a <font color=Red>=</font> Id <font color=Cyan>{</font> getId <font color=Red>::</font> a <font color=Cyan>}</font>
<a name="line-762"></a>
<a name="line-763"></a><a name="instance%20Monad%20Id"></a><font color=Green><u>instance</u></font> Monad Id <font color=Green><u>where</u></font>
<a name="line-764"></a>  return a <font color=Red>=</font> Id a
<a name="line-765"></a>  <font color=Cyan>(</font>Id a<font color=Cyan>)</font> <font color=Cyan>&gt;&gt;=</font> b <font color=Red>=</font> b a
<a name="line-766"></a>
<a name="line-767"></a><a name="instance%20Applicative%20Id"></a><font color=Green><u>instance</u></font> Applicative Id <font color=Green><u>where</u></font>
<a name="line-768"></a>  pure <font color=Red>=</font> return
<a name="line-769"></a>  <font color=Cyan>(</font><font color=Cyan>&lt;*&gt;</font><font color=Cyan>)</font> <font color=Red>=</font> ap
<a name="line-770"></a>
<a name="line-771"></a><a name="instance%20Functor%20Id"></a><font color=Green><u>instance</u></font> Functor Id <font color=Green><u>where</u></font>
<a name="line-772"></a>  fmap <font color=Red>=</font> liftM
<a name="line-773"></a>
<a name="line-774"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-775"></a><font color=Blue><i>-- * Identity types</i></font>
<a name="line-776"></a>  
<a name="line-777"></a><a name="Identity"></a><font color=Blue><i>-- | The type 'Identity' /a/ /b/ witnesses the fact that /a/ and /b/</i></font>
<a name="line-778"></a><a name="Identity"></a><font color=Blue><i>-- are the same type. In other words, this type is non-empty if and</i></font>
<a name="line-779"></a><a name="Identity"></a><font color=Blue><i>-- only if /a/ = /b/. This property is not guaranteed by the type</i></font>
<a name="line-780"></a><a name="Identity"></a><font color=Blue><i>-- system, but by the API, via the fact that the operators</i></font>
<a name="line-781"></a><a name="Identity"></a><font color=Blue><i>-- 'relexivity', 'symmetry', and 'transitivity' are the only exposed</i></font>
<a name="line-782"></a><a name="Identity"></a><font color=Blue><i>-- constructors for this type. The implementation of this type is</i></font>
<a name="line-783"></a><a name="Identity"></a><font color=Blue><i>-- deliberately hidden, as this is the only way to guarantee its</i></font>
<a name="line-784"></a><a name="Identity"></a><font color=Blue><i>-- defining property.</i></font>
<a name="line-785"></a><a name="Identity"></a><font color=Blue><i>-- </i></font>
<a name="line-786"></a><a name="Identity"></a><font color=Blue><i>-- Identity types are useful in certain situations. For example, they</i></font>
<a name="line-787"></a><a name="Identity"></a><font color=Blue><i>-- can be used to define a data type which is polymorphic in some type</i></font>
<a name="line-788"></a><a name="Identity"></a><font color=Blue><i>-- variable /x/, and which has certain constructors that are only</i></font>
<a name="line-789"></a><a name="Identity"></a><font color=Blue><i>-- available when /x/ is a particular type. For example, in the</i></font>
<a name="line-790"></a><a name="Identity"></a><font color=Blue><i>-- declaration</i></font>
<a name="line-791"></a><a name="Identity"></a><font color=Blue><i>-- </i></font>
<a name="line-792"></a><a name="Identity"></a><font color=Blue><i>-- &gt; data ExampleType x = Constructor1 x | Constructor2 x (Identity x Bool),</i></font>
<a name="line-793"></a><a name="Identity"></a><font color=Blue><i>-- </i></font>
<a name="line-794"></a><a name="Identity"></a><font color=Blue><i>-- @Constructor1@ is available for all /x/, but @Constructor2@ is only</i></font>
<a name="line-795"></a><a name="Identity"></a><font color=Blue><i>-- available when /x/ = 'Bool'.</i></font>
<a name="line-796"></a><a name="Identity"></a><font color=Green><u>newtype</u></font> Identity a b <font color=Red>=</font> Identity <font color=Cyan>(</font>a <font color=Red>-&gt;</font> b<font color=Cyan>,</font> b <font color=Red>-&gt;</font> a<font color=Cyan>)</font>
<a name="line-797"></a>
<a name="line-798"></a><a name="reflexivity"></a><font color=Blue><i>-- | Witness the fact that /a/=/a/.</i></font>
<a name="line-799"></a><font color=Blue>reflexivity</font> <font color=Red>::</font> Identity a a
<a name="line-800"></a><font color=Blue>reflexivity</font> <font color=Red>=</font> Identity <font color=Cyan>(</font>id<font color=Cyan>,</font> id<font color=Cyan>)</font>
<a name="line-801"></a>
<a name="line-802"></a><a name="symmetry"></a><font color=Blue><i>-- | Witness the fact that /a/=/b/ implies /b/=/a/.</i></font>
<a name="line-803"></a><font color=Blue>symmetry</font> <font color=Red>::</font> Identity a b <font color=Red>-&gt;</font> Identity b a
<a name="line-804"></a><font color=Blue>symmetry</font> <font color=Cyan>(</font>Identity <font color=Cyan>(</font>f<font color=Cyan>,</font>g<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Red>=</font> Identity <font color=Cyan>(</font>g<font color=Cyan>,</font>f<font color=Cyan>)</font>
<a name="line-805"></a>
<a name="line-806"></a><a name="transitivity"></a><font color=Blue><i>-- | Witness the fact that /a/=/b/ and /b/=/c/ implies /a/=/c/.</i></font>
<a name="line-807"></a><font color=Blue>transitivity</font> <font color=Red>::</font> Identity a b <font color=Red>-&gt;</font> Identity b c <font color=Red>-&gt;</font> Identity a c
<a name="line-808"></a><font color=Blue>transitivity</font> <font color=Cyan>(</font>Identity <font color=Cyan>(</font>f<font color=Cyan>,</font>g<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Cyan>(</font>Identity <font color=Cyan>(</font>f'<font color=Cyan>,</font>g'<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Red>=</font> Identity <font color=Cyan>(</font>f''<font color=Cyan>,</font>g''<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-809"></a>  f'' <font color=Red>=</font> f' <font color=Cyan>.</font> f
<a name="line-810"></a>  g'' <font color=Red>=</font> g <font color=Cyan>.</font> g'
<a name="line-811"></a>
<a name="line-812"></a><a name="identity"></a><font color=Blue><i>-- | The identity function 'id' : /a/ &#8594; /b/, provided that /a/ and /b/</i></font>
<a name="line-813"></a><font color=Blue><i>-- are the same type.</i></font>
<a name="line-814"></a><font color=Blue>identity</font> <font color=Red>::</font> Identity a b <font color=Red>-&gt;</font> a <font color=Red>-&gt;</font> b
<a name="line-815"></a><font color=Blue>identity</font> <font color=Cyan>(</font>Identity <font color=Cyan>(</font>f<font color=Cyan>,</font>g<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Red>=</font> f
<a name="line-816"></a>
<a name="line-817"></a><a name="instance%20Show%20(Identity%20a%20b)"></a><font color=Green><u>instance</u></font> Show <font color=Cyan>(</font>Identity a b<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-818"></a>  show x <font color=Red>=</font> <font color=Magenta>"id"</font>
<a name="line-819"></a>
<a name="line-820"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-821"></a><font color=Blue><i>-- * Isomorphism types</i></font>
<a name="line-822"></a>
<a name="line-823"></a><a name="Isomorphism"></a><font color=Blue><i>-- | The type 'Isomorphism' /a/ /b/ consists of isomorphisms between</i></font>
<a name="line-824"></a><a name="Isomorphism"></a><font color=Blue><i>-- /a/ and /b/, i.e. pairs (/f/,/g/) such that /g/./f/ == id :: /a/ -&gt; /a/,</i></font>
<a name="line-825"></a><a name="Isomorphism"></a><font color=Blue><i>-- /f/./g/ == id :: /b/ -&gt; /b/. </i></font>
<a name="line-826"></a><a name="Isomorphism"></a><font color=Blue><i>--</i></font>
<a name="line-827"></a><a name="Isomorphism"></a><font color=Blue><i>-- As with e.g. Haskell&#8217;s 'Monad' class, it is not possible in general</i></font>
<a name="line-828"></a><a name="Isomorphism"></a><font color=Blue><i>-- to guarantee that the intended laws hold; it is the programmer&#8217;s</i></font>
<a name="line-829"></a><a name="Isomorphism"></a><font color=Blue><i>-- responsibility to ensure this.</i></font>
<a name="line-830"></a><a name="Isomorphism"></a><font color=Blue><i>--</i></font>
<a name="line-831"></a><a name="Isomorphism"></a><font color=Blue><i>-- Under the hood, 'Isomorphism' and 'Identity' are in fact the same;</i></font>
<a name="line-832"></a><a name="Isomorphism"></a><font color=Blue><i>-- they differ just in the API exposed. </i></font>
<a name="line-833"></a><a name="Isomorphism"></a><font color=Green><u>newtype</u></font> Isomorphism a b <font color=Red>=</font> Isomorphism <font color=Cyan>(</font>a <font color=Red>-&gt;</font> b<font color=Cyan>,</font> b <font color=Red>-&gt;</font> a<font color=Cyan>)</font>
<a name="line-834"></a>
<a name="line-835"></a><a name="iso_forwards"></a><font color=Blue><i>-- | Map forwards along an isomorphism.</i></font>
<a name="line-836"></a><font color=Blue>iso_forwards</font> <font color=Red>::</font> Isomorphism a b <font color=Red>-&gt;</font> a <font color=Red>-&gt;</font> b
<a name="line-837"></a><font color=Blue>iso_forwards</font> <font color=Cyan>(</font>Isomorphism <font color=Cyan>(</font>f<font color=Cyan>,</font>g<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Red>=</font> f
<a name="line-838"></a>
<a name="line-839"></a><a name="iso_backwards"></a><font color=Blue><i>-- | Map backwards along an isomorphism.</i></font>
<a name="line-840"></a><font color=Blue>iso_backwards</font> <font color=Red>::</font> Isomorphism a b <font color=Red>-&gt;</font> b <font color=Red>-&gt;</font> a
<a name="line-841"></a><font color=Blue>iso_backwards</font> <font color=Cyan>(</font>Isomorphism <font color=Cyan>(</font>f<font color=Cyan>,</font>g<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Red>=</font> g
<a name="line-842"></a>
<a name="line-843"></a><font color=Blue><i>-- ======================================================================</i></font>
<a name="line-844"></a><font color=Blue><i>-- * Error messages</i></font>
<a name="line-845"></a>
<a name="line-846"></a><a name="ErrMsg"></a><font color=Blue><i>-- | Often a low-level function, such as 'qcdata_zip' and</i></font>
<a name="line-847"></a><a name="ErrMsg"></a><font color=Blue><i>-- 'qcdata_promote', throws an error because of a failure of some</i></font>
<a name="line-848"></a><a name="ErrMsg"></a><font color=Blue><i>-- low-level condition, such as \"list too short\". To produce error</i></font>
<a name="line-849"></a><a name="ErrMsg"></a><font color=Blue><i>-- messages that are meaningful to user-level code, these functions do</i></font>
<a name="line-850"></a><a name="ErrMsg"></a><font color=Blue><i>-- not have a hard-coded error message. Instead, they input a stub</i></font>
<a name="line-851"></a><a name="ErrMsg"></a><font color=Blue><i>-- error message.</i></font>
<a name="line-852"></a><a name="ErrMsg"></a><font color=Blue><i>-- </i></font>
<a name="line-853"></a><a name="ErrMsg"></a><font color=Blue><i>-- A meaningful error message typically consists of at least three parts:</i></font>
<a name="line-854"></a><a name="ErrMsg"></a><font color=Blue><i>-- </i></font>
<a name="line-855"></a><a name="ErrMsg"></a><font color=Blue><i>-- * the name of the user-level function where the error occurred, for</i></font>
<a name="line-856"></a><a name="ErrMsg"></a><font color=Blue><i>-- example: \"reverse_generic\";</i></font>
<a name="line-857"></a><a name="ErrMsg"></a><font color=Blue><i>-- </i></font>
<a name="line-858"></a><a name="ErrMsg"></a><font color=Blue><i>-- * what the function was doing when the error occurred, for example:</i></font>
<a name="line-859"></a><a name="ErrMsg"></a><font color=Blue><i>-- \"operation not permitted in reversible circuit\";</i></font>
<a name="line-860"></a><a name="ErrMsg"></a><font color=Blue><i>-- </i></font>
<a name="line-861"></a><a name="ErrMsg"></a><font color=Blue><i>-- * a specific low-level reason for the error, for example: \"dynamic</i></font>
<a name="line-862"></a><a name="ErrMsg"></a><font color=Blue><i>-- lifting\".</i></font>
<a name="line-863"></a><a name="ErrMsg"></a><font color=Blue><i>-- </i></font>
<a name="line-864"></a><a name="ErrMsg"></a><font color=Blue><i>-- Thus, a meaningful error message may be: \"reverse_generic:</i></font>
<a name="line-865"></a><a name="ErrMsg"></a><font color=Blue><i>-- operation not permitted in reversible circuit: dynamic lifting\".</i></font>
<a name="line-866"></a><a name="ErrMsg"></a><font color=Blue><i>-- </i></font>
<a name="line-867"></a><a name="ErrMsg"></a><font color=Blue><i>-- The problem is that the three pieces of information are not usually</i></font>
<a name="line-868"></a><a name="ErrMsg"></a><font color=Blue><i>-- present in the same place. The user-level function is often a</i></font>
<a name="line-869"></a><a name="ErrMsg"></a><font color=Blue><i>-- wrapper function that performs several different mid-level</i></font>
<a name="line-870"></a><a name="ErrMsg"></a><font color=Blue><i>-- operations (e.g., transforming, reversing). The mid-level function</i></font>
<a name="line-871"></a><a name="ErrMsg"></a><font color=Blue><i>-- knows what operation was being performed when the error occurred,</i></font>
<a name="line-872"></a><a name="ErrMsg"></a><font color=Blue><i>-- but often calls a lower-level function to do the actual work (e.g.,</i></font>
<a name="line-873"></a><a name="ErrMsg"></a><font color=Blue><i>-- encapsulating).</i></font>
<a name="line-874"></a><a name="ErrMsg"></a><font color=Blue><i>--   </i></font>
<a name="line-875"></a><a name="ErrMsg"></a><font color=Blue><i>-- Therefore, a stub error message is a function that inputs some</i></font>
<a name="line-876"></a><a name="ErrMsg"></a><font color=Blue><i>-- lower-level reason for a failure (example: \"list too short\") and</i></font>
<a name="line-877"></a><a name="ErrMsg"></a><font color=Blue><i>-- translates this into a higher-level error message (example:</i></font>
<a name="line-878"></a><a name="ErrMsg"></a><font color=Blue><i>-- \"qterm: shape of parameter does not data: list too short\").</i></font>
<a name="line-879"></a><a name="ErrMsg"></a><font color=Blue><i>-- </i></font>
<a name="line-880"></a><a name="ErrMsg"></a><font color=Blue><i>-- Sometimes, the stub error message may also ignore the low-level</i></font>
<a name="line-881"></a><a name="ErrMsg"></a><font color=Blue><i>-- message and completely replace it by a higher-level one. For</i></font>
<a name="line-882"></a><a name="ErrMsg"></a><font color=Blue><i>-- example, a function that implements integers as bit lists may wish</i></font>
<a name="line-883"></a><a name="ErrMsg"></a><font color=Blue><i>-- to report a problem with integers, rather than a problem with the</i></font>
<a name="line-884"></a><a name="ErrMsg"></a><font color=Blue><i>-- underlying lists.</i></font>
<a name="line-885"></a><a name="ErrMsg"></a><font color=Green><u>type</u></font> ErrMsg <font color=Red>=</font> String <font color=Red>-&gt;</font> String
<a name="line-886"></a>
<a name="line-887"></a><font color=Blue><i>-- ======================================================================</i></font>
<a name="line-888"></a><font color=Blue><i>-- * The Curry type class</i></font>
<a name="line-889"></a>
<a name="line-890"></a><font color=Blue><i>-- | The 'Curry' type class is used to implement functions that have a</i></font>
<a name="line-891"></a><font color=Blue><i>-- variable number of arguments. It provides a family of type</i></font>
<a name="line-892"></a><font color=Blue><i>-- isomorphisms</i></font>
<a name="line-893"></a><font color=Blue><i>-- </i></font>
<a name="line-894"></a><font color=Blue><i>-- @fun  &#8773;  args -&gt; res,@</i></font>
<a name="line-895"></a><font color=Blue><i>-- </i></font>
<a name="line-896"></a><font color=Blue><i>-- where</i></font>
<a name="line-897"></a><font color=Blue><i>-- </i></font>
<a name="line-898"></a><font color=Blue><i>-- &gt; fun = a1 -&gt; a2 -&gt; ... -&gt; an -&gt; res,</i></font>
<a name="line-899"></a><font color=Blue><i>-- &gt; args = (a1, (a2, (..., (an, ())))).</i></font>
<a name="line-900"></a>
<a name="line-901"></a><a name="Curry"></a><font color=Green><u>class</u></font> Curry fun args res <font color=Red>|</font> args res <font color=Red>-&gt;</font> fun <font color=Green><u>where</u></font>
<a name="line-902"></a>  <font color=Blue><i>-- | Multiple curry: map a function </i></font>
<a name="line-903"></a>  <font color=Blue><i>-- (/a/[sub 1], (/a/[sub 2], (&#8230;, ())) &#8594; /b/ </i></font>
<a name="line-904"></a>  <font color=Blue><i>-- to its curried form </i></font>
<a name="line-905"></a>  <font color=Blue><i>-- /a/[sub 1] &#8594; /a/[sub 2] &#8594; &#8230; &#8594; /b/.</i></font>
<a name="line-906"></a>  mcurry <font color=Red>::</font> <font color=Cyan>(</font>args <font color=Red>-&gt;</font> res<font color=Cyan>)</font> <font color=Red>-&gt;</font> fun
<a name="line-907"></a>  <font color=Blue><i>-- | Multiple uncurry: map a function</i></font>
<a name="line-908"></a>  <font color=Blue><i>-- /a/[sub 1] &#8594; /a/[sub 2] &#8594; &#8230; &#8594; /b/</i></font>
<a name="line-909"></a>  <font color=Blue><i>-- to its uncurried form </i></font>
<a name="line-910"></a>  <font color=Blue><i>-- (/a/[sub 1], (/a/[sub 2], (&#8230;, ())) &#8594; /b/.</i></font>
<a name="line-911"></a>  muncurry <font color=Red>::</font> fun <font color=Red>-&gt;</font> <font color=Cyan>(</font>args <font color=Red>-&gt;</font> res<font color=Cyan>)</font>
<a name="line-912"></a>               
<a name="line-913"></a><a name="instance%20Curry%20b%20()%20b"></a><font color=Green><u>instance</u></font> Curry b () b <font color=Green><u>where</u></font>
<a name="line-914"></a>  mcurry g <font color=Red>=</font> g ()
<a name="line-915"></a>  muncurry x <font color=Red>=</font> const x
<a name="line-916"></a>
<a name="line-917"></a><a name="instance%20Curry%20(a%20-%3e%20fun)%20(a,args)%20res"></a><font color=Green><u>instance</u></font> Curry fun args res <font color=Red>=&gt;</font> Curry <font color=Cyan>(</font>a <font color=Red>-&gt;</font> fun<font color=Cyan>)</font> <font color=Cyan>(</font>a<font color=Cyan>,</font>args<font color=Cyan>)</font> res <font color=Green><u>where</u></font>
<a name="line-918"></a>  mcurry g x <font color=Red>=</font> mcurry <font color=Cyan>(</font><font color=Red>\</font>xs <font color=Red>-&gt;</font> g <font color=Cyan>(</font>x<font color=Cyan>,</font>xs<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-919"></a>  muncurry f <font color=Cyan>(</font>x<font color=Cyan>,</font>xs<font color=Cyan>)</font> <font color=Red>=</font> muncurry <font color=Cyan>(</font>f x<font color=Cyan>)</font> xs
<a name="line-920"></a>                
</pre>
</body>
</html>